!function(a){"use strict";function b(a,c){return new b.prototype.init(a,c)}Function.prototype.bind||(Function.prototype.bind=function(a){var b=this;return function(){return b.apply(a)}});var c=0;a.fn.redactor=function(c){var d=[],e=Array.prototype.slice.call(arguments,1);return this.each("string"==typeof c?function(){var b,f=a.data(this,"redactor");if("-1"!=c.search(/\./)?(b=c.split("."),"undefined"!=typeof f[b[0]]&&(b=f[b[0]][b[1]])):b=f[c],"undefined"!=typeof f&&a.isFunction(b)){var g=b.apply(f,e);void 0!==g&&g!==f&&d.push(g)}else a.error('No such method "'+c+'" for Redactor')}:function(){a.data(this,"redactor",{}),a.data(this,"redactor",b(this,c))}),0===d.length?this:1===d.length?d[0]:d},a.Redactor=b,a.Redactor.VERSION="10.1.1",a.Redactor.modules=["alignment","autosave","block","buffer","build","button","caret","clean","code","core","dropdown","file","focus","image","indent","inline","insert","keydown","keyup","lang","line","link","list","modal","observe","paragraphize","paste","placeholder","progress","selection","shortcuts","tabifier","tidy","toolbar","upload","utils","linkify"],a.Redactor.opts={lang:"en",direction:"ltr",plugins:!1,focus:!1,focusEnd:!1,placeholder:!1,visual:!0,tabindex:!1,minHeight:!1,maxHeight:!1,linebreaks:!1,replaceDivs:!0,paragraphize:!0,cleanStyleOnEnter:!1,enterKey:!0,cleanOnPaste:!0,cleanSpaces:!0,pastePlainText:!1,autosave:!1,autosaveName:!1,autosaveInterval:60,autosaveOnChange:!1,autosaveFields:!1,linkTooltip:!0,linkProtocol:"http",linkNofollow:!1,linkSize:50,imageEditable:!0,imageLink:!0,imagePosition:!0,imageFloatMargin:"10px",imageResizable:!0,imageUpload:null,imageUploadParam:"file",uploadImageField:!1,dragImageUpload:!0,fileUpload:null,fileUploadParam:"file",dragFileUpload:!0,s3:!1,convertLinks:!0,convertUrlLinks:!0,convertImageLinks:!0,convertVideoLinks:!0,preSpaces:4,tabAsSpaces:!1,tabKey:!0,scrollTarget:!1,toolbar:!0,toolbarFixed:!0,toolbarFixedTarget:document,toolbarFixedTopOffset:0,toolbarExternal:!1,toolbarOverflow:!1,source:!0,buttons:["html","formatting","bold","italic","underline","deleted","unorderedlist","orderedlist","outdent","indent","image","file","link","alignment","horizontalrule"],buttonsHide:[],buttonsHideOnMobile:[],formatting:["p","blockquote","pre","h1","h2","h3","h4","h5","h6"],formattingAdd:!1,tabifier:!0,deniedTags:["script","style"],allowedTags:!1,paragraphizeBlocks:["table","div","pre","form","ul","ol","h1","h2","h3","h4","h5","h6","dl","blockquote","figcaption","address","section","header","footer","aside","article","object","style","script","iframe","select","input","textarea","button","option","map","area","math","hr","fieldset","legend","hgroup","nav","figure","details","menu","summary","p"],removeComments:!1,replaceTags:[["strike","del"]],replaceStyles:[["font-weight:\\s?bold","strong"],["font-style:\\s?italic","em"],["text-decoration:\\s?underline","u"],["text-decoration:\\s?line-through","del"]],removeDataAttr:!1,removeAttr:!1,allowedAttr:!1,removeWithoutAttr:["span"],removeEmpty:["p"],activeButtons:["deleted","italic","bold","underline","unorderedlist","orderedlist","alignleft","aligncenter","alignright","justify"],activeButtonsStates:{b:"bold",strong:"bold",i:"italic",em:"italic",del:"deleted",strike:"deleted",ul:"unorderedlist",ol:"orderedlist",u:"underline"},shortcuts:{"ctrl+shift+m, meta+shift+m":{func:"inline.removeFormat"},"ctrl+b, meta+b":{func:"inline.format",params:["bold"]},"ctrl+i, meta+i":{func:"inline.format",params:["italic"]},"ctrl+h, meta+h":{func:"inline.format",params:["superscript"]},"ctrl+l, meta+l":{func:"inline.format",params:["subscript"]},"ctrl+k, meta+k":{func:"link.show"},"ctrl+shift+7":{func:"list.toggle",params:["orderedlist"]},"ctrl+shift+8":{func:"list.toggle",params:["unorderedlist"]}},shortcutsAdd:!1,buffer:[],rebuffer:[],emptyHtml:"<p>&#x200b;</p>",invisibleSpace:"&#x200b;",imageTypes:["image/png","image/jpeg","image/gif"],indentValue:20,verifiedTags:["a","img","b","strong","sub","sup","i","em","u","small","strike","del","cite","ul","ol","li"],inlineTags:["strong","b","u","em","i","code","del","ins","samp","kbd","sup","sub","mark","var","cite","small"],alignmentTags:["P","H1","H2","H3","H4","H5","H6","DL","DT","DD","DIV","TD","BLOCKQUOTE","OUTPUT","FIGCAPTION","ADDRESS","SECTION","HEADER","FOOTER","ASIDE","ARTICLE"],blockLevelElements:["PRE","UL","OL","LI"],langs:{en:{html:"HTML",video:"Insert Video",image:"Insert Image",table:"Table",link:"Link",link_insert:"Insert link",link_edit:"Edit link",unlink:"Unlink",formatting:"Formatting",paragraph:"Normal text",quote:"Quote",code:"Code",header1:"Header 1",header2:"Header 2",header3:"Header 3",header4:"Header 4",header5:"Header 5",header6:"Header 6",bold:"Bold",italic:"Italic",fontcolor:"Font Color",backcolor:"Background Color",unorderedlist:"Unordered List",orderedlist:"Ordered List",outdent:"Outdent",indent:"Indent",cancel:"Cancel",insert:"Insert",save:"Save",_delete:"Delete",insert_table:"Insert Table",insert_row_above:"Add Row Above",insert_row_below:"Add Row Below",insert_column_left:"Add Column Left",insert_column_right:"Add Column Right",delete_column:"Delete Column",delete_row:"Delete Row",delete_table:"Delete Table",rows:"Rows",columns:"Columns",add_head:"Add Head",delete_head:"Delete Head",title:"Title",image_position:"Position",none:"None",left:"Left",right:"Right",center:"Center",image_web_link:"Image Web Link",text:"Text",mailto:"Email",web:"URL",video_html_code:"Video Embed Code or Youtube/Vimeo Link",file:"Insert File",upload:"Upload",download:"Download",choose:"Choose",or_choose:"Or choose",drop_file_here:"Drop file here",align_left:"Align text to the left",align_center:"Center text",align_right:"Align text to the right",align_justify:"Justify text",horizontalrule:"Insert Horizontal Rule",deleted:"Deleted",anchor:"Anchor",link_new_tab:"Open link in new tab",underline:"Underline",alignment:"Alignment",filename:"Name (optional)",edit:"Edit",upload_label:"Drop file here or "}},linkify:{regexps:{youtube:/https?:\/\/(?:[0-9A-Z-]+\.)?(?:youtu\.be\/|youtube\.com\S*[^\w\-\s])([\w\-]{11})(?=[^\w\-]|$)(?![?=&+%\w.\-]*(?:['"][^<>]*>|<\/a>))[?=&+%\w.-]*/gi,vimeo:/https?:\/\/(www\.)?vimeo.com\/(\d+)($|\/)/,image:/((https?|www)[^\s]+\.)(jpe?g|png|gif)(\?[^\s-]+)?/gi,url:/(https?:\/\/(?:www\.|(?!www))[^\s\.]+\.[^\s]{2,}|www\.[^\s]+\.[^\s]{2,})/gi}},codemirror:!1},b.fn=a.Redactor.prototype={keyCode:{BACKSPACE:8,DELETE:46,DOWN:40,ENTER:13,SPACE:32,ESC:27,TAB:9,CTRL:17,META:91,SHIFT:16,ALT:18,RIGHT:39,LEFT:37,LEFT_WIN:91},init:function(b,d){if(this.$element=a(b),this.uuid=c++,this.rtePaste=!1,this.$pasteBox=!1,this.loadOptions(d),this.loadModules(),this.formatting={},a.merge(this.opts.blockLevelElements,this.opts.alignmentTags),this.reIsBlock=new RegExp("^("+this.opts.blockLevelElements.join("|")+")$","i"),this.reIsInline=new RegExp("^("+this.opts.inlineTags.join("|")+")$","i"),this.tidy.setupAllowed(),this.opts.deniedTags!==!1)for(var e=["html","head","link","body","meta","applet"],f=0;f<e.length;f++)this.opts.deniedTags.push(e[f]);this.lang.load(),a.extend(this.opts.shortcuts,this.opts.shortcutsAdd),this.core.setCallback("start"),this.start=!0,this.build.run()},loadOptions:function(b){this.opts=a.extend({},a.extend(!0,{},a.Redactor.opts),this.$element.data(),b)},getModuleMethods:function(a){return Object.getOwnPropertyNames(a).filter(function(b){return"function"==typeof a[b]})},loadModules:function(){for(var b=a.Redactor.modules.length,c=0;b>c;c++)this.bindModuleMethods(a.Redactor.modules[c])},bindModuleMethods:function(a){if("undefined"!=typeof this[a]){this[a]=this[a]();for(var b=this.getModuleMethods(this[a]),c=b.length,d=0;c>d;d++)this[a][b[d]]=this[a][b[d]].bind(this)}},alignment:function(){return{left:function(){this.alignment.set("left")},right:function(){this.alignment.set("right")},center:function(){this.alignment.set("center")},justify:function(){this.alignment.set("justify")},set:function(a){this.utils.browser("msie")||this.$editor.focus(),this.buffer.set(),this.selection.save(),this.alignment.blocks=this.selection.getBlocks(),this.alignment.type=a,this.alignment.isLinebreaksOrNoBlocks()?this.alignment.setText():this.alignment.setBlocks(),this.selection.restore(),this.code.sync()},setText:function(){var b=this.selection.wrap("div");a(b).attr("data-tagblock","redactor").css("text-align",this.alignment.type)},setBlocks:function(){a.each(this.alignment.blocks,a.proxy(function(a,b){var c=this.utils.getAlignmentElement(b);c&&(this.alignment.isNeedReplaceElement(c)?this.alignment.replaceElement(c):this.alignment.alignElement(c))},this))},isLinebreaksOrNoBlocks:function(){return this.opts.linebreaks&&this.alignment.blocks[0]===!1},isNeedReplaceElement:function(a){return""===this.alignment.type&&"undefined"!=typeof a.data("tagblock")},replaceElement:function(a){a.replaceWith(a.html())},alignElement:function(a){a.css("text-align",this.alignment.type),this.utils.removeEmptyAttr(a,"style")}}},autosave:function(){return{html:!1,enable:function(){this.opts.autosave&&(this.autosave.name=this.opts.autosaveName?this.opts.autosaveName:this.$textarea.attr("name"),this.opts.autosaveOnChange||(this.autosaveInterval=setInterval(this.autosave.load,1e3*this.opts.autosaveInterval)))},onChange:function(){this.opts.autosaveOnChange&&this.autosave.load()},load:function(){if(this.autosave.source=this.code.get(),this.autosave.html!==this.autosave.source){var b={};b.name=this.autosave.name,b[this.autosave.name]=this.autosave.source,b=this.autosave.getHiddenFields(b);var c=a.ajax({url:this.opts.autosave,type:"post",data:b});c.done(this.autosave.success)}},getHiddenFields:function(b){return this.opts.autosaveFields===!1||"object"!=typeof this.opts.autosaveFields?b:(a.each(this.opts.autosaveFields,a.proxy(function(c,d){null!==d&&0===d.toString().indexOf("#")&&(d=a(d).val()),b[c]=d},this)),b)},success:function(b){var c;try{c=a.parseJSON(b)}catch(d){c=b}var e="undefined"==typeof c.error?"autosave":"autosaveError";this.core.setCallback(e,this.autosave.name,c),this.autosave.html=this.autosave.source},disable:function(){clearInterval(this.autosaveInterval)}}},block:function(){return{formatting:function(a){this.block.clearStyle=!1;var b,c;"undefined"!=typeof this.formatting[a].data?b="data":"undefined"!=typeof this.formatting[a].attr?b="attr":"undefined"!=typeof this.formatting[a]["class"]&&(b="class"),"undefined"!=typeof this.formatting[a].clear&&(this.block.clearStyle=!0),b&&(c=this.formatting[a][b]),this.block.format(this.formatting[a].tag,b,c)},format:function(b,c,d){"quote"==b&&(b="blockquote");var e=["p","pre","blockquote","h1","h2","h3","h4","h5","h6"];-1!=a.inArray(b,e)&&(this.block.isRemoveInline="pre"==b||-1!=b.search(/h[1-6]/i),this.utils.browser("msie")||this.$editor.focus(),this.block.blocks=this.selection.getBlocks(),this.block.blocksSize=this.block.blocks.length,this.block.type=c,this.block.value=d,this.buffer.set(),this.selection.save(),this.block.set(b),this.selection.restore(),this.code.sync())},set:function(a){this.selection.get(),this.block.containerTag=this.range.commonAncestorContainer.tagName,this.range.collapsed?this.block.setCollapsed(a):this.block.setMultiple(a)},setCollapsed:function(b){var c=this.block.blocks[0];if(c!==!1){if("LI"==c.tagName){if("blockquote"!=b)return;return void this.block.formatListToBlockquote()}var d="TD"==this.block.containerTag||"TH"==this.block.containerTag;if(d&&!this.opts.linebreaks)document.execCommand("formatblock",!1,"<"+b+">"),c=this.selection.getBlock(),this.block.toggle(a(c));else if(c.tagName.toLowerCase()!=b)if(this.opts.linebreaks&&"p"==b)a(c).prepend("<br>").append("<br>"),this.utils.replaceWithContents(c);else{var e=this.utils.replaceToTag(c,b);this.block.toggle(e),"p"!=b&&"blockquote"!=b&&e.find("img").remove(),this.block.isRemoveInline&&this.utils.removeInlineTags(e),("p"==b||this.block.headTag)&&e.find("p").contents().unwrap(),this.block.formatTableWrapping(e)}else if("blockquote"==b&&c.tagName.toLowerCase()==b)if(this.opts.linebreaks)a(c).prepend("<br>").append("<br>"),this.utils.replaceWithContents(c);else{var f=this.utils.replaceToTag(c,"p");this.block.toggle(f)}else c.tagName.toLowerCase()==b&&this.block.toggle(a(c));"undefined"==typeof this.block.type&&"undefined"==typeof this.block.value&&a(c).removeAttr("class").removeAttr("style")}},setMultiple:function(b){var c=this.block.blocks[0],d="TD"==this.block.containerTag||"TH"==this.block.containerTag;if(c!==!1&&1===this.block.blocksSize)if(c.tagName.toLowerCase()==b&&"blockquote"==b)if(this.opts.linebreaks)a(c).prepend("<br>").append("<br>"),this.utils.replaceWithContents(c);else{var e=this.utils.replaceToTag(c,"p");this.block.toggle(e)}else if("LI"==c.tagName){if("blockquote"!=b)return;this.block.formatListToBlockquote()}else if("BLOCKQUOTE"==this.block.containerTag)this.block.formatBlockquote(b);else if(this.opts.linebreaks&&(d||this.range.commonAncestorContainer!=c))this.block.formatWrap(b);else if(this.opts.linebreaks&&"p"==b)a(c).prepend("<br>").append("<br>"),this.utils.replaceWithContents(c);else if("TD"===c.tagName)this.block.formatWrap(b);else{var f=this.utils.replaceToTag(c,b);this.block.toggle(f),this.block.isRemoveInline&&this.utils.removeInlineTags(f),("p"==b||this.block.headTag)&&f.find("p").contents().unwrap()}else if(this.opts.linebreaks||"p"!=b){if("blockquote"==b){for(var g=0,h=0;h<this.block.blocksSize;h++)"BLOCKQUOTE"==this.block.blocks[h].tagName&&g++;if(g==this.block.blocksSize)return void a.each(this.block.blocks,a.proxy(function(b,c){var d=!1;this.opts.linebreaks?(a(c).prepend("<br>").append("<br>"),d=this.utils.replaceWithContents(c)):d=this.utils.replaceToTag(c,"p"),d&&"undefined"==typeof this.block.type&&"undefined"==typeof this.block.value&&d.removeAttr("class").removeAttr("style")},this))}this.block.formatWrap(b)}else{var i=0,j=!1;"class"==this.block.type&&(j="toggle",i=a(this.block.blocks).filter("."+this.block.value).length,this.block.blocksSize==i?j="toggle":this.block.blocksSize>i?j="set":0===i&&(j="set"));var k=["ul","ol","li","td","th","dl","dt","dd"];a.each(this.block.blocks,a.proxy(function(c,d){if(-1==a.inArray(d.tagName.toLowerCase(),k)){var e=this.utils.replaceToTag(d,b);j?"toggle"==j?this.block.toggle(e):"remove"==j?this.block.remove(e):"set"==j&&this.block.setForce(e):this.block.toggle(e),"p"!=b&&"blockquote"!=b&&e.find("img").remove(),this.block.isRemoveInline&&this.utils.removeInlineTags(e),("p"==b||this.block.headTag)&&e.find("p").contents().unwrap(),"undefined"==typeof this.block.type&&"undefined"==typeof this.block.value&&e.removeAttr("class").removeAttr("style")}},this))}},setForce:function(a){return this.block.clearStyle&&a.removeAttr("class").removeAttr("style"),"class"==this.block.type?void a.addClass(this.block.value):"attr"==this.block.type||"data"==this.block.type?void a.attr(this.block.value.name,this.block.value.value):void 0},toggle:function(a){return this.block.clearStyle&&a.removeAttr("class").removeAttr("style"),"class"==this.block.type?void a.toggleClass(this.block.value):"attr"==this.block.type||"data"==this.block.type?void(a.attr(this.block.value.name)==this.block.value.value?a.removeAttr(this.block.value.name):a.attr(this.block.value.name,this.block.value.value)):void a.removeAttr("style class")},remove:function(a){a.removeClass(this.block.value)},formatListToBlockquote:function(){var b=a(this.block.blocks[0]).closest("ul, ol",this.$editor[0]);a(b).find("ul, ol").contents().unwrap(),a(b).find("li").append(a("<br>")).contents().unwrap();var c=this.utils.replaceToTag(b,"blockquote");this.block.toggle(c)},formatBlockquote:function(b){document.execCommand("outdent"),document.execCommand("formatblock",!1,b),this.clean.clearUnverified(),this.$editor.find("p:empty").remove();var c=this.selection.getBlock();"p"!=b&&a(c).find("img").remove(),this.opts.linebreaks||this.block.toggle(a(c)),this.$editor.find("ul, ol, tr, blockquote, p").each(a.proxy(this.utils.removeEmpty,this)),this.opts.linebreaks&&"p"==b&&this.utils.replaceWithContents(c)},formatWrap:function(b){if("UL"==this.block.containerTag||"OL"==this.block.containerTag){if("blockquote"!=b)return;this.block.formatListToBlockquote()}var c=this.selection.wrap(b);if(c!==!1){var d=a(c);this.block.formatTableWrapping(d);var e=d.find(this.opts.blockLevelElements.join(",")+", td, table, thead, tbody, tfoot, th, tr");(this.opts.linebreaks&&"p"==b||"pre"==b||"blockquote"==b)&&e.append("<br />"),e.contents().unwrap(),"p"!=b&&"blockquote"!=b&&d.find("img").remove(),a.each(this.block.blocks,a.proxy(this.utils.removeEmpty,this)),d.append(this.selection.getMarker(2)),this.opts.linebreaks||this.block.toggle(d),this.$editor.find("ul, ol, tr, blockquote, p").each(a.proxy(this.utils.removeEmpty,this)),d.find("blockquote:empty").remove(),this.block.isRemoveInline&&this.utils.removeInlineTags(d),this.opts.linebreaks&&"p"==b&&this.utils.replaceWithContents(d)}},formatTableWrapping:function(a){0!==a.closest("table",this.$editor[0]).length&&(0===a.closest("tr",this.$editor[0]).length&&a.wrap("<tr>"),0===a.closest("td",this.$editor[0]).length&&0===a.closest("th").length&&a.wrap("<td>"))},removeData:function(b,c){var d=this.selection.getBlocks();a(d).removeAttr("data-"+b),this.code.sync()},setData:function(b,c){var d=this.selection.getBlocks();a(d).attr("data-"+b,c),this.code.sync()},toggleData:function(b,c){var d=this.selection.getBlocks();a.each(d,function(){a(this).attr("data-"+b)?a(this).removeAttr("data-"+b):a(this).attr("data-"+b,c)})},removeAttr:function(b,c){var d=this.selection.getBlocks();a(d).removeAttr(b),this.code.sync()},setAttr:function(b,c){var d=this.selection.getBlocks();a(d).attr(b,c),this.code.sync()},toggleAttr:function(b,c){var d=this.selection.getBlocks();a.each(d,function(){a(this).attr(name)?a(this).removeAttr(name):a(this).attr(name,c)})},removeClass:function(b){var c=this.selection.getBlocks();a(c).removeClass(b),this.utils.removeEmptyAttr(c,"class"),this.code.sync()},setClass:function(b){var c=this.selection.getBlocks();a(c).addClass(b),this.code.sync()},toggleClass:function(b){var c=this.selection.getBlocks();a(c).toggleClass(b),this.code.sync()}}},buffer:function(){return{set:function(a){"undefined"==typeof a||"undo"==a?this.buffer.setUndo():this.buffer.setRedo()},setUndo:function(){this.selection.save(),this.opts.buffer.push(this.$editor.html()),this.selection.restore()},setRedo:function(){this.selection.save(),this.opts.rebuffer.push(this.$editor.html()),this.selection.restore()},getUndo:function(){this.$editor.html(this.opts.buffer.pop())},getRedo:function(){this.$editor.html(this.opts.rebuffer.pop())},add:function(){this.opts.buffer.push(this.$editor.html())},undo:function(){0!==this.opts.buffer.length&&(this.buffer.set("redo"),this.buffer.getUndo(),this.selection.restore(),setTimeout(a.proxy(this.observe.load,this),50))},redo:function(){0!==this.opts.rebuffer.length&&(this.buffer.set("undo"),this.buffer.getRedo(),this.selection.restore(),setTimeout(a.proxy(this.observe.load,this),50))}}},build:function(){return{run:function(){this.build.createContainerBox(),this.build.loadContent(),this.build.loadEditor(),this.build.enableEditor(),this.build.setCodeAndCall()},isTextarea:function(){return"TEXTAREA"===this.$element[0].tagName},createContainerBox:function(){this.$box=a('<div class="redactor-box" />')},createTextarea:function(){this.$textarea=a("<textarea />").attr("name",this.build.getTextareaName())},getTextareaName:function(){return"undefined"==typeof name?"content-"+this.uuid:this.$element.attr("id")},loadContent:function(){var b=this.build.isTextarea()?"val":"html";this.content=a.trim(this.$element[b]())},enableEditor:function(){this.$editor.attr({contenteditable:!0,dir:this.opts.direction})},loadEditor:function(){var a=this.build.isTextarea()?"fromTextarea":"fromElement";this.build[a]()},fromTextarea:function(){this.$editor=a("<div />"),this.$textarea=this.$element,this.$box.insertAfter(this.$element).append(this.$editor).append(this.$element),this.$editor.addClass("redactor-editor"),this.$element.hide()},fromElement:function(){this.$editor=this.$element,this.build.createTextarea(),this.$box.insertAfter(this.$editor).append(this.$editor).append(this.$textarea),this.$editor.addClass("redactor-editor"),this.$textarea.hide()},setCodeAndCall:function(){this.code.set(this.content),this.build.setOptions(),this.build.callEditor(),this.opts.visual||setTimeout(a.proxy(this.code.showCode,this),200)},callEditor:function(){this.build.disableMozillaEditing(),this.build.setEvents(),this.build.setHelpers(),this.opts.toolbar&&(this.opts.toolbar=this.toolbar.init(),this.toolbar.build()),this.modal.loadTemplates(),this.build.plugins(),setTimeout(a.proxy(this.observe.load,this),4),this.core.setCallback("init")},setOptions:function(){a(this.$textarea).attr("dir",this.opts.direction),this.opts.linebreaks&&this.$editor.addClass("redactor-linebreaks"),this.opts.tabindex&&this.$editor.attr("tabindex",this.opts.tabindex),this.opts.minHeight&&this.$editor.css("minHeight",this.opts.minHeight),this.opts.maxHeight&&this.$editor.css("maxHeight",this.opts.maxHeight)},setEventDropUpload:function(a){if(a.preventDefault(),this.opts.dragImageUpload&&this.opts.dragFileUpload){var b=a.dataTransfer.files;this.upload.directUpload(b[0],a)}},setEventDrop:function(a){this.code.sync(),setTimeout(this.clean.clearUnverified,1),this.core.setCallback("drop",a)},setEvents:function(){this.$editor.on("drop.redactor",a.proxy(function(a){return a=a.originalEvent||a,void 0!==window.FormData&&a.dataTransfer?0===a.dataTransfer.files.length?this.build.setEventDrop(a):(this.build.setEventDropUpload(a),setTimeout(this.clean.clearUnverified,1),void this.core.setCallback("drop",a)):!0},this)),this.$editor.on("click.redactor",a.proxy(function(a){var b=this.core.getEvent(),c="click"==b||"arrow"==b?!1:"click";this.core.addEvent(c),this.utils.disableSelectAll(),this.core.setCallback("click",a)},this)),this.$editor.on("paste.redactor",a.proxy(this.paste.init,this)),this.$editor.on("cut.redactor",a.proxy(this.code.sync,this)),this.$editor.on("keydown.redactor",a.proxy(this.keydown.init,this)),this.$editor.on("keyup.redactor",a.proxy(this.keyup.init,this)),a.isFunction(this.opts.codeKeydownCallback)&&this.$textarea.on("keydown.redactor-textarea",a.proxy(this.opts.codeKeydownCallback,this)),a.isFunction(this.opts.codeKeyupCallback)&&this.$textarea.on("keyup.redactor-textarea",a.proxy(this.opts.codeKeyupCallback,this)),a.isFunction(this.opts.focusCallback)&&this.$editor.on("focus.redactor",a.proxy(this.opts.focusCallback,this));var b;a(document).on("mousedown",function(a){b=a.target}),this.$editor.on("blur.redactor",a.proxy(function(c){this.rtePaste||this.build.isBlured(b)&&(this.utils.disableSelectAll(),a.isFunction(this.opts.blurCallback)&&this.core.setCallback("blur",c))},this))},isBlured:function(b){var c=a(b);return!c.hasClass("redactor-toolbar, redactor-dropdown")&&!c.is("#redactor-modal")&&0===c.parents(".redactor-toolbar, .redactor-dropdown, #redactor-modal").length&&0===c.closest(this.$editor).length},setHelpers:function(){this.linkify.isEnabled()&&this.linkify.format(),this.placeholder.enable(),this.opts.focus&&setTimeout(this.focus.setStart,100),this.opts.focusEnd&&setTimeout(this.focus.setEnd,100)},plugins:function(){this.opts.plugins&&RedactorPlugins&&a.each(this.opts.plugins,a.proxy(function(b,c){if("undefined"!=typeof RedactorPlugins[c]){if(-1!==a.inArray(c,a.Redactor.modules))return void a.error('Plugin name "'+c+"\" matches the name of the Redactor's module.");if(a.isFunction(RedactorPlugins[c])){this[c]=RedactorPlugins[c]();for(var d=this.getModuleMethods(this[c]),e=d.length,f=0;e>f;f++)this[c][d[f]]=this[c][d[f]].bind(this);a.isFunction(this[c].init)&&this[c].init()}}},this))},disableMozillaEditing:function(){if(this.utils.browser("mozilla"))try{document.execCommand("enableObjectResizing",!1,!1),document.execCommand("enableInlineTableEditing",!1,!1)}catch(a){}}}},button:function(){return{build:function(b,c){var d=a('<a href="#" class="re-icon re-'+b+'" rel="'+b+'" />').attr("tabindex","-1");if((c.func||c.command||c.dropdown)&&this.button.setEvent(d,b,c),c.dropdown){var e=a('<div class="redactor-dropdown redactor-dropdown-'+this.uuid+" redactor-dropdown-box-"+b+'" style="display: none;">');d.data("dropdown",e),this.dropdown.build(b,e,c.dropdown)}return this.utils.isDesktop()&&this.button.createTooltip(d,b,c.title),d},setEvent:function(b,c,d){b.on("touchstart click",a.proxy(function(a){if(b.hasClass("redactor-button-disabled"))return!1;var e="func",f=d.func;d.command?(e="command",f=d.command):d.dropdown&&(e="dropdown",f=!1),this.button.onClick(a,c,e,f)},this))},createTooltip:function(b,c,d){var e=a("<span>").addClass("redactor-toolbar-tooltip redactor-toolbar-tooltip-"+c).hide().html(d);e.appendTo("body"),b.on("mouseover",function(){if(!a(this).hasClass("redactor-button-disabled")){var c=b.offset();e.show(),e.css({top:c.top+b.innerHeight()+"px",left:c.left+b.innerWidth()/2-e.innerWidth()/2+"px"})}}),b.on("mouseout",function(){e.hide()})},onClick:function(a,b,c,d){this.button.caretOffset=this.caret.getOffset(),a.preventDefault(),this.utils.browser("msie")&&(a.returnValue=!1),"command"==c?this.inline.format(d):"dropdown"==c?this.dropdown.show(a,b):this.button.onClickCallback(a,d,b)},onClickCallback:function(b,c,d){var e;if(a.isFunction(c))c.call(this,d);else if("-1"!=c.search(/\./)){if(e=c.split("."),"undefined"==typeof this[e[0]])return;this[e[0]][e[1]](d)}else this[c](d);this.observe.buttons(b,d)},get:function(a){return this.$toolbar.find("a.re-"+a)},setActive:function(a){this.button.get(a).addClass("redactor-act")},setInactive:function(a){this.button.get(a).removeClass("redactor-act")},setInactiveAll:function(a){"undefined"==typeof a?this.$toolbar.find("a.re-icon").removeClass("redactor-act"):this.$toolbar.find("a.re-icon").not(".re-"+a).removeClass("redactor-act")},setActiveInVisual:function(){this.$toolbar.find("a.re-icon").not("a.re-html").removeClass("redactor-button-disabled")},setInactiveInCode:function(){this.$toolbar.find("a.re-icon").not("a.re-html").addClass("redactor-button-disabled")},changeIcon:function(a,b){this.button.get(a).addClass("re-"+b)},removeIcon:function(a,b){this.button.get(a).removeClass("re-"+b)},setAwesome:function(a,b){var c=this.button.get(a);c.removeClass("redactor-btn-image").addClass("fa-redactor-btn"),c.html('<i class="fa '+b+'"></i>')},addCallback:function(b,c){var d="dropdown"==c?"dropdown":"func",e=b.attr("rel");"dropdown"==d&&b.addClass("re-has-dropdown"),b.on("touchstart click",a.proxy(function(a){return b.hasClass("redactor-button-disabled")?!1:void this.button.onClick(a,e,d,c)},this))},addDropdown:function(b,c){var d=b.attr("rel");this.button.addCallback(b,"dropdown");var e=a('<div class="redactor-dropdown redactor-dropdown-'+this.uuid+" redactor-dropdown-box-"+d+'" style="display: none;">');return b.data("dropdown",e),c&&this.dropdown.build(d,e,c),e},add:function(b,c){if(this.opts.toolbar){var d=this.button.build(b,{title:c});return d.addClass("redactor-btn-image"),this.$toolbar.append(a("<li>").append(d)),d}},addFirst:function(b,c){if(this.opts.toolbar){var d=this.button.build(b,{title:c});return d.addClass("redactor-btn-image"),this.$toolbar.prepend(a("<li>").append(d)),d}},addAfter:function(b,c,d){if(this.opts.toolbar){var e=this.button.build(c,{title:d});e.addClass("redactor-btn-image");var f=this.button.get(b);return 0!==f.length?f.parent().after(a("<li>").append(e)):this.$toolbar.append(a("<li>").append(e)),e}},addBefore:function(b,c,d){if(this.opts.toolbar){var e=this.button.build(c,{title:d});e.addClass("redactor-btn-image");var f=this.button.get(b);return 0!==f.length?f.parent().before(a("<li>").append(e)):this.$toolbar.append(a("<li>").append(e)),e}},remove:function(a){this.button.get(a).remove()}}},caret:function(){return{setStart:function(b){if(this.utils.isInline(b)){var c=this.utils.createSpaceElement();a(b).prepend(c),this.caret.setEnd(c)}else this.caret.set(b,0,b,0)},setEnd:function(a){this.caret.set(a,1,a,1)},set:function(b,c,d,e){if(b=b[0]||b,d=d[0]||d,this.utils.isBlockTag(b.tagName)&&""===b.innerHTML&&(b.innerHTML=this.opts.invisibleSpace),"BR"==b.tagName&&this.opts.linebreaks===!1){var f=a(this.opts.emptyHtml)[0];a(b).replaceWith(f),b=f,d=b}this.selection.get();try{this.range.setStart(b,c),this.range.setEnd(d,e)}catch(g){}this.selection.addRange()},setAfter:function(b){try{var c=a(b)[0].tagName;if("BR"!=c&&this.utils.isInline(b)){var d=this.utils.createSpaceElement();a(b).after(d),this.caret.setEnd(d)}else"BR"!=c&&this.utils.browser("msie")?this.caret.setStart(a(b).next()):this.caret.setAfterOrBefore(b,"after")}catch(e){var d=this.utils.createSpaceElement();a(b).after(d),this.caret.setEnd(d)}},setBefore:function(b){this.utils.isBlock(b)?this.caret.setEnd(a(b).prev()):this.caret.setAfterOrBefore(b,"before")},setAfterOrBefore:function(a,b){if(this.utils.browser("msie")||this.$editor.focus(),a=a[0]||a,this.selection.get(),"after"==b)try{this.range.setStartAfter(a),this.range.setEndAfter(a)}catch(c){}else try{this.range.setStartBefore(a),this.range.setEndBefore(a)}catch(c){}this.range.collapse(!1),this.selection.addRange()},getOffsetOfElement:function(b){b=b[0]||b,this.selection.get();var c=this.range.cloneRange();return c.selectNodeContents(b),c.setEnd(this.range.endContainer,this.range.endOffset),a.trim(c.toString()).length},getOffset:function(){var a=0,b=window.getSelection();if(b.rangeCount>0){var c=window.getSelection().getRangeAt(0),d=c.cloneRange();d.selectNodeContents(this.$editor[0]),d.setEnd(c.endContainer,c.endOffset),a=d.toString().length}return a},setOffset:function(a,b){"undefined"==typeof b&&(b=a),this.focus.isFocused()||this.focus.setStart();for(var c,d=(this.selection.get(),0),e=document.createTreeWalker(this.$editor[0],NodeFilter.SHOW_TEXT,null,null);c=e.nextNode();)if(d+=c.nodeValue.length,d>a&&(this.range.setStart(c,c.nodeValue.length+a-d),a=1/0),d>=b){this.range.setEnd(c,c.nodeValue.length+b-d);break}this.range.collapse(!1),this.selection.addRange()},setToPoint:function(a,b){this.caret.setOffset(a,b)},getCoords:function(){return this.caret.getOffset()}}},clean:function(){return{onSet:function(b){b=this.clean.savePreCode(b),b=b.replace(/<script(.*?[^>]?)>([\w\W]*?)<\/script>/gi,'<pre class="redactor-script-tag" style="display: none;" $1>$2</pre>'),b=b.replace(/<a href="(.*?[^>]?)®(.*?[^>]?)">/gi,'<a href="$1&reg$2">'),this.opts.replaceDivs&&(b=this.clean.replaceDivs(b)),this.opts.linebreaks&&(b=this.clean.replaceParagraphsToBr(b)),b=this.clean.saveFormTags(b);var c=a("<div>");c.html(b);var d=c.find("font[style]");return 0!==d.length&&(d.replaceWith(function(){var b=a(this),c=a("<span>").attr("style",b.attr("style"));return c.append(b.contents())}),b=c.html()),c.remove(),b=b.replace(/<font(.*?[^<])>/gi,""),b=b.replace(/<\/font>/gi,""),b=this.tidy.load(b),this.opts.paragraphize&&(b=this.paragraphize.load(b)),b=this.clean.setVerified(b),b=this.clean.convertInline(b)},onSync:function(b){if(b=b.replace(/[\u200B-\u200D\uFEFF]/g,""),b=b.replace(/&#x200b;/gi,""),this.opts.cleanSpaces&&(b=b.replace(/&nbsp;/gi," ")),-1!=b.search(/^<p>(||\s||<br\s?\/?>||&nbsp;)<\/p>$/i))return"";b=b.replace(/<pre class="redactor-script-tag" style="display: none;"(.*?[^>]?)>([\w\W]*?)<\/pre>/gi,"<script$1>$2</script>"),b=this.clean.restoreFormTags(b);var c={"™":"&trade;","©":"&copy;","…":"&hellip;","—":"&mdash;","‐":"&dash;"};return a.each(c,function(a,c){b=b.replace(new RegExp(a,"g"),c)}),b=b.replace(new RegExp("<br\\s?/?></li>","gi"),"</li>"),b=b.replace(new RegExp("</li><br\\s?/?>","gi"),"</li>"),b=b.replace(/<div(.*?[^>]) data-tagblock="redactor"(.*?[^>])>/gi,"<div$1$2>"),b=b.replace(/<(.*?) data-verified="redactor"(.*?[^>])>/gi,"<$1$2>"),b=b.replace(/<span(.*?[^>])\srel="(.*?[^>])"(.*?[^>])>/gi,"<span$1$3>"),b=b.replace(/<img(.*?[^>])\srel="(.*?[^>])"(.*?[^>])>/gi,"<img$1$3>"),b=b.replace(/<img(.*?[^>])\sstyle="" (.*?[^>])>'/gi,"<img$1 $2>"),b=b.replace(/<img(.*?[^>])\sstyle (.*?[^>])>'/gi,"<img$1 $2>"),b=b.replace(/<span class="redactor-invisible-space">(.*?)<\/span>/gi,"$1"),b=b.replace(/ data-save-url="(.*?[^>])"/gi,""),
b=b.replace(/<span(.*?)id="redactor-image-box"(.*?[^>])>([\w\W]*?)<img(.*?)><\/span>/gi,"$3<img$4>"),b=b.replace(/<span(.*?)id="redactor-image-resizer"(.*?[^>])>(.*?)<\/span>/gi,""),b=b.replace(/<span(.*?)id="redactor-image-editter"(.*?[^>])>(.*?)<\/span>/gi,""),b=b.replace(/<font(.*?[^<])>/gi,""),b=b.replace(/<\/font>/gi,""),b=this.tidy.load(b),this.opts.linkNofollow&&(b=b.replace(/<a(.*?)rel="nofollow"(.*?[^>])>/gi,"<a$1$2>"),b=b.replace(/<a(.*?[^>])>/gi,'<a$1 rel="nofollow">')),b=b.replace(/\sdata-redactor-(tag|class|style)="(.*?[^>])"/gi,""),b=b.replace(new RegExp('<(.*?) data-verified="redactor"(.*?[^>])>',"gi"),"<$1$2>"),b=b.replace(new RegExp('<(.*?) data-verified="redactor">',"gi"),"<$1>")},onPaste:function(b,c){if(b=a.trim(b),b=b.replace(/<span class="s1">/gi,"<span>"),b=b.replace(/<span class="Apple-converted-space">&nbsp;<\/span>/gi," "),b=b.replace(/<span class="Apple-tab-span"[^>]*>\t<\/span>/gi,"	"),b=b.replace(/<span[^>]*>(\s|&nbsp;)<\/span>/gi," "),this.opts.pastePlainText)return this.clean.getPlainText(b);if(!this.utils.isSelectAll()&&"undefined"==typeof c){if(this.utils.isCurrentOrParent(["FIGCAPTION","A"]))return this.clean.getPlainText(b,!1);if(this.utils.isCurrentOrParent("PRE"))return b=b.replace(/”/g,'"'),b=b.replace(/“/g,'"'),b=b.replace(/‘/g,"'"),b=b.replace(/’/g,"'"),this.clean.getPreCode(b);if(this.utils.isCurrentOrParent(["BLOCKQUOTE","H1","H2","H3","H4","H5","H6"])){if(b=this.clean.getOnlyImages(b),!this.utils.browser("msie")){var d=this.selection.getBlock();d&&"P"==d.tagName&&(b=b.replace(/<img(.*?)>/gi,"<p><img$1></p>"))}return b}if(this.utils.isCurrentOrParent(["TD"]))return b=this.clean.onPasteTidy(b,"td"),this.opts.linebreaks&&(b=this.clean.replaceParagraphsToBr(b)),b=this.clean.replaceDivsToBr(b);if(this.utils.isCurrentOrParent(["LI"]))return this.clean.onPasteTidy(b,"li")}return b=this.clean.isSingleLine(b,c),this.clean.singleLine||(this.opts.linebreaks&&(b=this.clean.replaceParagraphsToBr(b)),this.opts.replaceDivs&&(b=this.clean.replaceDivs(b)),b=this.clean.saveFormTags(b)),b=this.clean.onPasteWord(b),b=this.clean.onPasteExtra(b),b=this.clean.onPasteTidy(b,"all"),!this.clean.singleLine&&this.opts.paragraphize&&(b=this.paragraphize.load(b)),b=this.clean.removeDirtyStyles(b),b=this.clean.onPasteRemoveSpans(b),b=this.clean.onPasteRemoveEmpty(b),b=this.clean.convertInline(b)},onPasteWord:function(a){return a=a.replace(/<!--[\s\S]*?-->/gi,""),a=a.replace(/<style[^>]*>[\s\S]*?<\/style>/gi,""),/(class=\"?Mso|style=\"[^\"]*\bmso\-|w:WordDocument)/.test(a)&&(a=this.clean.onPasteIeFixLinks(a),a=a.replace(/<img(.*?)v:shapes=(.*?)>/gi,""),a=a.replace(/src="file\:\/\/(.*?)"/,'src=""'),a=a.replace(/<p(.*?)class="MsoListParagraphCxSpFirst"([\w\W]*?)<\/p>/gi,"<ul><li$2</li>"),a=a.replace(/<p(.*?)class="MsoListParagraphCxSpMiddle"([\w\W]*?)<\/p>/gi,"<li$2</li>"),a=a.replace(/<p(.*?)class="MsoListParagraphCxSpLast"([\w\W]*?)<\/p>/gi,"<li$2</li></ul>"),a=a.replace(/<p(.*?)class="MsoListParagraph"([\w\W]*?)<\/p>/gi,"<ul><li$2</li></ul>"),a=a.replace(/·/g,""),a=a.replace(/<p class="Mso(.*?)"/gi,"<p"),a=a.replace(/ class=\"(mso[^\"]*)\"/gi,""),a=a.replace(/ class=(mso\w+)/gi,""),a=a.replace(/<o:p(.*?)>([\w\W]*?)<\/o:p>/gi,"$2"),a=a.replace(/\n/g," "),a=a.replace(/<p>\n?<li>/gi,"<li>")),this.opts.cleanSpaces&&(a=a.replace(/(\s|&nbsp;)+/g," ")),a},onPasteExtra:function(a){return a=a.replace(/<b\sid="internal-source-marker(.*?)">([\w\W]*?)<\/b>/gi,"$2"),a=a.replace(/<b(.*?)id="docs-internal-guid(.*?)">([\w\W]*?)<\/b>/gi,"$3"),a=a.replace(/<span[^>]*(font-style: italic; font-weight: bold|font-weight: bold; font-style: italic)[^>]*>/gi,'<span style="font-weight: bold;"><span style="font-style: italic;">'),a=a.replace(/<span[^>]*font-style: italic[^>]*>/gi,'<span style="font-style: italic;">'),a=a.replace(/<span[^>]*font-weight: bold[^>]*>/gi,'<span style="font-weight: bold;">'),a=a.replace(/<span[^>]*text-decoration: underline[^>]*>/gi,'<span style="text-decoration: underline;">'),a=a.replace(/<img>/gi,""),a=a.replace(/\n{3,}/gi,"\n"),a=a.replace(/<font(.*?)>([\w\W]*?)<\/font>/gi,"$2"),a=a.replace(/<p><p>/gi,"<p>"),a=a.replace(/<\/p><\/p>/gi,"</p>"),a=a.replace(/<li>(\s*|\t*|\n*)<p>/gi,"<li>"),a=a.replace(/<\/p>(\s*|\t*|\n*)<\/li>/gi,"</li>"),a=a.replace(/<\/p>\s<p/gi,"</p><p"),a=a.replace(/<img src="webkit-fake-url\:\/\/(.*?)"(.*?)>/gi,""),a=a.replace(/<p>•([\w\W]*?)<\/p>/gi,"<li>$1</li>"),this.utils.browser("mozilla")&&(a=a.replace(/<br\s?\/?>$/gi,"")),a},onPasteTidy:function(a,b){var c=["span","a","pre","blockquote","small","em","strong","code","kbd","mark","address","cite","var","samp","dfn","sup","sub","b","i","u","del","ol","ul","li","dl","dt","dd","p","br","video","audio","iframe","embed","param","object","img","table","td","th","tr","tbody","tfoot","thead","h1","h2","h3","h4","h5","h6"],d=!1,e=[["a","*"],["img",["src","alt"]],["span",["class","rel","data-verified"]],["iframe","*"],["video","*"],["audio","*"],["embed","*"],["object","*"],["param","*"],["source","*"]];"all"==b?(d=["p","span","h1","h2","h3","h4","h5","h6"],e=[["table","class"],["td",["colspan","rowspan"]],["a","*"],["img",["src","alt","data-redactor-inserted-image"]],["span",["class","rel","data-verified"]],["iframe","*"],["video","*"],["audio","*"],["embed","*"],["object","*"],["param","*"],["source","*"]]):"td"==b?c=["table","tr","td","tbody","thead","tfoot","colgroup","col","caption","ul","ol","li","span","a","small","em","strong","code","kbd","mark","cite","var","samp","dfn","sup","sub","b","i","u","del","ol","ul","li","dl","dt","dd","br","iframe","video","audio","embed","param","object","img","h1","h2","h3","h4","h5","h6"]:"li"==b&&(c=["ul","ol","li","span","a","small","em","strong","code","kbd","mark","cite","var","samp","dfn","sup","sub","b","i","u","del","br","iframe","video","audio","embed","param","object","img"]);var f={deniedTags:this.opts.deniedTags?this.opts.deniedTags:!1,allowedTags:this.opts.allowedTags?this.opts.allowedTags:c,removeComments:!0,removePhp:!0,removeAttr:this.opts.removeAttr?this.opts.removeAttr:!1,allowedAttr:this.opts.allowedAttr?this.opts.allowedAttr:e,removeEmpty:d};return this.tidy.load(a,f)},onPasteRemoveEmpty:function(a){return a=a.replace(/<(p|h[1-6])>(|\s|\n|\t|<br\s?\/?>)<\/(p|h[1-6])>/gi,""),this.opts.linebreaks||(a=a.replace(/<br>$/i,"")),a},onPasteRemoveSpans:function(a){return a=a.replace(/<span>(.*?)<\/span>/gi,"$1"),a=a.replace(/<span[^>]*>\s|&nbsp;<\/span>/gi," ")},onPasteIeFixLinks:function(b){if(!this.utils.browser("msie"))return b;var c=a.trim(b);return 0===c.search(/^<a(.*?)>(.*?)<\/a>$/i)&&(b=b.replace(/^<a(.*?)>(.*?)<\/a>$/i,"$2")),b},isSingleLine:function(a,b){if(this.clean.singleLine=!1,!this.utils.isSelectAll()&&"undefined"==typeof b){var c=this.opts.blockLevelElements.join("|").replace("P|","").replace("DIV|",""),d=a.match(new RegExp("</("+c+")>","gi")),e=a.match(/<\/(p|div)>/gi);if(!d&&(null===e||e&&e.length<=1)){var f=a.match(/<br\s?\/?>/gi),g=a.match(/<img(.*?[^>])>/gi);f||g||(this.clean.singleLine=!0,a=a.replace(/<\/?(p|div)(.*?)>/gi,""))}}return a},stripTags:function(a,b){b=(((b||"")+"").toLowerCase().match(/<[a-z][a-z0-9]*>/g)||[]).join("");var c=/<\/?([a-z][a-z0-9]*)\b[^>]*>/gi;return a.replace(c,function(a,c){return b.indexOf("<"+c.toLowerCase()+">")>-1?a:""})},savePreCode:function(a){return a=this.clean.savePreFormatting(a),a=this.clean.saveCodeFormatting(a)},savePreFormatting:function(b){var c=b.match(/<pre(.*?)>([\w\W]*?)<\/pre>/gi);return null!==c&&a.each(c,a.proxy(function(a,c){var d=c.match(/<pre(.*?)>([\w\W]*?)<\/pre>/i);d[2]=d[2].replace(/<br\s?\/?>/g,"\n"),d[2]=d[2].replace(/&nbsp;/g," "),this.opts.preSpaces&&(d[2]=d[2].replace(/\t/g,Array(this.opts.preSpaces+1).join(" "))),d[2]=this.clean.encodeEntities(d[2]),d[2]=d[2].replace(/\$/g,"&#36;"),b=b.replace(c,"<pre"+d[1]+">"+d[2]+"</pre>")},this)),b},saveCodeFormatting:function(b){var c=b.match(/<code(.*?[^>])>(.*?)<\/code>/gi);return null!==c&&a.each(c,a.proxy(function(a,c){var d=c.match(/<code(.*?[^>])>(.*?)<\/code>/i);d[2]=d[2].replace(/&nbsp;/g," "),d[2]=this.clean.encodeEntities(d[2]),d[2]=d[2].replace(/\$/g,"&#36;"),b=b.replace(c,"<code"+d[1]+">"+d[2]+"</code>")},this)),b},getTextFromHtml:function(b){b=b.replace(/<br\s?\/?>|<\/H[1-6]>|<\/p>|<\/div>|<\/li>|<\/td>/gi,"\n");var c=document.createElement("div");return c.innerHTML=b,b=c.textContent||c.innerText,a.trim(b)},getPlainText:function(a,b){return a=this.clean.getTextFromHtml(a),a=a.replace(/\n/g,"<br />"),this.opts.paragraphize&&"undefined"==typeof b&&!this.utils.browser("mozilla")&&(a=this.paragraphize.load(a)),a},getPreCode:function(a){return a=a.replace(/<img(.*?) style="(.*?)"(.*?[^>])>/gi,"<img$1$3>"),a=a.replace(/<img(.*?)>/gi,"&lt;img$1&gt;"),a=this.clean.getTextFromHtml(a),this.opts.preSpaces&&(a=a.replace(/\t/g,Array(this.opts.preSpaces+1).join(" "))),a=this.clean.encodeEntities(a)},getOnlyImages:function(a){return a=a.replace(/<img(.*?)>/gi,"[img$1]"),a=a.replace(/<([Ss]*?)>/gi,""),a=a.replace(/\[img(.*?)\]/gi,"<img$1>")},getOnlyLinksAndImages:function(a){return a=a.replace(/<a(.*?)href="(.*?)"(.*?)>([\w\W]*?)<\/a>/gi,'[a href="$2"]$4[/a]'),a=a.replace(/<img(.*?)>/gi,"[img$1]"),a=a.replace(/<(.*?)>/gi,""),a=a.replace(/\[a href="(.*?)"\]([\w\W]*?)\[\/a\]/gi,'<a href="$1">$2</a>'),a=a.replace(/\[img(.*?)\]/gi,"<img$1>")},encodeEntities:function(a){return a=String(a).replace(/&amp;/g,"&").replace(/&lt;/g,"<").replace(/&gt;/g,">").replace(/&quot;/g,'"'),a.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;")},removeDirtyStyles:function(b){if(this.utils.browser("msie"))return b;var c=document.createElement("div");return c.innerHTML=b,this.clean.clearUnverifiedRemove(a(c)),b=c.innerHTML,a(c).remove(),b},clearUnverified:function(){if(!this.utils.browser("msie")){this.clean.clearUnverifiedRemove(this.$editor);var a=this.$editor.find("h1, h2, h3, h4, h5, h6");a.find("span").removeAttr("style"),a.find(this.opts.verifiedTags.join(", ")).removeAttr("style"),this.code.sync()}},clearUnverifiedRemove:function(b){b.find(this.opts.verifiedTags.join(", ")).removeAttr("style"),b.find("span").not('[data-verified="redactor"]').removeAttr("style"),b.find('span[data-verified="redactor"], img[data-verified="redactor"]').each(function(b,c){var d=a(c);d.attr("style",d.attr("rel"))})},cleanEmptyParagraph:function(){var a=this.$editor.find("p").first();this.utils.isEmpty(a.html())&&a.remove()},setVerified:function(a){if(this.utils.browser("msie"))return a;a=a.replace(new RegExp("<img(.*?[^>])>","gi"),'<img$1 data-verified="redactor">'),a=a.replace(new RegExp("<span(.*?[^>])>","gi"),'<span$1 data-verified="redactor">');var b=a.match(new RegExp('<(span|img)(.*?)style="(.*?)"(.*?[^>])>',"gi"));if(b)for(var c=b.length,d=0;c>d;d++)try{var e=b[d].replace(/style="(.*?)"/i,'style="$1" rel="$1"');a=a.replace(b[d],e)}catch(f){}return a},convertInline:function(b){var c=a("<div />").html(b),d=this.opts.inlineTags;return d.push("span"),c.find(d.join(",")).each(function(){var b=a(this),c=this.tagName.toLowerCase();b.attr("data-redactor-tag",c),"span"==c&&(b.attr("style")?b.attr("data-redactor-style",b.attr("style")):b.attr("class")&&b.attr("data-redactor-class",b.attr("class")))}),b=c.html(),c.remove(),b},normalizeLists:function(){this.$editor.find("li").each(function(b,c){var d=a(c).next();0===d.length||"UL"!=d[0].tagName&&"OL"!=d[0].tagName||a(c).append(d)})},removeSpaces:function(a){return a=a.replace(/\n/g,""),a=a.replace(/[\t]*/g,""),a=a.replace(/\n\s*\n/g,"\n"),a=a.replace(/^[\s\n]*/g," "),a=a.replace(/[\s\n]*$/g," "),a=a.replace(/>\s{2,}</g,"> <"),a=a.replace(/\n\n/g,"\n"),a=a.replace(/[\u200B-\u200D\uFEFF]/g,"")},replaceDivs:function(a){return this.opts.linebreaks?(a=a.replace(/<div><br\s?\/?><\/div>/gi,"<br />"),a=a.replace(/<div(.*?)>([\w\W]*?)<\/div>/gi,"$2<br />")):a=a.replace(/<div(.*?)>([\w\W]*?)<\/div>/gi,"<p$1>$2</p>"),a=a.replace(/<div(.*?[^>])>/gi,""),a=a.replace(/<\/div>/gi,"")},replaceDivsToBr:function(a){return a=a.replace(/<div\s(.*?)>/gi,"<p>"),a=a.replace(/<div><br\s?\/?><\/div>/gi,"<br /><br />"),a=a.replace(/<div>([\w\W]*?)<\/div>/gi,"$1<br /><br />")},replaceParagraphsToBr:function(a){return a=a.replace(/<p\s(.*?)>/gi,"<p>"),a=a.replace(/<p><br\s?\/?><\/p>/gi,"<br />"),a=a.replace(/<p>([\w\W]*?)<\/p>/gi,"$1<br /><br />"),a=a.replace(/(<br\s?\/?>){1,}\n?<\/blockquote>/gi,"</blockquote>")},saveFormTags:function(a){return a.replace(/<form(.*?)>([\w\W]*?)<\/form>/gi,'<section$1 rel="redactor-form-tag">$2</section>')},restoreFormTags:function(a){return a.replace(/<section(.*?) rel="redactor-form-tag"(.*?)>([\w\W]*?)<\/section>/gi,"<form$1$2>$3</form>")}}},code:function(){return{set:function(b){b=a.trim(b.toString()),b=this.clean.onSet(b),this.$editor.html(b),this.code.sync(),""!==b&&this.placeholder.remove(),setTimeout(a.proxy(this.buffer.add,this),15),this.start===!1&&this.observe.load()},get:function(){var a=this.$textarea.val();return a=this.tabifier.get(a)},sync:function(){setTimeout(a.proxy(this.code.startSync,this),10)},startSync:function(){var a=this.$editor.html();this.code.syncCode&&this.code.syncCode==a||(this.code.syncCode=a,a=this.core.setCallback("syncBefore",a),a=this.clean.onSync(a),this.$textarea.val(a),this.core.setCallback("sync",a),this.start===!1&&this.core.setCallback("change",a),this.start=!1,0==this.autosave.html&&(this.autosave.html=this.code.get()),this.opts.codemirror&&this.$textarea.next(".CodeMirror").each(function(b,c){c.CodeMirror.setValue(a)}),this.autosave.onChange(),this.autosave.enable())},toggle:function(){this.opts.visual?this.code.showCode():this.code.showVisual()},showCode:function(){this.code.offset=this.caret.getOffset();var b=a(window).scrollTop(),c=this.$editor.innerWidth(),d=this.$editor.innerHeight();this.$editor.hide();var e=this.$textarea.val();this.modified=this.clean.removeSpaces(e),e=this.tabifier.get(e),this.$textarea.val(e),this.opts.codemirror?this.$textarea.next(".CodeMirror").each(function(b,f){a(f).show(),f.CodeMirror.setValue(e),f.CodeMirror.setSize(c,d),f.CodeMirror.refresh(),f.CodeMirror.focus()}):(this.$textarea.height(d).show().focus(),this.$textarea.on("keydown.redactor-textarea-indenting",this.code.textareaIndenting),a(window).scrollTop(b),this.$textarea[0].setSelectionRange&&this.$textarea[0].setSelectionRange(0,0),this.$textarea[0].scrollTop=0),this.opts.visual=!1,this.button.setInactiveInCode(),this.button.setActive("html"),this.core.setCallback("source",e)},showVisual:function(){var a;this.opts.visual||(this.opts.codemirror?this.$textarea.next(".CodeMirror").each(function(b,c){a=c.CodeMirror.getValue()}):a=this.$textarea.hide().val(),this.modified!==this.clean.removeSpaces(a)&&this.code.set(a),this.opts.codemirror&&this.$textarea.next(".CodeMirror").hide(),this.$editor.show(),this.utils.isEmpty(a)||this.placeholder.remove(),this.caret.setOffset(this.code.offset),this.$textarea.off("keydown.redactor-textarea-indenting"),this.button.setActiveInVisual(),this.button.setInactive("html"),this.observe.load(),this.opts.visual=!0,this.core.setCallback("visual",a))},textareaIndenting:function(a){if(9!==a.keyCode)return!0;var b=this.$textarea,c=b.get(0).selectionStart;return b.val(b.val().substring(0,c)+"	"+b.val().substring(b.get(0).selectionEnd)),b.get(0).selectionStart=b.get(0).selectionEnd=c+1,!1}}},core:function(){return{getObject:function(){return a.extend({},this)},getEditor:function(){return this.$editor},getBox:function(){return this.$box},getElement:function(){return this.$element},getTextarea:function(){return this.$textarea},getToolbar:function(){return this.$toolbar?this.$toolbar:!1},addEvent:function(a){this.core.event=a},getEvent:function(){return this.core.event},setCallback:function(b,c,d){var e=this.opts[b+"Callback"];return a.isFunction(e)?"undefined"==typeof d?e.call(this,c):e.call(this,c,d):"undefined"==typeof d?c:d},destroy:function(){this.core.setCallback("destroy"),this.$element.off(".redactor").off(".redactor-api").removeData("redactor"),a(document).off(".redactor").off(".redactor-image-resize-hide").off(".redactor-image-delete").off(".redactor-media-resize-hide"),this.$editor.off(".redactor").off(".redactor-image-resize-hide").off(".redactor-image-delete").off(".redactor-media-resize-hide"),a(document).off("click.redactor-image-delete."+this.uuid),a(document).off("click.redactor-image-resize-hide."+this.uuid),a(document).off("touchstart.redactor."+this.uuid+" click.redactor."+this.uuid),a("body").off("scroll.redactor."+this.uuid),a(this.opts.toolbarFixedTarget).off("scroll.redactor."+this.uuid),this.$editor.removeClass("redactor-editor redactor-linebreaks redactor-placeholder"),this.$editor.removeAttr("contenteditable");var b=this.code.get();this.$toolbar.find("a").each(function(){var b=a(this);b.data("dropdown")&&(b.data("dropdown").remove(),b.data("dropdown",{}))}),this.build.isTextarea()?(this.$box.after(this.$element),this.$box.remove(),this.$element.val(b).show()):(this.$box.after(this.$editor),this.$box.remove(),this.$element.html(b).show()),this.$pasteBox&&this.$pasteBox.remove(),this.modal.close(),this.$modalBox&&this.$modalBox.remove(),this.$modalOverlay&&this.$modalOverlay.remove(),this.dropdown.hideAll(),a(".redactor-dropdown").remove(),a(".redactor-toolbar-tooltip").remove(),clearInterval(this.autosaveInterval)}}},dropdown:function(){return{build:function(b,c,d){"formatting"==b&&this.opts.formattingAdd&&a.each(this.opts.formattingAdd,a.proxy(function(a,b){var c,e=b.tag;"undefined"!=typeof b["class"]&&(e=e+"-"+b["class"]),b.type=this.utils.isBlockTag(b.tag)?"block":"inline",c="undefined"!=typeof b.func?b.func:"inline"==b.type?"inline.formatting":"block.formatting",this.opts.linebreaks&&"block"==b.type&&"p"==b.tag||(this.formatting[e]={tag:b.tag,style:b.style,"class":b["class"],attr:b.attr,data:b.data,clear:b.clear},d[e]={func:c,title:b.title})},this)),a.each(d,a.proxy(function(d,e){var f=a('<a href="#" class="redactor-dropdown-'+d+'">'+e.title+"</a>");"formatting"==b&&f.addClass("redactor-formatting-"+d),f.on("click",a.proxy(function(a){a.preventDefault();var b="func",c=e.func;e.command?(b="command",c=e.command):e.dropdown&&(b="dropdown",c=e.dropdown),this.button.onClick(a,d,b,c),this.dropdown.hideAll()},this)),c.append(f)},this))},show:function(b,c){function d(){var b=a("<div>").css({visibility:"hidden",width:100,overflow:"scroll"}).appendTo("body"),c=a("<div>").css({width:"100%"}).appendTo(b).outerWidth();return b.remove(),100-c}var e=this.button.get(c),f=e.data("dropdown").appendTo(document.body);if(this.utils.isMobile()&&!this.utils.browser("msie")&&document.activeElement.blur(),e.hasClass("dropact"))this.dropdown.hideAll();else{this.dropdown.hideAll(),this.core.setCallback("dropdownShow",{dropdown:f,key:c,button:e}),this.button.setActive(c),e.addClass("dropact");var g=e.offset(),h=f.width();g.left+h>a(document).width()&&(g.left=Math.max(0,g.left-h));var i=g.left+"px";if(this.$toolbar.hasClass("toolbar-fixed-box")){var j=this.$toolbar.innerHeight()+this.opts.toolbarFixedTopOffset,k="fixed";this.opts.toolbarFixedTarget!==document&&(j=this.$toolbar.innerHeight()+this.$toolbar.offset().top+this.opts.toolbarFixedTopOffset,k="absolute"),f.css({position:k,left:i,top:j+"px"}).show()}else{var j=e.innerHeight()+g.top+"px";f.css({position:"absolute",left:i,top:j}).show()}this.core.setCallback("dropdownShown",{dropdown:f,key:c,button:e})}a(document).one("click.redactor",a.proxy(this.dropdown.hide,this)),this.$editor.one("click",a.proxy(this.dropdown.hide,this));var l=a(document.body),m=d();f.on("mouseover",function(){l.addClass("body-redactor-hidden"),l.css("margin-right",m+"px")}),f.on("mouseout",function(){l.removeClass("body-redactor-hidden").css("margin-right",0)}),b.stopPropagation()},hideAll:function(){this.$toolbar.find("a.dropact").removeClass("redactor-act").removeClass("dropact"),a(document.body).removeClass("body-redactor-hidden").css("margin-right",0),a(".redactor-dropdown-"+this.uuid).hide(),this.core.setCallback("dropdownHide")},hide:function(b){var c=a(b.target);c.hasClass("dropact")||(c.removeClass("dropact"),this.dropdown.hideAll())}}},file:function(){return{show:function(){this.modal.load("file",this.lang.get("file"),700),this.upload.init("#redactor-modal-file-upload",this.opts.fileUpload,this.file.insert),this.selection.save(),this.selection.get();var b=this.sel.toString();a("#redactor-filename").val(b),this.modal.show()},insert:function(b,c,d){if("undefined"!=typeof b.error)return this.modal.close(),this.selection.restore(),void this.core.setCallback("fileUploadError",b);var e;if("string"==typeof b)e=b;else{var f=a("#redactor-filename").val();("undefined"==typeof f||""===f)&&(f=b.filename),e='<a href="'+b.filelink+'" id="filelink-marker">'+f+"</a>"}if(c){this.selection.removeMarkers();var g=this.selection.getMarker();this.insert.nodeToCaretPositionFromPoint(d,g)}else this.modal.close();if(this.selection.restore(),this.buffer.set(),this.insert.htmlWithoutClean(e),"string"!=typeof b){var h=a(this.$editor.find("a#filelink-marker"));0!==h.length?h.removeAttr("id").removeAttr("style"):h=!1,this.core.setCallback("fileUpload",h,b)}}}},focus:function(){return{setStart:function(){this.$editor.focus();var a=this.$editor.children().first();if(0!==a.length&&0!==a[0].length&&"BR"!=a[0].tagName&&3!=a[0].nodeType){if("UL"==a[0].tagName||"OL"==a[0].tagName){var b=a.find("li").first();if(!this.utils.isBlock(b)&&""===b.text())return void this.caret.setStart(b)}return this.opts.linebreaks&&!this.utils.isBlockTag(a[0].tagName)?(this.selection.get(),this.range.setStart(this.$editor[0],0),this.range.setEnd(this.$editor[0],0),void this.selection.addRange()):void this.caret.setStart(a)}},setEnd:function(){if(this.utils.browser("mozilla")||this.utils.browser("msie")){var a=this.$editor.children().last();this.$editor.focus(),this.caret.setEnd(a)}else{this.selection.get();try{this.range.selectNodeContents(this.$editor[0]),this.range.collapse(!1),this.selection.addRange()}catch(b){}}},isFocused:function(){var b=document.getSelection().focusNode;return null===b?!1:this.opts.linebreaks&&a(b.parentNode).hasClass("redactor-linebreaks")?!0:this.utils.isRedactorParent(b.parentNode)?this.$editor.is(":focus"):!1}}},image:function(){return{show:function(){this.modal.load("image",this.lang.get("image"),700),this.upload.init("#redactor-modal-image-droparea",this.opts.imageUpload,this.image.insert),this.selection.save(),this.modal.show()},showEdit:function(b){var c=b.closest("a",this.$editor[0]);if(this.modal.load("imageEdit",this.lang.get("edit"),705),this.modal.createCancelButton(),this.image.buttonDelete=this.modal.createDeleteButton(this.lang.get("_delete")),this.image.buttonSave=this.modal.createActionButton(this.lang.get("save")),this.image.buttonDelete.on("click",a.proxy(function(){this.image.remove(b)},this)),this.image.buttonSave.on("click",a.proxy(function(){this.image.update(b)},this)),a("#redactor-image-title").val(b.attr("alt")),this.opts.imageLink){var d=a("#redactor-image-link");d.attr("href",b.attr("src")),0!==c.length&&(d.val(c.attr("href")),"_blank"==c.attr("target")&&a("#redactor-image-link-blank").prop("checked",!0))}else a(".redactor-image-link-option").hide();if(this.opts.imagePosition){var e="block"==b.css("display")&&"none"==b.css("float")?"center":b.css("float");a("#redactor-image-align").val(e)}else a(".redactor-image-position-option").hide();this.modal.show()},setFloating:function(b){var c=a("#redactor-image-align").val(),d="",e="",f="";switch(c){case"left":d="left",f="0 "+this.opts.imageFloatMargin+" "+this.opts.imageFloatMargin+" 0";break;case"right":d="right",f="0 0 "+this.opts.imageFloatMargin+" "+this.opts.imageFloatMargin;break;case"center":e="block",f="auto"}b.css({"float":d,display:e,margin:f}),b.attr("rel",b.attr("style"))},update:function(b){this.image.hideResize(),this.buffer.set();var c=b.closest("a",this.$editor[0]);b.attr("alt",a("#redactor-image-title").val()),this.image.setFloating(b);var d=a.trim(a("#redactor-image-link").val());if(""!==d){var e="((xn--)?[a-z0-9]+(-[a-z0-9]+)*\\.)+[a-z]{2,}",f=new RegExp("^(http|ftp|https)://"+e,"i"),g=new RegExp("^"+e,"i");-1==d.search(f)&&0===d.search(g)&&this.opts.linkProtocol&&(d=this.opts.linkProtocol+"://"+d);var h=a("#redactor-image-link-blank").prop("checked")?!0:!1;if(0===c.length){var i=a('<a href="'+d+'">'+this.utils.getOuterHtml(b)+"</a>");h&&i.attr("target","_blank"),b.replaceWith(i)}else c.attr("href",d),h?c.attr("target","_blank"):c.removeAttr("target")}else 0!==c.length&&c.replaceWith(this.utils.getOuterHtml(b));this.modal.close(),this.observe.images(),this.code.sync()},setEditable:function(b){this.opts.imageEditable&&b.on("dragstart",a.proxy(this.image.onDrag,this)),b.on("mousedown",a.proxy(this.image.hideResize,this)),b.on("click.redactor touchstart",a.proxy(function(c){return this.observe.image=b,0!==this.$editor.find("#redactor-image-box").length?!1:(this.image.resizer=this.image.loadEditableControls(b),a(document).on("click.redactor-image-resize-hide."+this.uuid,a.proxy(this.image.hideResize,this)),this.$editor.on("click.redactor-image-resize-hide."+this.uuid,a.proxy(this.image.hideResize,this)),void(this.opts.imageResizable&&this.image.resizer.on("mousedown.redactor touchstart.redactor",a.proxy(function(a){this.image.setResizable(a,b)},this))))},this))},setResizable:function(a,b){a.preventDefault(),this.image.resizeHandle={x:a.pageX,y:a.pageY,el:b,ratio:b.width()/b.height(),h:b.height()},a=a.originalEvent||a,a.targetTouches&&(this.image.resizeHandle.x=a.targetTouches[0].pageX,this.image.resizeHandle.y=a.targetTouches[0].pageY),this.image.startResize()},startResize:function(){a(document).on("mousemove.redactor-image-resize touchmove.redactor-image-resize",a.proxy(this.image.moveResize,this)),a(document).on("mouseup.redactor-image-resize touchend.redactor-image-resize",a.proxy(this.image.stopResize,this))},moveResize:function(a){a.preventDefault(),a=a.originalEvent||a;var b=this.image.resizeHandle.h;b+=a.targetTouches?a.targetTouches[0].pageY-this.image.resizeHandle.y:a.pageY-this.image.resizeHandle.y;var c=Math.round(b*this.image.resizeHandle.ratio);if(!(50>b||100>c)){var b=Math.round(this.image.resizeHandle.el.width()/this.image.resizeHandle.ratio);this.image.resizeHandle.el.attr({width:c,height:b}),this.image.resizeHandle.el.width(c),this.image.resizeHandle.el.height(b),this.code.sync()}},stopResize:function(){this.handle=!1,a(document).off(".redactor-image-resize"),this.image.hideResize()},onDrag:function(b){return 0!==this.$editor.find("#redactor-image-box").length?(b.preventDefault(),!1):void this.$editor.on("drop.redactor-image-inside-drop",a.proxy(function(){setTimeout(a.proxy(this.image.onDrop,this),1)},this))},onDrop:function(){this.image.fixImageSourceAfterDrop(),this.observe.images(),this.$editor.off("drop.redactor-image-inside-drop"),this.clean.clearUnverified(),this.code.sync()},fixImageSourceAfterDrop:function(){this.$editor.find("img[data-save-url]").each(function(){var b=a(this);b.attr("src",b.attr("data-save-url")),b.removeAttr("data-save-url")})},hideResize:function(b){if(!b||0===a(b.target).closest("#redactor-image-box",this.$editor[0]).length){if(b&&"IMG"==b.target.tagName){var c=a(b.target);c.attr("data-save-url",c.attr("src"))}var d=this.$editor.find("#redactor-image-box");0!==d.length&&(this.opts.imageEditable&&this.image.editter.remove(),a(this.image.resizer).remove(),d.find("img").css({marginTop:d[0].style.marginTop,marginBottom:d[0].style.marginBottom,marginLeft:d[0].style.marginLeft,marginRight:d[0].style.marginRight}),d.css("margin",""),d.find("img").css("opacity",""),d.replaceWith(function(){return a(this).contents()}),a(document).off("click.redactor-image-resize-hide."+this.uuid),this.$editor.off("click.redactor-image-resize-hide."+this.uuid),"undefined"!=typeof this.image.resizeHandle&&this.image.resizeHandle.el.attr("rel",this.image.resizeHandle.el.attr("style")),this.code.sync())}},loadResizableControls:function(b,c){if(this.opts.imageResizable&&!this.utils.isMobile()){var d=a('<span id="redactor-image-resizer" data-redactor="verified"></span>');return this.utils.isDesktop()||d.css({width:"15px",height:"15px"}),d.attr("contenteditable",!1),c.append(d),c.append(b),d}return c.append(b),!1},loadEditableControls:function(b){var c=a('<span id="redactor-image-box" data-redactor="verified">');if(c.css("float",b.css("float")).attr("contenteditable",!1),"auto"!=b[0].style.margin?(c.css({marginTop:b[0].style.marginTop,marginBottom:b[0].style.marginBottom,marginLeft:b[0].style.marginLeft,marginRight:b[0].style.marginRight}),b.css("margin","")):c.css({display:"block",margin:"auto"}),b.css("opacity",".5").after(c),this.opts.imageEditable){this.image.editter=a('<span id="redactor-image-editter" data-redactor="verified">'+this.lang.get("edit")+"</span>"),this.image.editter.attr("contenteditable",!1),this.image.editter.on("click",a.proxy(function(){this.image.showEdit(b)},this)),c.append(this.image.editter);var d=this.image.editter.innerWidth();this.image.editter.css("margin-left","-"+d/2+"px")}return this.image.loadResizableControls(b,c)},remove:function(b){var c=a(b),d=c.closest("a",this.$editor[0]),e=c.closest("figure",this.$editor[0]),f=c.parent();0!==a("#redactor-image-box").length&&(f=a("#redactor-image-box").parent());var g;0!==e.length?(g=e.next(),e.remove()):0!==d.length?(f=d.parent(),d.remove()):c.remove(),a("#redactor-image-box").remove(),this.caret.setStart(0!==e.length?g:f),this.core.setCallback("imageDelete",c[0].src,c),this.modal.close(),this.code.sync()},insert:function(b,c,d){if("undefined"!=typeof b.error)return this.modal.close(),this.selection.restore(),void this.core.setCallback("imageUploadError",b);var e;"string"==typeof b?e=a(b).attr("data-redactor-inserted-image","true"):(e=a("<img>"),e.attr("src",b.filelink).attr("data-redactor-inserted-image","true"));var f=e,g=this.utils.isCurrentOrParent("P");if(g&&(f=a("<blockquote />").append(e)),c){this.selection.removeMarkers();var h=this.selection.getMarker();this.insert.nodeToCaretPositionFromPoint(d,h)}else this.modal.close();this.selection.restore(),this.buffer.set(),this.insert.html(this.utils.getOuterHtml(f),!1);var i=this.$editor.find("img[data-redactor-inserted-image=true]").removeAttr("data-redactor-inserted-image");g?i.parent().contents().unwrap().wrap("<p />"):this.opts.linebreaks&&i.before("<br>").after("<br>"),"string"!=typeof b&&this.core.setCallback("imageUpload",i,b)}}},indent:function(){return{increase:function(){this.utils.browser("msie")||this.$editor.focus(),this.buffer.set(),this.selection.save();var a=this.selection.getBlock();a&&"LI"==a.tagName?this.indent.increaseLists():a===!1&&this.opts.linebreaks?this.indent.increaseText():this.indent.increaseBlocks(),this.selection.restore(),this.code.sync()},increaseLists:function(){document.execCommand("indent"),this.indent.fixEmptyIndent(),this.clean.normalizeLists(),this.clean.clearUnverified()},increaseBlocks:function(){a.each(this.selection.getBlocks(),a.proxy(function(a,b){if("TD"!==b.tagName&&"TH"!==b.tagName){var c=this.utils.getAlignmentElement(b),d=this.utils.normalize(c.css("margin-left"))+this.opts.indentValue;c.css("margin-left",d+"px")}},this))},increaseText:function(){var b=this.selection.wrap("div");a(b).attr("data-tagblock","redactor"),a(b).css("margin-left",this.opts.indentValue+"px")},decrease:function(){this.buffer.set(),this.selection.save();var a=this.selection.getBlock();a&&"LI"==a.tagName?this.indent.decreaseLists():this.indent.decreaseBlocks(),this.selection.restore(),this.code.sync()},decreaseLists:function(){document.execCommand("outdent");var b=this.selection.getCurrent(),c=a(b).closest("li",this.$editor[0]),d=c.parent();0!==c.length&&0!==d.length&&"LI"==d[0].tagName&&d.after(c),this.indent.fixEmptyIndent(),this.opts.linebreaks||0!==c.length||(document.execCommand("formatblock",!1,"p"),this.$editor.find("ul, ol, blockquote, p").each(a.proxy(this.utils.removeEmpty,this))),this.clean.clearUnverified()},decreaseBlocks:function(){a.each(this.selection.getBlocks(),a.proxy(function(a,b){var c=this.utils.getAlignmentElement(b),d=this.utils.normalize(c.css("margin-left"))-this.opts.indentValue;

0>=d?this.opts.linebreaks&&"undefined"!=typeof c.data("tagblock")?c.replaceWith(c.html()+"<br />"):(c.css("margin-left",""),this.utils.removeEmptyAttr(c,"style")):c.css("margin-left",d+"px")},this))},fixEmptyIndent:function(){var b=this.selection.getBlock();if(this.range.collapsed&&b&&"LI"==b.tagName&&this.utils.isEmpty(a(b).text())){var c=a(b);c.find("span").not(".redactor-selection-marker").contents().unwrap(),c.append("<br>")}}}},inline:function(){return{formatting:function(a){var b,c;"undefined"!=typeof this.formatting[a].style?b="style":"undefined"!=typeof this.formatting[a]["class"]&&(b="class"),b&&(c=this.formatting[a][b]),this.inline.format(this.formatting[a].tag,b,c)},format:function(b,c,d){if(!this.utils.isCurrentOrParent("PRE")&&!this.utils.isCurrentOrParentHeader()){for(var e=["b","bold","i","italic","underline","strikethrough","deleted","superscript","subscript"],f=["strong","strong","em","em","u","del","del","sup","sub"],g=0;g<e.length;g++)b==e[g]&&(b=f[g]);if(this.opts.allowedTags){if(-1==a.inArray(b,this.opts.allowedTags))return}else if(-1!==a.inArray(b,this.opts.deniedTags))return;this.inline.type=c||!1,this.inline.value=d||!1,this.buffer.set(),this.utils.browser("msie")||this.$editor.focus(),this.selection.get(),this.range.collapsed?this.inline.formatCollapsed(b):this.inline.formatMultiple(b)}},formatCollapsed:function(b){var c=this.selection.getCurrent(),d=a(c).closest(b+"[data-redactor-tag="+b+"]",this.$editor[0]);if(0!==d.length&&"style"!=this.inline.type&&"SPAN"!=d[0].tagName)return void(this.utils.isEmpty(d.text())?(this.caret.setAfter(d[0]),d.remove(),this.code.sync()):this.utils.isEndOfElement(d)&&this.caret.setAfter(d[0]));var e=a("<"+b+">").attr("data-verified","redactor").attr("data-redactor-tag",b);e.html(this.opts.invisibleSpace),e=this.inline.setFormat(e);var e=this.insert.node(e);this.caret.setEnd(e),this.code.sync()},formatMultiple:function(b){if(this.inline.formatConvert(b),this.selection.save(),document.execCommand("strikethrough"),this.$editor.find("strike").each(a.proxy(function(c,d){var e=a(d);this.inline.formatRemoveSameChildren(e,b);var f;if(this.inline.type?(f=a("<span>").attr("data-redactor-tag",b).attr("data-verified","redactor"),f=this.inline.setFormat(f)):f=a("<"+b+">").attr("data-redactor-tag",b).attr("data-verified","redactor"),e.replaceWith(f.html(e.contents())),"span"==b){var g=f.parent();if(g&&"SPAN"==g[0].tagName&&"style"==this.inline.type)for(var h=this.inline.value.split(";"),i=0;i<h.length;i++){if(""===h[i])return;var j=h[i].split(":");g.css(j[0],""),this.utils.removeEmptyAttr(g,"style")&&g.replaceWith(g.contents())}}},this)),"span"!=b&&this.$editor.find(this.opts.inlineTags.join(", ")).each(a.proxy(function(b,c){var d=a(c),e=d.css("text-decoration");"line-through"==e&&(d.css("text-decoration",""),this.utils.removeEmptyAttr(d,"style"))},this)),"del"!=b){var c=this;this.$editor.find("inline").each(function(a,b){c.utils.replaceToTag(b,"del")})}this.selection.restore(),this.code.sync()},formatRemoveSameChildren:function(b,c){var d=this;b.children(c).each(function(){var b=a(this);if(!b.hasClass("redactor-selection-marker"))if("style"==d.inline.type)for(var c=d.inline.value.split(";"),e=0;e<c.length;e++){if(""===c[e])return;var f=c[e].split(":");b.css(f[0],""),d.utils.removeEmptyAttr(b,"style")&&b.replaceWith(b.contents())}else b.contents().unwrap()})},formatConvert:function(b){this.selection.save();var c="";"class"==this.inline.type?c="[data-redactor-class="+this.inline.value+"]":"style"==this.inline.type&&(c='[data-redactor-style="'+this.inline.value+'"]');var d=this;"del"!=b&&this.$editor.find("del").each(function(a,b){d.utils.replaceToTag(b,"inline")}),"span"!=b&&this.$editor.find(b).each(function(){var b=a(this);b.replaceWith(a("<strike />").html(b.contents()))}),this.$editor.find('[data-redactor-tag="'+b+'"]'+c).each(function(){if(""!==c||"span"!=b||this.tagName.toLowerCase()!=b){var d=a(this);d.replaceWith(a("<strike />").html(d.contents()))}}),this.selection.restore()},setFormat:function(a){switch(this.inline.type){case"class":a.hasClass(this.inline.value)?(a.removeClass(this.inline.value),a.removeAttr("data-redactor-class")):(a.addClass(this.inline.value),a.attr("data-redactor-class",this.inline.value));break;case"style":a[0].style.cssText=this.inline.value,a.attr("data-redactor-style",this.inline.value)}return a},removeStyle:function(){this.buffer.set();var b=this.selection.getCurrent(),c=this.selection.getInlines();if(this.selection.save(),b&&"SPAN"===b.tagName){var d=a(b);d.removeAttr("style"),0===d[0].attributes.length&&d.replaceWith(d.contents())}a.each(c,a.proxy(function(b,c){var d=a(c);-1==a.inArray(c.tagName.toLowerCase(),this.opts.inlineTags)||d.hasClass("redactor-selection-marker")||(d.removeAttr("style"),0===d[0].attributes.length&&d.replaceWith(d.contents()))},this)),this.selection.restore(),this.code.sync()},removeStyleRule:function(b){this.buffer.set();var c=this.selection.getParent(),d=this.selection.getInlines();if(this.selection.save(),c&&"SPAN"===c.tagName){var e=a(c);e.css(b,""),this.utils.removeEmptyAttr(e,"style"),0===e[0].attributes.length&&e.replaceWith(e.contents())}a.each(d,a.proxy(function(c,d){var e=a(d);-1==a.inArray(d.tagName.toLowerCase(),this.opts.inlineTags)||e.hasClass("redactor-selection-marker")||(e.css(b,""),this.utils.removeEmptyAttr(e,"style"),0===e[0].attributes.length&&e.replaceWith(e.contents()))},this)),this.selection.restore(),this.code.sync()},removeFormat:function(){this.buffer.set();var b=this.selection.getCurrent();this.selection.save(),document.execCommand("removeFormat"),b&&"SPAN"===b.tagName&&a(b).replaceWith(a(b).contents()),a.each(this.selection.getNodes(),a.proxy(function(b,c){var d=a(c);-1==a.inArray(c.tagName.toLowerCase(),this.opts.inlineTags)||d.hasClass("redactor-selection-marker")||d.replaceWith(d.contents())},this)),this.selection.restore(),this.code.sync()},toggleClass:function(a){this.inline.format("span","class",a)},toggleStyle:function(a){this.inline.format("span","style",a)}}},insert:function(){return{set:function(b,c){this.placeholder.remove(),b=this.clean.setVerified(b),"undefined"==typeof c&&(b=this.clean.onPaste(b,!1)),this.$editor.html(b),this.selection.remove(),this.focus.setEnd(),this.clean.normalizeLists(),this.code.sync(),this.observe.load(),"undefined"==typeof c&&setTimeout(a.proxy(this.clean.clearUnverified,this),10)},text:function(b){if(this.placeholder.remove(),b=b.toString(),b=a.trim(b),b=this.clean.getPlainText(b,!1),this.$editor.focus(),this.utils.browser("msie"))this.insert.htmlIe(b);else{this.selection.get(),this.range.deleteContents();var c=document.createElement("div");c.innerHTML=b;for(var d,e,f=document.createDocumentFragment();d=c.firstChild;)e=f.appendChild(d);if(this.range.insertNode(f),e){var g=this.range.cloneRange();g.setStartAfter(e),g.collapse(!0),this.sel.removeAllRanges(),this.sel.addRange(g)}}this.code.sync(),this.clean.clearUnverified()},htmlWithoutClean:function(a){this.insert.html(a,!1)},html:function(b,c){this.placeholder.remove(),"undefined"==typeof c&&(c=!0),this.$editor.focus(),b=this.clean.setVerified(b),c&&(b=this.clean.onPaste(b)),this.utils.browser("msie")?this.insert.htmlIe(b):(this.clean.singleLine?this.insert.execHtml(b):document.execCommand("insertHTML",!1,b),this.insert.htmlFixMozilla()),this.clean.normalizeLists(),this.opts.linebreaks||this.$editor.find("p").each(a.proxy(this.utils.removeEmpty,this)),this.code.sync(),this.observe.load(),c&&this.clean.clearUnverified()},htmlFixMozilla:function(){if(this.utils.browser("mozilla")){var b=a(this.selection.getBlock()).next();b.length>0&&"P"==b[0].tagName&&""===b.html()&&b.remove()}},htmlIe:function(b){if(this.utils.isIe11()){var c=this.utils.isCurrentOrParent("P"),d=a("<div>").append(b),e=d.contents().is("p, :header, dl, ul, ol, div, table, td, blockquote, pre, address, section, header, footer, aside, article");return void(c&&e?this.insert.ie11FixInserting(c,b):this.insert.ie11PasteFrag(b))}document.selection.createRange().pasteHTML(b)},execHtml:function(a){a=this.clean.setVerified(a),this.selection.get(),this.range.deleteContents();var b=document.createElement("div");b.innerHTML=a;for(var c,d,e=document.createDocumentFragment();c=b.firstChild;)d=e.appendChild(c);this.range.insertNode(e),this.range.collapse(!0),this.caret.setAfter(d)},node:function(b,c){b=b[0]||b;var d=this.utils.getOuterHtml(b);return d=this.clean.setVerified(d),null!==d.match(/</g)&&(b=a(d)[0]),this.selection.get(),c!==!1&&this.range.deleteContents(),this.range.insertNode(b),this.range.collapse(!1),this.selection.addRange(),b},nodeToPoint:function(a,b,c){a=a[0]||a,this.selection.get();var d;if(document.caretPositionFromPoint){var e=document.caretPositionFromPoint(b,c);this.range.setStart(e.offsetNode,e.offset),this.range.collapse(!0),this.range.insertNode(a)}else if(document.caretRangeFromPoint)d=document.caretRangeFromPoint(b,c),d.insertNode(a);else if("undefined"!=typeof document.body.createTextRange){d=document.body.createTextRange(),d.moveToPoint(b,c);var f=d.duplicate();f.moveToPoint(b,c),d.setEndPoint("EndToEnd",f),d.select()}},nodeToCaretPositionFromPoint:function(a,b){b=b[0]||b;var c,d=a.clientX,e=a.clientY;if(document.caretPositionFromPoint){var f=document.caretPositionFromPoint(d,e),g=document.getSelection();c=g.getRangeAt(0),c.setStart(f.offsetNode,f.offset),c.collapse(!0),c.insertNode(b)}else if(document.caretRangeFromPoint)c=document.caretRangeFromPoint(d,e),c.insertNode(b);else if("undefined"!=typeof document.body.createTextRange){c=document.body.createTextRange(),c.moveToPoint(d,e);var h=c.duplicate();h.moveToPoint(d,e),c.setEndPoint("EndToEnd",h),c.select()}},ie11FixInserting:function(b,c){var d=document.createElement("span");d.className="redactor-ie-paste",this.insert.node(d);var e=a(b).html();e="<p>"+e.replace(/<span class="redactor-ie-paste"><\/span>/gi,"</p>"+c+"<p>")+"</p>",a(b).replaceWith(e)},ie11PasteFrag:function(a){this.selection.get(),this.range.deleteContents();var b=document.createElement("div");b.innerHTML=a;for(var c,d,e=document.createDocumentFragment();c=b.firstChild;)d=e.appendChild(c);this.range.insertNode(e),this.range.collapse(!1),this.selection.addRange()}}},keydown:function(){return{init:function(b){if(!this.rtePaste){var c=b.which,d=c>=37&&40>=c;this.keydown.ctrl=b.ctrlKey||b.metaKey,this.keydown.current=this.selection.getCurrent(),this.keydown.parent=this.selection.getParent(),this.keydown.block=this.selection.getBlock(),this.keydown.pre=this.utils.isTag(this.keydown.current,"pre"),this.keydown.blockquote=this.utils.isTag(this.keydown.current,"blockquote"),this.keydown.figcaption=this.utils.isTag(this.keydown.current,"figcaption"),this.shortcuts.init(b,c),this.keydown.checkEvents(d,c),this.keydown.setupBuffer(b,c),this.keydown.addArrowsEvent(d),this.keydown.setupSelectAll(b,c);var e=this.core.setCallback("keydown",b);if(e===!1)return b.preventDefault(),!1;if(this.opts.enterKey&&(this.utils.browser("msie")||this.utils.browser("mozilla"))&&(c===this.keyCode.DOWN||c===this.keyCode.RIGHT)){var f=!1,g=!1;if(this.keydown.block&&"TD"===this.keydown.block.tagName&&(g=a(this.keydown.block).closest("table",this.$editor[0])),g&&g.find("td").last()[0]===this.keydown.block&&(f=!0),this.utils.isEndOfElement()&&f){var h=a(this.opts.emptyHtml);g.after(h),this.caret.setStart(h)}}if(this.opts.enterKey&&c===this.keyCode.DOWN&&this.keydown.onArrowDown(),!this.opts.enterKey&&c===this.keyCode.ENTER)return b.preventDefault(),void(this.range.collapsed||this.range.deleteContents());if(c==this.keyCode.ENTER&&!b.shiftKey&&!b.ctrlKey&&!b.metaKey){var i=this.core.setCallback("enter",b);if(i===!1)return b.preventDefault(),!1;if(this.keydown.blockquote&&this.keydown.exitFromBlockquote(b)===!0)return!1;var j,k;if(this.keydown.pre)return this.keydown.insertNewLine(b);if(this.keydown.blockquote||this.keydown.figcaption)return j=this.selection.getCurrent(),k=a(j).next(),0!==k.length&&"BR"==k[0].tagName?this.keydown.insertBreakLine(b):this.utils.isEndOfElement()&&j&&"SPAN"!=j?this.keydown.insertDblBreakLine(b):this.keydown.insertBreakLine(b);if(this.opts.linebreaks&&!this.keydown.block)return j=this.selection.getCurrent(),k=a(this.keydown.current).next(),0!==k.length&&"BR"==k[0].tagName?this.keydown.insertBreakLine(b):j!==!1&&a(j).hasClass("redactor-invisible-space")?(this.caret.setAfter(j),a(j).contents().unwrap(),this.keydown.insertDblBreakLine(b)):this.utils.isEndOfEditor()?this.keydown.insertDblBreakLine(b):this.keydown.insertBreakLine(0===k.length&&j===!1&&"undefined"!=typeof k.context?b:b);if(this.opts.linebreaks&&this.keydown.block)setTimeout(a.proxy(this.keydown.replaceDivToBreakLine,this),1);else if(!this.opts.linebreaks&&this.keydown.block)if("LI"!==this.keydown.block.tagName)setTimeout(a.proxy(this.keydown.replaceDivToParagraph,this),1);else{j=this.selection.getCurrent();var l=a(j).closest("li",this.$editor[0]),m=l.closest("ul,ol",this.$editor[0]);if(0!==l.length&&this.utils.isEmpty(l.html())&&0===m.next().length&&this.utils.isEmpty(m.find("li").last().html())){m.find("li").last().remove();var h=a(this.opts.emptyHtml);return m.after(h),this.caret.setStart(h),!1}}else if(!this.opts.linebreaks&&!this.keydown.block)return this.keydown.insertParagraph(b)}if(c===this.keyCode.ENTER&&(b.ctrlKey||b.shiftKey))return this.keydown.onShiftEnter(b);if(c===this.keyCode.TAB||b.metaKey&&221===c||b.metaKey&&219===c)return this.keydown.onTab(b,c);if(c===this.keyCode.BACKSPACE||c===this.keyCode.DELETE){if(this.utils.browser("mozilla")&&this.keydown.current&&"TD"===this.keydown.current.tagName)return b.preventDefault(),!1;var n=this.selection.getNodes();if(n)for(var o,p=n.length,q=0;p>q;q++){var r=a(n[q]).children("img");if(0!==r.length){var s=this;a.each(r,function(b,c){var d=a(c);"none"==d.css("float")&&(s.core.setCallback("imageDelete",c.src,d),o=c)})}else"IMG"==n[q].tagName&&o!=n[q]&&(this.core.setCallback("imageDelete",n[q].src,a(n[q])),o=n[q])}}c===this.keyCode.BACKSPACE&&(this.keydown.removeInvisibleSpace(),this.keydown.removeEmptyListInTable(b)),this.code.sync()}},checkEvents:function(a,b){a||"click"!=this.core.getEvent()&&"arrow"!=this.core.getEvent()||(this.core.addEvent(!1),this.keydown.checkKeyEvents(b)&&this.buffer.set())},checkKeyEvents:function(b){var c=this.keyCode,d=[c.BACKSPACE,c.DELETE,c.ENTER,c.SPACE,c.ESC,c.TAB,c.CTRL,c.META,c.ALT,c.SHIFT];return-1==a.inArray(b,d)?!0:!1},addArrowsEvent:function(a){return a?"click"==this.core.getEvent()||"arrow"==this.core.getEvent()?void this.core.addEvent(!1):void this.core.addEvent("arrow"):void 0},setupBuffer:function(a,b){return this.keydown.ctrl&&90===b&&!a.shiftKey&&!a.altKey&&this.opts.buffer.length?(a.preventDefault(),void this.buffer.undo()):this.keydown.ctrl&&90===b&&a.shiftKey&&!a.altKey&&0!==this.opts.rebuffer.length?(a.preventDefault(),void this.buffer.redo()):void(this.keydown.ctrl||(b==this.keyCode.BACKSPACE||b==this.keyCode.DELETE||b==this.keyCode.ENTER&&!a.ctrlKey&&!a.shiftKey||b==this.keyCode.SPACE)&&this.buffer.set())},setupSelectAll:function(a,b){this.keydown.ctrl&&65===b?this.utils.enableSelectAll():b==this.keyCode.LEFT_WIN||this.keydown.ctrl||this.utils.disableSelectAll()},onArrowDown:function(){for(var a=[this.keydown.blockquote,this.keydown.pre,this.keydown.figcaption],b=0;b<a.length;b++)if(a[b])return this.keydown.insertAfterLastElement(a[b]),!1},onShiftEnter:function(a){return this.buffer.set(),this.utils.isEndOfElement()?this.keydown.insertDblBreakLine(a):this.keydown.insertBreakLine(a)},onTab:function(a,b){if(!this.opts.tabKey)return!0;if(this.utils.isEmpty(this.code.get())&&this.opts.tabAsSpaces===!1)return!0;a.preventDefault();var c;return this.keydown.pre&&!a.shiftKey?(c=document.createTextNode(this.opts.preSpaces?Array(this.opts.preSpaces+1).join(" "):"	"),this.insert.node(c),this.code.sync()):this.opts.tabAsSpaces!==!1?(c=document.createTextNode(Array(this.opts.tabAsSpaces+1).join(" ")),this.insert.node(c),this.code.sync()):a.metaKey&&219===b?this.indent.decrease():a.metaKey&&221===b?this.indent.increase():a.shiftKey?this.indent.decrease():this.indent.increase(),!1},replaceDivToBreakLine:function(){var b=this.selection.getBlock(),c=b.innerHTML.replace(/<br\s?\/?>/gi,"");if(("DIV"===b.tagName||"P"===b.tagName)&&""===c&&!a(b).hasClass("redactor-editor")){var d=document.createElement("br");return a(b).replaceWith(d),this.caret.setBefore(d),this.code.sync(),!1}},replaceDivToParagraph:function(){var b=this.selection.getBlock(),c=b.innerHTML.replace(/<br\s?\/?>/gi,"");if("DIV"===b.tagName&&""===c&&!a(b).hasClass("redactor-editor")){var d=document.createElement("p");return d.innerHTML=this.opts.invisibleSpace,a(b).replaceWith(d),this.caret.setStart(d),this.code.sync(),!1}this.opts.cleanStyleOnEnter&&"P"==b.tagName&&a(b).removeAttr("class").removeAttr("style")},insertParagraph:function(a){a.preventDefault(),this.selection.get();var b;return this.selection.getParent()===!1&&(b=document.createElement("p"),b.innerHTML=this.$editor.html(),this.selection.selectAll(),this.range.deleteContents(),this.range.insertNode(b),this.caret.setAfter(b)),b=document.createElement("p"),b.innerHTML=this.opts.invisibleSpace,this.range.deleteContents(),this.range.insertNode(b),this.caret.setStart(b),this.code.sync(),!1},exitFromBlockquote:function(b){if(this.utils.isEndOfElement()){var c=a.trim(a(this.keydown.block).html());if(-1!=c.search(/(<br\s?\/?>){2}$/i)){if(b.preventDefault(),this.opts.linebreaks){var d=document.createElement("br");a(this.keydown.blockquote).after(d),this.caret.setBefore(d),a(this.keydown.block).html(c.replace(/<br\s?\/?>$/i,""))}else{var e=a(this.opts.emptyHtml);a(this.keydown.blockquote).after(e),this.caret.setStart(e)}return!0}}},insertAfterLastElement:function(b){if(this.utils.isEndOfElement())if(this.buffer.set(),this.opts.linebreaks){var c=a("<div>").append(a.trim(this.$editor.html())).contents(),d=c.last()[0];if("SPAN"==d.tagName&&""===d.innerHTML&&(d=c.prev()[0]),this.utils.getOuterHtml(d)!=this.utils.getOuterHtml(b))return;var e=document.createElement("br");a(b).after(e),this.caret.setAfter(e)}else{if(this.$editor.contents().last()[0]!==b)return;var f=a(this.opts.emptyHtml);a(b).after(f),this.caret.setStart(f)}},insertNewLine:function(a){a.preventDefault();var b=document.createTextNode("\n");return this.selection.get(),this.range.deleteContents(),this.range.insertNode(b),this.caret.setAfter(b),this.code.sync(),!1},insertBreakLine:function(a){return this.keydown.insertBreakLineProcessing(a)},insertDblBreakLine:function(a){return this.keydown.insertBreakLineProcessing(a,!0)},insertBreakLineProcessing:function(b,c){b.stopPropagation(),this.selection.get();var d=document.createElement("br");this.utils.browser("msie")?(this.range.collapse(!1),this.range.setEnd(this.range.endContainer,this.range.endOffset)):this.range.deleteContents(),this.range.insertNode(d);var e=a(d).parent("a");if(e.length>0&&(e.find(d).remove(),e.after(d)),c===!0){var f=a(d).next();if(0!==f.length&&"BR"===f[0].tagName&&this.utils.isEndOfEditor())return this.caret.setAfter(d),this.code.sync(),!1;var g=document.createElement("br");this.range.insertNode(g),this.caret.setAfter(g)}else this.keydown.insertBreakLineProcessingAfter(d);return this.code.sync(),!1},insertBreakLineProcessingAfter:function(b){var c=this.utils.createSpaceElement();a(b).after(c),this.selection.selectElement(c),a(c).replaceWith(function(){return a(this).contents()})},removeInvisibleSpace:function(){var b=a(this.keydown.current);0===b.text().search(/^\u200B$/g)&&b.remove()},removeEmptyListInTable:function(b){var c=a(this.keydown.current),d=a(this.keydown.parent),e=c.closest("td",this.$editor[0]);if(0!==e.length&&c.closest("li",this.$editor[0])&&1===d.children("li").length){if(!this.utils.isEmpty(c.text()))return;b.preventDefault(),c.remove(),d.remove(),this.caret.setStart(e)}}}},keyup:function(){return{init:function(b){if(!this.rtePaste){var c=b.which;this.keyup.current=this.selection.getCurrent(),this.keyup.parent=this.selection.getParent();var d=this.utils.isRedactorParent(a(this.keyup.parent).parent()),e=this.core.setCallback("keyup",b);return e===!1?(b.preventDefault(),!1):(!this.opts.linebreaks&&3==this.keyup.current.nodeType&&this.keyup.current.length<=1&&(this.keyup.parent===!1||"BODY"==this.keyup.parent.tagName)&&this.keyup.replaceToParagraph(),!this.opts.linebreaks&&this.utils.isRedactorParent(this.keyup.current)&&"DIV"===this.keyup.current.tagName&&this.keyup.replaceToParagraph(!1),this.opts.linebreaks||!a(this.keyup.parent).hasClass("redactor-invisible-space")||d!==!1&&"BODY"!=d[0].tagName||(a(this.keyup.parent).contents().unwrap(),this.keyup.replaceToParagraph()),this.linkify.isEnabled()&&this.linkify.isKey(c)&&this.linkify.format(),c===this.keyCode.DELETE||c===this.keyCode.BACKSPACE?(this.clean.clearUnverified(),this.observe.image?(b.preventDefault(),this.image.hideResize(),this.buffer.set(),this.image.remove(this.observe.image),this.observe.image=!1,!1):(this.$editor.find("p").each(a.proxy(function(b,c){this.utils.removeEmpty(b,a(c).html())},this)),this.opts.linebreaks&&this.keyup.current&&"DIV"==this.keyup.current.tagName&&this.utils.isEmpty(this.keyup.current.innerHTML)&&(a(this.keyup.current).after(this.selection.getMarkerAsHtml()),this.selection.restore(),a(this.keyup.current).remove()),this.keyup.formatEmpty(b))):void 0)}},replaceToParagraph:function(b){var c,d=a(this.keyup.current);c=a("<p>").append(b===!1?d.html():d.clone()),d.replaceWith(c);var e=a(c).next();"undefined"!=typeof e[0]&&"BR"==e[0].tagName&&e.remove(),this.caret.setEnd(c)},formatEmpty:function(b){var c=a.trim(this.$editor.html());if(this.utils.isEmpty(c))return b.preventDefault(),this.opts.linebreaks?(this.$editor.html(this.selection.getMarkerAsHtml()),this.selection.restore()):(c="<p><br /></p>",this.$editor.html(c),this.focus.setStart()),this.code.sync(),!1}}},lang:function(){return{load:function(){this.opts.curLang=this.opts.langs[this.opts.lang]},get:function(a){return"undefined"!=typeof this.opts.curLang[a]?this.opts.curLang[a]:""}}},line:function(){return{insert:function(){this.buffer.set();var a=this.selection.getBlocks();return a[0]!==!1&&this.line.isExceptLastOrFirst(a)?void(this.utils.browser("msie")||this.$editor.focus()):void(this.utils.browser("msie")?this.line.insertInIe():this.line.insertInOthersBrowsers())},isExceptLastOrFirst:function(b){var c=["li","td","th","blockquote","figcaption","pre","dl","dt","dd"],d=b[0].tagName.toLowerCase(),e=this.selection.getLastBlock();e="undefined"==typeof e?d:e.tagName.toLowerCase();var f=-1!=a.inArray(d,c),g=-1!=a.inArray(e,c);return f&&g||f?!0:void 0},insertInIe:function(){this.utils.saveScroll(),this.buffer.set(),this.insert.node(document.createElement("hr")),this.utils.restoreScroll(),this.code.sync()},insertInOthersBrowsers:function(){this.buffer.set();var a='<p id="redactor-insert-line"><br /></p>';this.opts.linebreaks&&(a='<br id="redactor-insert-line">'),document.execCommand("insertHTML",!1,"<hr>"+a),this.line.setFocus(),this.code.sync()},setFocus:function(){var b=this.$editor.find("#redactor-insert-line"),c=a(b).next()[0];c?(this.caret.setAfter(b),b.remove()):b.removeAttr("id")}}},link:function(){return{show:function(b){"undefined"!=typeof b&&b.preventDefault&&b.preventDefault(),this.modal.load("link",this.lang.get("link_insert"),600),this.modal.createCancelButton(),this.link.buttonInsert=this.modal.createActionButton(this.lang.get("insert")),this.selection.get(),this.link.getData(),this.link.cleanUrl(),"_blank"==this.link.target&&a("#redactor-link-blank").prop("checked",!0),this.link.$inputUrl=a("#redactor-link-url"),this.link.$inputText=a("#redactor-link-url-text"),this.link.$inputText.val(this.link.text),this.link.$inputUrl.val(this.link.url),this.link.buttonInsert.on("click",a.proxy(this.link.insert,this)),a(".redactor-link-tooltip").remove(),this.selection.save(),this.modal.show(),this.link.$inputUrl.focus()},cleanUrl:function(){var a=self.location.href.replace(/\/$/i,"");if("undefined"!=typeof this.link.url&&(this.link.url=this.link.url.replace(a,""),this.link.url=this.link.url.replace(/^\/#/,"#"),this.link.url=this.link.url.replace("mailto:",""),!this.opts.linkProtocol)){var b=new RegExp("^(http|ftp|https)://"+self.location.host,"i");this.link.url=this.link.url.replace(b,"")}},getData:function(){this.link.$node=!1;var b=a(this.selection.getCurrent()).closest("a",this.$editor[0]);0!==b.length&&"A"===b[0].tagName?(this.link.$node=b,this.link.url=b.attr("href"),this.link.text=b.text(),this.link.target=b.attr("target")):(this.link.text=this.sel.toString(),this.link.url="",this.link.target="")},insert:function(){this.placeholder.remove();var b="",c=this.link.$inputUrl.val(),d=this.link.$inputText.val();if(""===a.trim(c))return void this.link.$inputUrl.addClass("redactor-input-error").on("keyup",function(){a(this).removeClass("redactor-input-error"),a(this).off("keyup")});if(-1!=c.search("@")&&/(http|ftp|https):\/\//i.test(c)===!1)c="mailto:"+c;else if(0!==c.search("#")){a("#redactor-link-blank").prop("checked")&&(b="_blank");var e="((xn--)?[a-z0-9]+(-[a-z0-9]+)*\\.)+[a-z]{2,}",f=new RegExp("^(http|ftp|https)://"+e,"i"),g=new RegExp("^"+e,"i"),h=new RegExp(".(html|php)$","i");-1==c.search(f)&&-1==c.search(h)&&0===c.search(g)&&this.opts.linkProtocol&&(c=this.opts.linkProtocol+"://"+c)}this.link.set(d,c,b),this.modal.close()},set:function(b,c,d){if(b=a.trim(b.replace(/<|>/g,"")),this.selection.restore(),""!==b||""!==c){if(""===b&&""!==c&&(b=c),this.link.$node){this.buffer.set();var e=this.link.$node,f=e.children();if(f.length>0){for(;f.length;)f=f.children();f=f.end()}else f=e;e.attr("href",c),f.text(b),""!==d?e.attr("target",d):e.removeAttr("target"),this.selection.selectElement(e),this.code.sync()}else{if(this.utils.browser("mozilla")&&""===this.link.text){var g=a("<a />").attr("href",c).text(b);""!==d&&g.attr("target",d),this.insert.node(g),this.selection.selectElement(g)}else{var g;this.utils.browser("msie")?(g=a('<a href="'+c+'">').text(b),""!==d&&g.attr("target",d),g=a(this.insert.node(g)),this.selection.getText().match(/\s$/)&&g.after(" "),this.selection.selectElement(g)):(document.execCommand("createLink",!1,c),g=a(this.selection.getCurrent()).closest("a",this.$editor[0]),this.utils.browser("mozilla")&&(g=a('a[_moz_dirty=""]')),""!==d&&g.attr("target",d),g.removeAttr("style").removeAttr("_moz_dirty"),this.selection.getText().match(/\s$/)&&g.after(" "),(""!==this.link.text||this.link.text!=b)&&(g.text(b),this.selection.selectElement(g)))}this.code.sync(),this.core.setCallback("insertedLink",g)}setTimeout(a.proxy(function(){this.observe.links()},this),5)}},unlink:function(b){"undefined"!=typeof b&&b.preventDefault&&b.preventDefault();var c=this.selection.getNodes();if(c){this.buffer.set();for(var d=c.length,e=0;d>e;e++){var f=a(c[e]).closest("a",this.$editor[0]);f.replaceWith(f.contents())}a(".redactor-link-tooltip").remove(),this.code.sync()}},toggleClass:function(a){this.link.setClass(a,"toggleClass")},addClass:function(a){this.link.setClass(a,"addClass")},removeClass:function(a){this.link.setClass(a,"removeClass")},setClass:function(b,c){var d=this.selection.getInlinesTags(["a"]);d!==!1&&a.each(d,function(){a(this)[c](b)})}}},list:function(){return{toggle:function(b){this.placeholder.remove(),this.utils.browser("msie")||this.$editor.focus(),this.buffer.set(),this.selection.save();var c=this.selection.getParent(),d=a(c).closest("ol, ul",this.$editor[0]);this.utils.isRedactorParent(d)||0===d.length||(d=!1);var e,f,g=!1;if(d&&d.length){g=!0;var h=d[0].tagName;e="orderedlist"===b&&"UL"===h,f="unorderedlist"===b&&"OL"===h}e?this.utils.replaceToTag(d,"ol"):f?this.utils.replaceToTag(d,"ul"):g?this.list.remove(b):this.list.insert(b),this.selection.restore(),this.code.sync()},insert:function(b){var c=this.selection.getParent(),d=this.selection.getCurrent(),e=a(d).closest("td, th",this.$editor[0]);this.utils.browser("msie")&&this.opts.linebreaks?this.list.insertInIe(b):document.execCommand("insert"+b);var f=a(this.selection.getParent()).closest("ol, ul",this.$editor[0]);if(0!==e.length){var g=e.prev(),h=e.html();e.html(""),!g||1!==g.length||"TD"!==g[0].tagName&&"TH"!==g[0].tagName?a(c).prepend(e):a(g).after(e),e.html(h)}if(this.utils.isEmpty(f.find("li").text())){var i=f.children("li");i.find("br").remove(),i.append(this.selection.getMarkerAsHtml())}if(f.length){var j=f.parent();this.utils.isRedactorParent(j)&&"LI"!=j[0].tagName&&this.utils.isBlock(j[0])&&j.replaceWith(j.contents())}this.utils.browser("msie")||this.$editor.focus(),this.clean.clearUnverified()},insertInIe:function(b){var c=this.selection.wrap("div"),d=a(c).html(),e=a("orderedlist"==b?"<ol>":"<ul>"),f=a("<li>");if(""===a.trim(d))f.append(this.selection.getMarkerAsHtml()),e.append(f),this.$editor.find("#selection-marker-1").replaceWith(e);else{var g=d.split(/<br\s?\/?>/gi);if(g)for(var h=0;h<g.length;h++)""!==a.trim(g[h])&&e.append(a("<li>").html(g[h]));else f.append(d),e.append(f);a(c).replaceWith(e)}},remove:function(b){document.execCommand("insert"+b);var c=a(this.selection.getCurrent());this.indent.fixEmptyIndent(),this.opts.linebreaks||0!==c.closest("li, th, td",this.$editor[0]).length||(document.execCommand("formatblock",!1,"p"),this.$editor.find("ul, ol, blockquote").each(a.proxy(this.utils.removeEmpty,this)));var d=a(this.selection.getCurrent()).closest("table",this.$editor[0]),e=d.prev();this.opts.linebreaks||0===d.length||0===e.length||"BR"!=e[0].tagName||e.remove(),this.clean.clearUnverified()}}},modal:function(){return{callbacks:{},loadTemplates:function(){this.opts.modal={imageEdit:String()+'<section id="redactor-modal-image-edit"><label>'+this.lang.get("title")+'</label><input type="text" id="redactor-image-title" /><label class="redactor-image-link-option">'+this.lang.get("link")+'</label><input type="text" id="redactor-image-link" class="redactor-image-link-option" /><label class="redactor-image-link-option"><input type="checkbox" id="redactor-image-link-blank"> '+this.lang.get("link_new_tab")+'</label><label class="redactor-image-position-option">'+this.lang.get("image_position")+'</label><select class="redactor-image-position-option" id="redactor-image-align"><option value="none">'+this.lang.get("none")+'</option><option value="left">'+this.lang.get("left")+'</option><option value="center">'+this.lang.get("center")+'</option><option value="right">'+this.lang.get("right")+"</option></select></section>",image:String()+'<section id="redactor-modal-image-insert"><div id="redactor-modal-image-droparea"></div></section>',file:String()+'<section id="redactor-modal-file-insert"><div id="redactor-modal-file-upload-box"><label>'+this.lang.get("filename")+'</label><input type="text" id="redactor-filename" /><br><br><div id="redactor-modal-file-upload"></div></div></section>',link:String()+'<section id="redactor-modal-link-insert"><label>URL</label><input type="url" id="redactor-link-url" /><label>'+this.lang.get("text")+'</label><input type="text" id="redactor-link-url-text" /><label><input type="checkbox" id="redactor-link-blank"> '+this.lang.get("link_new_tab")+"</label></section>"},a.extend(this.opts,this.opts.modal)},addCallback:function(a,b){this.modal.callbacks[a]=b},createTabber:function(b){this.modal.$tabber=a("<div>").attr("id","redactor-modal-tabber"),b.prepend(this.modal.$tabber)},addTab:function(b,c,d){var e=a('<a href="#" rel="tab'+b+'">').text(c);d&&e.addClass("active");var f=this;e.on("click",function(b){b.preventDefault(),a(".redactor-tab").hide(),a(".redactor-"+a(this).attr("rel")).show(),f.modal.$tabber.find("a").removeClass("active"),a(this).addClass("active")}),this.modal.$tabber.append(e)},addTemplate:function(a,b){this.opts.modal[a]=b},getTemplate:function(a){return this.opts.modal[a]},getModal:function(){return this.$modalBody.find("section")},load:function(a,b,c){this.modal.templateName=a,this.modal.width=c,this.modal.build(),this.modal.enableEvents(),this.modal.setTitle(b),this.modal.setDraggable(),this.modal.setContent(),"undefined"!=typeof this.modal.callbacks[a]&&this.modal.callbacks[a].call(this)},show:function(){this.utils.isMobile()&&!this.utils.browser("msie")&&document.activeElement.blur(),
a(document.body).addClass("body-redactor-hidden"),this.utils.isMobile()?this.modal.showOnMobile():this.modal.showOnDesktop(),this.$modalOverlay.show(),this.$modalBox.show(),this.modal.setButtonsWidth(),this.utils.saveScroll(),this.utils.isMobile()||(setTimeout(a.proxy(this.modal.showOnDesktop,this),0),a(window).on("resize.redactor-modal",a.proxy(this.modal.resize,this))),this.core.setCallback("modalOpened",this.modal.templateName,this.$modal),a(document).off("focusin.modal"),this.$modal.find("input[type=text],input[type=url],input[type=email]").on("keydown.redactor-modal",a.proxy(this.modal.setEnter,this))},showOnDesktop:function(){var b=this.$modal.outerHeight(),c=window.innerHeight,d=a(window).width();return this.modal.width>d?void this.$modal.css({width:"96%",marginTop:c/2-b/2+"px"}):void this.$modal.css(b>c?{width:this.modal.width+"px",marginTop:"20px"}:{width:this.modal.width+"px",marginTop:c/2-b/2+"px"})},showOnMobile:function(){this.$modal.css({width:"96%",marginTop:"2%"})},resize:function(){this.utils.isMobile()?this.modal.showOnMobile():this.modal.showOnDesktop()},setTitle:function(a){this.$modalHeader.html(a)},setContent:function(){this.$modalBody.html(this.modal.getTemplate(this.modal.templateName))},setDraggable:function(){"undefined"!=typeof a.fn.draggable&&(this.$modal.draggable({handle:this.$modalHeader}),this.$modalHeader.css("cursor","move"))},setEnter:function(a){13==a.which&&(a.preventDefault(),this.$modal.find("button.redactor-modal-action-btn").click())},createCancelButton:function(){var b=a("<button>").addClass("redactor-modal-btn redactor-modal-close-btn").html(this.lang.get("cancel"));b.on("click",a.proxy(this.modal.close,this)),this.$modalFooter.append(b)},createDeleteButton:function(a){return this.modal.createButton(a,"delete")},createActionButton:function(a){return this.modal.createButton(a,"action")},createButton:function(b,c){var d=a("<button>").addClass("redactor-modal-btn").addClass("redactor-modal-"+c+"-btn").html(b);return this.$modalFooter.append(d),d},setButtonsWidth:function(){var a=this.$modalFooter.find("button"),b=a.length;0!==b&&a.css("width",100/b+"%")},build:function(){this.modal.buildOverlay(),this.$modalBox=a('<div id="redactor-modal-box" />').hide(),this.$modal=a('<div id="redactor-modal" />'),this.$modalHeader=a("<header />"),this.$modalClose=a('<span id="redactor-modal-close" />').html("&times;"),this.$modalBody=a('<div id="redactor-modal-body" />'),this.$modalFooter=a("<footer />"),this.$modal.append(this.$modalHeader),this.$modal.append(this.$modalClose),this.$modal.append(this.$modalBody),this.$modal.append(this.$modalFooter),this.$modalBox.append(this.$modal),this.$modalBox.appendTo(document.body)},buildOverlay:function(){this.$modalOverlay=a('<div id="redactor-modal-overlay">').hide(),a("body").prepend(this.$modalOverlay)},enableEvents:function(){this.$modalClose.on("click.redactor-modal",a.proxy(this.modal.close,this)),a(document).on("keyup.redactor-modal",a.proxy(this.modal.closeHandler,this)),this.$editor.on("keyup.redactor-modal",a.proxy(this.modal.closeHandler,this)),this.$modalBox.on("click.redactor-modal",a.proxy(this.modal.close,this))},disableEvents:function(){this.$modalClose.off("click.redactor-modal"),a(document).off("keyup.redactor-modal"),this.$editor.off("keyup.redactor-modal"),this.$modalBox.off("click.redactor-modal"),a(window).off("resize.redactor-modal")},closeHandler:function(a){a.which==this.keyCode.ESC&&this.modal.close(!1)},close:function(b){if(b){if(!a(b.target).hasClass("redactor-modal-close-btn")&&b.target!=this.$modalClose[0]&&b.target!=this.$modalBox[0])return;b.preventDefault()}this.$modalBox&&(this.modal.disableEvents(),this.$modalOverlay.remove(),this.$modalBox.fadeOut("fast",a.proxy(function(){this.$modalBox.remove(),setTimeout(a.proxy(this.utils.restoreScroll,this),0),void 0!==b&&this.selection.restore(),a(document.body).removeClass("body-redactor-hidden"),this.core.setCallback("modalClosed",this.modal.templateName)},this)))}}},observe:function(){return{load:function(){this.observe.images(),this.observe.links()},buttons:function(b,c){var d=this.selection.getCurrent(),e=this.selection.getParent();if(b!==!1?this.button.setInactiveAll():this.button.setInactiveAll(c),b===!1&&"html"!==c)return void(-1!=a.inArray(c,this.opts.activeButtons)&&this.button.toggleActive(c));a.each(this.opts.activeButtonsStates,a.proxy(function(b,c){var f=a(e).closest(b,this.$editor[0]),g=a(d).closest(b,this.$editor[0]);(0===f.length||this.utils.isRedactorParent(f))&&this.utils.isRedactorParent(g)&&(0!==f.length||0!==g.closest(b,this.$editor[0]).length)&&this.button.setActive(c)},this));var f=a(e).closest(this.opts.alignmentTags.toString().toLowerCase(),this.$editor[0]);if(this.utils.isRedactorParent(e)&&f.length){var g=""===f.css("text-align")?"left":f.css("text-align");this.button.setActive("align"+g)}},addButton:function(a,b){this.opts.activeButtons.push(b),this.opts.activeButtonsStates[a]=b},images:function(){this.$editor.find("img").each(a.proxy(function(b,c){var d=a(c);d.closest("a",this.$editor[0]).on("click",function(a){a.preventDefault()}),this.utils.browser("msie")&&d.attr("unselectable","on"),this.image.setEditable(d)},this)),a(document).on("click.redactor-image-delete."+this.uuid,a.proxy(function(a){this.observe.image=!1,"IMG"==a.target.tagName&&this.utils.isRedactorParent(a.target)&&(this.observe.image=this.observe.image&&this.observe.image==a.target?!1:a.target)},this))},links:function(){this.opts.linkTooltip&&(this.$editor.find("a").on("touchstart.redactor."+this.uuid+" click.redactor."+this.uuid,a.proxy(this.observe.showTooltip,this)),this.$editor.on("touchstart.redactor."+this.uuid+" click.redactor."+this.uuid,a.proxy(this.observe.closeTooltip,this)),a(document).on("touchstart.redactor."+this.uuid+" click.redactor."+this.uuid,a.proxy(this.observe.closeTooltip,this)))},getTooltipPosition:function(a){return a.offset()},showTooltip:function(b){var c=a(b.target);if("IMG"!=c[0].tagName&&("A"!==c[0].tagName&&(c=c.closest("a",this.$editor[0])),"A"===c[0].tagName)){var d=c,e=this.observe.getTooltipPosition(d),f=a('<span class="redactor-link-tooltip"></span>'),g=d.attr("href");void 0===g&&(g=""),g.length>24&&(g=g.substring(0,24)+"...");var h=a('<a href="'+d.attr("href")+'" target="_blank" />').html(g).addClass("redactor-link-tooltip-action"),i=a('<a href="#" />').html(this.lang.get("edit")).on("click",a.proxy(this.link.show,this)).addClass("redactor-link-tooltip-action"),j=a('<a href="#" />').html(this.lang.get("unlink")).on("click",a.proxy(this.link.unlink,this)).addClass("redactor-link-tooltip-action");f.append(h).append(" | ").append(i).append(" | ").append(j),f.css({top:e.top+parseInt(d.css("line-height"),10)+"px",left:e.left+"px"}),a(".redactor-link-tooltip").remove(),a("body").append(f)}},closeTooltip:function(b){b=b.originalEvent||b;var c=b.target,d=a(c).closest("a",this.$editor[0]);(0===d.length||"A"!==d[0].tagName||"A"===c.tagName)&&("A"===c.tagName&&this.utils.isRedactorParent(c)||a(c).hasClass("redactor-link-tooltip-action")||a(".redactor-link-tooltip").remove())}}},paragraphize:function(){return{load:function(b){return this.opts.linebreaks?b:""===b||"<p></p>"===b?this.opts.emptyHtml:(b+="\n",this.paragraphize.safes=[],this.paragraphize.z=0,b=b.replace(/(<br\s?\/?>){1,}\n?<\/blockquote>/gi,"</blockquote>"),b=this.paragraphize.getSafes(b),b=this.paragraphize.getSafesComments(b),b=this.paragraphize.replaceBreaksToNewLines(b),b=this.paragraphize.replaceBreaksToParagraphs(b),b=this.paragraphize.clear(b),b=this.paragraphize.restoreSafes(b),b=b.replace(new RegExp("<br\\s?/?>\n?<("+this.opts.paragraphizeBlocks.join("|")+")(.*?[^>])>","gi"),"<p><br /></p>\n<$1$2>"),a.trim(b))},getSafes:function(b){var c=a("<div />").append(b);return c.find("blockquote p").replaceWith(function(){return a(this).append("<br />").contents()}),b=c.html(),c.find(this.opts.paragraphizeBlocks.join(", ")).each(a.proxy(function(a,c){this.paragraphize.z++,this.paragraphize.safes[this.paragraphize.z]=c.outerHTML,b=b.replace(c.outerHTML,"\n{replace"+this.paragraphize.z+"}")},this)),b},getSafesComments:function(b){var c=b.match(/<!--([\w\W]*?)-->/gi);return c?(a.each(c,a.proxy(function(a,c){this.paragraphize.z++,this.paragraphize.safes[this.paragraphize.z]=c,b=b.replace(c,"\n{replace"+this.paragraphize.z+"}")},this)),b):b},restoreSafes:function(b){return a.each(this.paragraphize.safes,function(a,c){c="undefined"!=typeof c?c.replace(/\$/g,"&#36;"):c,b=b.replace("{replace"+a+"}",c)}),b},replaceBreaksToParagraphs:function(a){var b=a.split(new RegExp("\n","g"),-1);if(a="",b)for(var c=b.length,d=0;c>d;d++){if(!b.hasOwnProperty(d))return;-1==b[d].search("{replace")?(b[d]=b[d].replace(/<p>\n\t?<\/p>/gi,""),b[d]=b[d].replace(/<p><\/p>/gi,""),""!==b[d]&&(a+="<p>"+b[d].replace(/^\n+|\n+$/g,"")+"</p>")):a+=b[d]}return a},replaceBreaksToNewLines:function(a){return a=a.replace(/<br \/>\s*<br \/>/gi,"\n\n"),a=a.replace(/<br\s?\/?>\n?<br\s?\/?>/gi,"\n<br /><br />"),a=a.replace(new RegExp("\r\n","g"),"\n"),a=a.replace(new RegExp("\r","g"),"\n"),a=a.replace(new RegExp("/\n\n+/"),"g","\n\n")},clear:function(a){return a=a.replace(new RegExp("</blockquote></p>","gi"),"</blockquote>"),a=a.replace(new RegExp("<p></blockquote>","gi"),"</blockquote>"),a=a.replace(new RegExp("<p><blockquote>","gi"),"<blockquote>"),a=a.replace(new RegExp("<blockquote></p>","gi"),"<blockquote>"),a=a.replace(new RegExp("<p><p ","gi"),"<p "),a=a.replace(new RegExp("<p><p>","gi"),"<p>"),a=a.replace(new RegExp("</p></p>","gi"),"</p>"),a=a.replace(new RegExp("<p>\\s?</p>","gi"),""),a=a.replace(new RegExp("\n</p>","gi"),"</p>"),a=a.replace(new RegExp("<p>	?	?\n?<p>","gi"),"<p>"),a=a.replace(new RegExp("<p>	*</p>","gi"),"")}}},paste:function(){return{init:function(b){return this.opts.cleanOnPaste?(this.rtePaste=!0,this.buffer.set(),this.selection.save(),this.utils.saveScroll(),this.paste.createPasteBox(),a(window).on("scroll.redactor-freeze",a.proxy(function(){a(window).scrollTop(this.saveBodyScroll)},this)),void setTimeout(a.proxy(function(){var b=this.$pasteBox.html();this.$pasteBox.remove(),this.selection.restore(),this.utils.restoreScroll(),this.paste.insert(b),a(window).off("scroll.redactor-freeze"),this.linkify.isEnabled()&&this.linkify.format()},this),1)):void setTimeout(a.proxy(this.code.sync,this),1)},createPasteBox:function(){this.$pasteBox=a("<div>").html("").attr("contenteditable","true").css({position:"fixed",width:0,top:0,left:"-9999px"}),this.utils.browser("msie")?this.$box.append(this.$pasteBox):a("body").append(this.$pasteBox),this.$pasteBox.focus()},insert:function(b){b=this.core.setCallback("pasteBefore",b),b=this.utils.isSelectAll()?this.clean.onPaste(b,!1):this.clean.onPaste(b),b=this.core.setCallback("paste",b),this.utils.isSelectAll()?this.insert.set(b,!1):this.insert.html(b,!1),this.utils.disableSelectAll(),this.rtePaste=!1,setTimeout(a.proxy(this.clean.clearUnverified,this),10),setTimeout(a.proxy(function(){var b=this.$editor.find("span");a.each(b,function(b,c){var d=c.innerHTML.replace(/[\u200B-\u200D\uFEFF]/,"");""===d&&0===c.attributes.length&&a(c).remove()})},this),10)}}},placeholder:function(){return{enable:function(){this.placeholder.is()&&(this.$editor.attr("placeholder",this.$element.attr("placeholder")),this.placeholder.toggle(),this.$editor.on("keyup.redactor-placeholder",a.proxy(this.placeholder.toggle,this)))},toggle:function(){var a="removeClass";this.utils.isEmpty(this.$editor.html(),!1)&&(a="addClass"),this.$editor[a]("redactor-placeholder")},remove:function(){this.$editor.removeClass("redactor-placeholder")},is:function(){return this.opts.placeholder?this.$element.attr("placeholder",this.opts.placeholder):!("undefined"==typeof this.$element.attr("placeholder")||""===this.$element.attr("placeholder"))}}},progress:function(){return{show:function(){a(document.body).append(a('<div id="redactor-progress"><span></span></div>')),a("#redactor-progress").fadeIn()},hide:function(){a("#redactor-progress").fadeOut(1500,function(){a(this).remove()})}}},selection:function(){return{get:function(){this.sel=document.getSelection(),document.getSelection&&this.sel.getRangeAt&&this.sel.rangeCount?this.range=this.sel.getRangeAt(0):this.range=document.createRange()},addRange:function(){try{this.sel.removeAllRanges()}catch(a){}this.sel.addRange(this.range)},getCurrent:function(){var a=!1;return this.selection.get(),this.sel&&this.sel.rangeCount>0&&(a=this.sel.getRangeAt(0).startContainer),this.utils.isRedactorParent(a)},getParent:function(b){return b=b||this.selection.getCurrent(),b?this.utils.isRedactorParent(a(b).parent()[0]):!1},getBlock:function(b){for(b=b||this.selection.getCurrent();b;){if(this.utils.isBlockTag(b.tagName))return a(b).hasClass("redactor-editor")?!1:b;b=b.parentNode}return!1},getInlines:function(b,c){if(this.selection.get(),this.range&&this.range.collapsed)return!1;var d=[];b="undefined"==typeof b||b===!1?this.selection.getNodes():b;var e=this.opts.inlineTags;if(e.push("span"),"undefined"!=typeof c)for(var f=0;f<c.length;f++)e.push(c[f]);return a.each(b,a.proxy(function(b,c){-1!=a.inArray(c.tagName.toLowerCase(),e)&&d.push(c)},this)),0===d.length?!1:d},getInlinesTags:function(b){if(this.selection.get(),this.range&&this.range.collapsed)return!1;var c=[],d=this.selection.getNodes();return a.each(d,a.proxy(function(d,e){-1!=a.inArray(e.tagName.toLowerCase(),b)&&c.push(e)},this)),0===c.length?!1:c},getBlocks:function(b){if(this.selection.get(),this.range&&this.range.collapsed)return[this.selection.getBlock()];var c=[];return b="undefined"==typeof b?this.selection.getNodes():b,a.each(b,a.proxy(function(a,b){this.utils.isBlock(b)&&(this.selection.lastBlock=b,c.push(b))},this)),0===c.length?[this.selection.getBlock()]:c},getLastBlock:function(){return this.selection.lastBlock},getNodes:function(){this.selection.get();var b=this.selection.getNodesMarker(1),c=this.selection.getNodesMarker(2),d=this.range.cloneRange();if(this.range.collapsed===!1){var e=d.startContainer,f=d.startOffset;this.selection.setNodesMarker(d,c,!1),d.setStart(e,f),this.selection.setNodesMarker(d,b,!0)}else this.selection.setNodesMarker(d,b,!0),c=b;var g=[],h=0,i=this;this.$editor.find("*").each(function(){if(this==b){var d=a(this).parent();0!==d.length&&"BODY"!=d[0].tagName&&i.utils.isRedactorParent(d[0])&&g.push(d[0]),g.push(this),h=1}else h>0&&(g.push(this),h+=1);return this==c?!1:void 0});for(var j=[],k=g.length,l=0;k>l;l++)"nodes-marker-1"!=g[l].id&&"nodes-marker-2"!=g[l].id&&j.push(g[l]);return this.selection.removeNodesMarkers(),j},getNodesMarker:function(b){return a('<span id="nodes-marker-'+b+'" class="redactor-nodes-marker" data-verified="redactor">'+this.opts.invisibleSpace+"</span>")[0]},setNodesMarker:function(a,b,c){try{a.collapse(c),a.insertNode(b)}catch(d){}},removeNodesMarkers:function(){a(document).find("span.redactor-nodes-marker").remove(),this.$editor.find("span.redactor-nodes-marker").remove()},fromPoint:function(a,b){this.caret.setOffset(a,b)},wrap:function(a){if(this.selection.get(),this.range.collapsed)return!1;var b=document.createElement(a);return b.appendChild(this.range.extractContents()),this.range.insertNode(b),b},selectElement:function(a){this.caret.set(a,0,a,1)},selectAll:function(){this.selection.get(),this.range.selectNodeContents(this.$editor[0]),this.selection.addRange()},remove:function(){this.selection.get(),this.sel.removeAllRanges()},save:function(){this.selection.createMarkers()},createMarkers:function(){this.selection.get();var a=this.selection.getMarker(1);if(this.selection.setMarker(this.range,a,!0),this.range.collapsed===!1){var b=this.selection.getMarker(2);this.selection.setMarker(this.range,b,!1)}this.savedSel=this.$editor.html()},getMarker:function(b){return"undefined"==typeof b&&(b=1),a('<span id="selection-marker-'+b+'" class="redactor-selection-marker"  data-verified="redactor">'+this.opts.invisibleSpace+"</span>")[0]},getMarkerAsHtml:function(a){return this.utils.getOuterHtml(this.selection.getMarker(a))},setMarker:function(a,b,c){a=a.cloneRange();try{a.collapse(c),a.insertNode(b)}catch(d){this.focus.setStart()}},restore:function(){var a=this.$editor.find("span#selection-marker-1"),b=this.$editor.find("span#selection-marker-2");0!==a.length&&0!==b.length?this.caret.set(a,0,b,0):0!==a.length?this.caret.set(a,0,a,0):this.$editor.focus(),this.selection.removeMarkers(),this.savedSel=!1},removeMarkers:function(){this.$editor.find("span.redactor-selection-marker").each(function(b,c){var d=a(c).text().replace(/[\u200B-\u200D\uFEFF]/g,"");""===d?a(c).remove():a(c).replaceWith(function(){return a(this).contents()})})},getText:function(){return this.selection.get(),this.sel.toString()},getHtml:function(){var a="";if(this.selection.get(),this.sel.rangeCount){for(var b=document.createElement("div"),c=this.sel.rangeCount,d=0;c>d;++d)b.appendChild(this.sel.getRangeAt(d).cloneContents());a=b.innerHTML}return this.clean.onSync(a)},replaceWithHtml:function(a){if(a=this.selection.getMarkerAsHtml(1)+a+this.selection.getMarkerAsHtml(2),this.selection.get(),window.getSelection&&window.getSelection().getRangeAt){this.range.deleteContents();var b=document.createElement("div");b.innerHTML=a;for(var c,d=document.createDocumentFragment();c=b.firstChild;)d.appendChild(c);this.range.insertNode(d)}else document.selection&&document.selection.createRange&&this.range.pasteHTML(a);this.selection.restore(),this.code.sync()}}},shortcuts:function(){return{init:function(b,c){return this.opts.shortcuts?void a.each(this.opts.shortcuts,a.proxy(function(c,d){for(var e=c.split(","),f=e.length,g=0;f>g;g++)"string"==typeof e[g]&&this.shortcuts.handler(b,a.trim(e[g]),a.proxy(function(){var a;"-1"!=d.func.search(/\./)?(a=d.func.split("."),"undefined"!=typeof this[a[0]]&&this[a[0]][a[1]].apply(this,d.params)):this[d.func].apply(this,d.params)},this))},this)):(!b.ctrlKey&&!b.metaKey||66!==c&&73!==c||b.preventDefault(),!1)},handler:function(b,c,d){var e={8:"backspace",9:"tab",10:"return",13:"return",16:"shift",17:"ctrl",18:"alt",19:"pause",20:"capslock",27:"esc",32:"space",33:"pageup",34:"pagedown",35:"end",36:"home",37:"left",38:"up",39:"right",40:"down",45:"insert",46:"del",59:";",61:"=",96:"0",97:"1",98:"2",99:"3",100:"4",101:"5",102:"6",103:"7",104:"8",105:"9",106:"*",107:"+",109:"-",110:".",111:"/",112:"f1",113:"f2",114:"f3",115:"f4",116:"f5",117:"f6",118:"f7",119:"f8",120:"f9",121:"f10",122:"f11",123:"f12",144:"numlock",145:"scroll",173:"-",186:";",187:"=",188:",",189:"-",190:".",191:"/",192:"`",219:"[",220:"\\",221:"]",222:"'"},f={"`":"~",1:"!",2:"@",3:"#",4:"$",5:"%",6:"^",7:"&",8:"*",9:"(",0:")","-":"_","=":"+",";":": ","'":'"',",":"<",".":">","/":"?","\\":"|"};c=c.toLowerCase().split(" ");var g=e[b.keyCode],h=String.fromCharCode(b.which).toLowerCase(),i="",j={};a.each(["alt","ctrl","meta","shift"],function(a,c){b[c+"Key"]&&g!==c&&(i+=c+"+")}),g&&(j[i+g]=!0),h&&(j[i+h]=!0,j[i+f[h]]=!0,"shift+"===i&&(j[f[h]]=!0));for(var k=0,l=c.length;l>k;k++)if(j[c[k]])return b.preventDefault(),d.apply(this,arguments)}}},tabifier:function(){return{get:function(a){if(!this.opts.tabifier)return a;var b=["area","body","head","hr","i?frame","link","meta","noscript","style","script","table","tbody","thead","tfoot"],c=["li","dt","dt","h[1-6]","option","script"],d=["p","blockquote","div","dl","fieldset","form","frameset","map","ol","pre","select","td","th","tr","ul"];this.tabifier.lineBefore=new RegExp("^<(/?"+b.join("|/?")+"|"+c.join("|")+")[ >]"),this.tabifier.lineAfter=new RegExp("^<(br|/?"+b.join("|/?")+"|/"+c.join("|/")+")[ >]"),this.tabifier.newLevel=new RegExp("^</?("+d.join("|")+")[ >]");var e=0,f=a.length,g=0,h=null,i=null,j="",k="",l="";for(this.tabifier.cleanlevel=0;f>e;e++){if(g=e,-1==a.substr(e).indexOf("<"))return k+=a.substr(e),this.tabifier.finish(k);for(;f>g&&"<"!=a.charAt(g);)g++;for(e!=g&&(l=a.substr(e,g-e),l.match(/^\s{2,}$/g)||("\n"==k.charAt(k.length-1)?k+=this.tabifier.getTabs():"\n"==l.charAt(0)&&(k+="\n"+this.tabifier.getTabs(),l=l.replace(/^\s+/,"")),k+=l),l.match(/\n/)&&(k+="\n"+this.tabifier.getTabs())),h=g;f>g&&">"!=a.charAt(g);)g++;j=a.substr(h,g-h),e=g;var m;if("!--"==j.substr(1,3)){if(!j.match(/--$/)){for(;"-->"!=a.substr(g,3);)g++;g+=2,j=a.substr(h,g-h),e=g}"\n"!=k.charAt(k.length-1)&&(k+="\n"),k+=this.tabifier.getTabs(),k+=j+">\n"}else"!"==j[1]?k=this.tabifier.placeTag(j+">",k):"?"==j[1]?k+=j+">\n":(m=j.match(/^<(script|style|pre)/i))?(m[1]=m[1].toLowerCase(),j=this.tabifier.cleanTag(j),k=this.tabifier.placeTag(j,k),i=String(a.substr(e+1)).toLowerCase().indexOf("</"+m[1]),i&&(l=a.substr(e+1,i),e+=i,k+=l)):(j=this.tabifier.cleanTag(j),k=this.tabifier.placeTag(j,k))}return this.tabifier.finish(k)},getTabs:function(){for(var a="",b=0;b<this.tabifier.cleanlevel;b++)a+="	";return a},finish:function(a){return a=a.replace(/\n\s*\n/g,"\n"),a=a.replace(/^[\s\n]*/,""),a=a.replace(/[\s\n]*$/,""),a=a.replace(/<script(.*?)>\n<\/script>/gi,"<script$1></script>"),this.tabifier.cleanlevel=0,a},cleanTag:function(a){var b="";a=a.replace(/\n/g," "),a=a.replace(/\s{2,}/g," "),a=a.replace(/^\s+|\s+$/g," ");var c="";a.match(/\/$/)&&(c="/",a=a.replace(/\/+$/,""));for(var d;d=/\s*([^= ]+)(?:=((['"']).*?\3|[^ ]+))?/.exec(a);)d[2]?b+=d[1].toLowerCase()+"="+d[2]:d[1]&&(b+=d[1].toLowerCase()),b+=" ",a=a.substr(d[0].length);return b.replace(/\s*$/,"")+c+">"},placeTag:function(a,b){var c=a.match(this.tabifier.newLevel);return(a.match(this.tabifier.lineBefore)||c)&&(b=b.replace(/\s*$/,""),b+="\n"),c&&"/"==a.charAt(1)&&this.tabifier.cleanlevel--,"\n"==b.charAt(b.length-1)&&(b+=this.tabifier.getTabs()),c&&"/"!=a.charAt(1)&&this.tabifier.cleanlevel++,b+=a,(a.match(this.tabifier.lineAfter)||a.match(this.tabifier.newLevel))&&(b=b.replace(/ *$/,"")),b}}},tidy:function(){return{setupAllowed:function(){if(this.opts.allowedTags&&(this.opts.deniedTags=!1),this.opts.allowedAttr&&(this.opts.removeAttr=!1),!this.opts.linebreaks){var a=["p","section"];this.opts.allowedTags&&this.tidy.addToAllowed(a),this.opts.deniedTags&&this.tidy.removeFromDenied(a)}},addToAllowed:function(b){for(var c=b.length,d=0;c>d;d++)-1==a.inArray(b[d],this.opts.allowedTags)&&this.opts.allowedTags.push(b[d])},removeFromDenied:function(b){for(var c=b.length,d=0;c>d;d++){var e=a.inArray(b[d],this.opts.deniedTags);-1!=e&&this.opts.deniedTags.splice(e,1)}},load:function(b,c){return this.tidy.settings={deniedTags:this.opts.deniedTags,allowedTags:this.opts.allowedTags,removeComments:this.opts.removeComments,replaceTags:this.opts.replaceTags,replaceStyles:this.opts.replaceStyles,removeDataAttr:this.opts.removeDataAttr,removeAttr:this.opts.removeAttr,allowedAttr:this.opts.allowedAttr,removeWithoutAttr:this.opts.removeWithoutAttr,removeEmpty:this.opts.removeEmpty},a.extend(this.tidy.settings,c),b=this.tidy.removeComments(b),this.tidy.$div=a("<div />").append(b),this.tidy.replaceTags(),this.tidy.replaceStyles(),this.tidy.removeTags(),this.tidy.removeAttr(),this.tidy.removeEmpty(),this.tidy.removeParagraphsInLists(),this.tidy.removeDataAttr(),this.tidy.removeWithoutAttr(),b=this.tidy.$div.html(),this.tidy.$div.remove(),b},removeComments:function(a){return this.tidy.settings.removeComments?a.replace(/<!--[\s\S]*?-->/gi,""):a},replaceTags:function(b){if(!this.tidy.settings.replaceTags)return b;for(var c=this.tidy.settings.replaceTags.length,d=[],e=[],f=0;c>f;f++)e.push(this.tidy.settings.replaceTags[f][1]),d.push(this.tidy.settings.replaceTags[f][0]);a.each(d,a.proxy(function(b,c){this.tidy.$div.find(c).replaceWith(function(){return a("<"+e[b]+" />",{html:a(this).html()})})},this))},replaceStyles:function(){if(this.tidy.settings.replaceStyles){var b=this.tidy.settings.replaceStyles.length;this.tidy.$div.find("span").each(a.proxy(function(c,d){for(var e=a(d),f=e.attr("style"),g=0;b>g;g++)if(f&&f.match(new RegExp("^"+this.tidy.settings.replaceStyles[g][0],"i"))){var h=this.tidy.settings.replaceStyles[g][1];e.replaceWith(function(){var b=document.createElement(h);return a(b).append(a(this).contents())})}},this))}},removeTags:function(){!this.tidy.settings.deniedTags&&this.tidy.settings.allowedTags&&this.tidy.$div.find("*").not(this.tidy.settings.allowedTags.join(",")).each(function(b,c){""===c.innerHTML?a(c).remove():a(c).contents().unwrap()}),this.tidy.settings.deniedTags&&this.tidy.$div.find(this.tidy.settings.deniedTags.join(",")).each(function(b,c){""===c.innerHTML?a(c).remove():a(c).contents().unwrap()})},removeAttr:function(){var b;if(!this.tidy.settings.removeAttr&&this.tidy.settings.allowedAttr){var c=[],d=[];b=this.tidy.settings.allowedAttr.length;for(var e=0;b>e;e++)c.push(this.tidy.settings.allowedAttr[e][0]),d.push(this.tidy.settings.allowedAttr[e][1]);this.tidy.$div.find("*").each(a.proxy(function(b,e){var f=a(e),g=a.inArray(f[0].tagName.toLowerCase(),c),h=this.tidy.removeAttrGetRemoves(g,d,f);h&&a.each(h,function(a,b){f.removeAttr(b)})},this))}if(this.tidy.settings.removeAttr){b=this.tidy.settings.removeAttr.length;for(var e=0;b>e;e++){var f=this.tidy.settings.removeAttr[e][1];a.isArray(f)&&(f=f.join(" ")),this.tidy.$div.find(this.tidy.settings.removeAttr[e][0]).removeAttr(f)}}},removeAttrGetRemoves:function(b,c,d){var e=[];return-1==b?a.each(d[0].attributes,function(a,b){e.push(b.name)}):"*"==c[b]?e=[]:a.each(d[0].attributes,function(d,f){a.isArray(c[b])?-1==a.inArray(f.name,c[b])&&e.push(f.name):c[b]!=f.name&&e.push(f.name)}),e},removeAttrs:function(b,c){return c=new RegExp(c,"g"),b.each(function(){for(var b=a(this),d=this.attributes.length-1,e=d;e>=0;e--){var f=this.attributes[e];f&&f.specified&&f.name.search(c)>=0&&b.removeAttr(f.name)}})},removeEmpty:function(){this.tidy.settings.removeEmpty&&this.tidy.$div.find(this.tidy.settings.removeEmpty.join(",")).each(function(){var b=a(this),c=b.text();c=c.replace(/[\u200B-\u200D\uFEFF]/g,""),c=c.replace(/&nbsp;/gi,""),c=c.replace(/\s/g,""),""===c&&0===b.children().length&&b.remove()})},removeParagraphsInLists:function(){this.tidy.$div.find("li p").contents().unwrap()},removeDataAttr:function(){if(this.tidy.settings.removeDataAttr){var b=this.tidy.settings.removeDataAttr;a.isArray(this.tidy.settings.removeDataAttr)&&(b=this.tidy.settings.removeDataAttr.join(",")),this.tidy.removeAttrs(this.tidy.$div.find(b),"^(data-)")}},removeWithoutAttr:function(){this.tidy.settings.removeWithoutAttr&&this.tidy.$div.find(this.tidy.settings.removeWithoutAttr.join(",")).each(function(){0===this.attributes.length&&a(this).contents().unwrap()})}}},toolbar:function(){return{init:function(){return{html:{title:this.lang.get("html"),func:"code.toggle"},formatting:{title:this.lang.get("formatting"),dropdown:{p:{title:this.lang.get("paragraph"),func:"block.format"},blockquote:{title:this.lang.get("quote"),func:"block.format"},pre:{title:this.lang.get("code"),func:"block.format"},h1:{title:this.lang.get("header1"),func:"block.format"},h2:{title:this.lang.get("header2"),func:"block.format"},h3:{title:this.lang.get("header3"),func:"block.format"},h4:{title:this.lang.get("header4"),func:"block.format"},h5:{title:this.lang.get("header5"),func:"block.format"},h6:{title:this.lang.get("header6"),func:"block.format"}}},bold:{title:this.lang.get("bold"),func:"inline.format"},italic:{title:this.lang.get("italic"),func:"inline.format"},deleted:{title:this.lang.get("deleted"),func:"inline.format"},underline:{title:this.lang.get("underline"),func:"inline.format"},unorderedlist:{title:"&bull; "+this.lang.get("unorderedlist"),func:"list.toggle"},orderedlist:{title:"1. "+this.lang.get("orderedlist"),func:"list.toggle"},outdent:{title:"< "+this.lang.get("outdent"),func:"indent.decrease"},indent:{title:"> "+this.lang.get("indent"),func:"indent.increase"},image:{title:this.lang.get("image"),func:"image.show"},file:{title:this.lang.get("file"),func:"file.show"},link:{title:this.lang.get("link"),dropdown:{link:{title:this.lang.get("link_insert"),func:"link.show"},unlink:{title:this.lang.get("unlink"),func:"link.unlink"}}},alignment:{title:this.lang.get("alignment"),dropdown:{left:{title:this.lang.get("align_left"),func:"alignment.left"},center:{title:this.lang.get("align_center"),func:"alignment.center"},right:{title:this.lang.get("align_right"),func:"alignment.right"},justify:{title:this.lang.get("align_justify"),func:"alignment.justify"}}},horizontalrule:{title:this.lang.get("horizontalrule"),func:"line.insert"}}},build:function(){this.toolbar.hideButtons(),this.toolbar.hideButtonsOnMobile(),this.toolbar.isButtonSourceNeeded(),0!==this.opts.buttons.length&&(this.$toolbar=this.toolbar.createContainer(),this.toolbar.setOverflow(),this.toolbar.append(),this.toolbar.setFormattingTags(),this.toolbar.loadButtons(),this.toolbar.setFixed(),this.opts.activeButtons&&this.$editor.on("mouseup.redactor keyup.redactor focus.redactor",a.proxy(this.observe.buttons,this)))},createContainer:function(){return a("<ul>").addClass("redactor-toolbar").attr("id","redactor-toolbar-"+this.uuid)},setFormattingTags:function(){a.each(this.opts.toolbar.formatting.dropdown,a.proxy(function(b,c){-1==a.inArray(b,this.opts.formatting)&&delete this.opts.toolbar.formatting.dropdown[b]},this))},loadButtons:function(){a.each(this.opts.buttons,a.proxy(function(b,c){if(this.opts.toolbar[c]){if("file"===c){if(this.opts.fileUpload===!1)return;if(!this.opts.fileUpload&&this.opts.s3===!1)return}if("image"===c){if(this.opts.imageUpload===!1)return;if(!this.opts.imageUpload&&this.opts.s3===!1)return}var d=this.opts.toolbar[c];this.$toolbar.append(a("<li>").append(this.button.build(c,d)))}},this))},append:function(){this.opts.toolbarExternal?(this.$toolbar.addClass("redactor-toolbar-external"),a(this.opts.toolbarExternal).html(this.$toolbar)):this.$box.prepend(this.$toolbar)},setFixed:function(){this.utils.isDesktop()&&(this.opts.toolbarExternal||this.opts.toolbarFixed&&(this.toolbar.observeScroll(),a(this.opts.toolbarFixedTarget).on("scroll.redactor."+this.uuid,a.proxy(this.toolbar.observeScroll,this))))},setOverflow:function(){this.utils.isMobile()&&this.opts.toolbarOverflow&&this.$toolbar.addClass("redactor-toolbar-overflow")},isButtonSourceNeeded:function(){if(!this.opts.source){var a=this.opts.buttons.indexOf("html");-1!==a&&this.opts.buttons.splice(a,1)}},hideButtons:function(){0!==this.opts.buttonsHide.length&&a.each(this.opts.buttonsHide,a.proxy(function(a,b){var c=this.opts.buttons.indexOf(b);c>=0&&this.opts.buttons.splice(c,1)},this))},hideButtonsOnMobile:function(){this.utils.isMobile()&&0!==this.opts.buttonsHideOnMobile.length&&a.each(this.opts.buttonsHideOnMobile,a.proxy(function(a,b){var c=this.opts.buttons.indexOf(b);this.opts.buttons.splice(c,1)},this))},observeScroll:function(){var b=a(this.opts.toolbarFixedTarget).scrollTop(),c=1;this.opts.toolbarFixedTarget===document&&(c=this.$box.offset().top),b>c?this.toolbar.observeScrollEnable(b,c):this.toolbar.observeScrollDisable()},observeScrollEnable:function(b,c){var d=this.$toolbar.height(),e=(this.opts.toolbarFixedTopOffset+b-c-d,c+this.$box.height()-d),f=this.$box.innerWidth();this.$box.css("paddingTop",d+"px"),this.$toolbar.addClass("toolbar-fixed-box"),this.$toolbar.css({position:"fixed",width:f,top:0,left:this.$box.offset().left-a(this.opts.toolbarFixedTarget).scrollLeft()}),b>e&&a(".redactor-dropdown-"+this.uuid+":visible").hide(),this.toolbar.setDropdownsFixed(),this.$toolbar.css("visibility",e>b?"visible":"hidden")},observeScrollDisable:function(){this.$toolbar.css({position:"relative",width:"auto",top:0,left:0,visibility:"visible"}),this.$box.css("paddingTop",""),this.toolbar.unsetDropdownsFixed(),this.$toolbar.removeClass("toolbar-fixed-box")},setDropdownsFixed:function(){var b=this.$toolbar.innerHeight()+this.opts.toolbarFixedTopOffset,c="fixed";this.opts.toolbarFixedTarget!==document&&(b=this.$toolbar.innerHeight()+this.$toolbar.offset().top+this.opts.toolbarFixedTopOffset,c="absolute"),a(".redactor-dropdown-"+this.uuid).each(function(){a(this).css({position:c,top:b+"px"})})},unsetDropdownsFixed:function(){var b=this.$toolbar.innerHeight()+this.$toolbar.offset().top;a(".redactor-dropdown-"+this.uuid).each(function(){a(this).css({position:"absolute",top:b+"px"})})}}},upload:function(){return{init:function(b,c,d){
this.upload.direct=!1,this.upload.callback=d,this.upload.url=c,this.upload.$el=a(b),this.upload.$droparea=a('<div id="redactor-droparea" />'),this.upload.$placeholdler=a('<div id="redactor-droparea-placeholder" />').text(this.lang.get("upload_label")),this.upload.$input=a('<input type="file" name="file" />'),this.upload.$placeholdler.append(this.upload.$input),this.upload.$droparea.append(this.upload.$placeholdler),this.upload.$el.append(this.upload.$droparea),this.upload.$droparea.off("redactor.upload"),this.upload.$input.off("redactor.upload"),this.upload.$droparea.on("dragover.redactor.upload",a.proxy(this.upload.onDrag,this)),this.upload.$droparea.on("dragleave.redactor.upload",a.proxy(this.upload.onDragLeave,this)),this.upload.$input.on("change.redactor.upload",a.proxy(function(a){a=a.originalEvent||a,this.upload.traverseFile(this.upload.$input[0].files[0],a)},this)),this.upload.$droparea.on("drop.redactor.upload",a.proxy(function(a){a.preventDefault(),this.upload.$droparea.removeClass("drag-hover").addClass("drag-drop"),this.upload.onDrop(a)},this))},directUpload:function(a,b){this.upload.direct=!0,this.upload.traverseFile(a,b)},onDrop:function(a){a=a.originalEvent||a;var b=a.dataTransfer.files;this.upload.traverseFile(b[0],a)},traverseFile:function(a,b){if(this.opts.s3)return this.upload.setConfig(a),void this.upload.s3uploadFile(a);var c=window.FormData?new FormData:null;if(window.FormData){this.upload.setConfig(a);var d="image"==this.upload.type?this.opts.imageUploadParam:this.opts.fileUploadParam;c.append(d,a)}this.progress.show(),this.core.setCallback("uploadStart",b,c),this.upload.sendData(c,b)},setConfig:function(a){this.upload.getType(a),this.upload.direct&&(this.upload.url="image"==this.upload.type?this.opts.imageUpload:this.opts.fileUpload,this.upload.callback="image"==this.upload.type?this.image.insert:this.file.insert)},getType:function(a){this.upload.type="image",-1==this.opts.imageTypes.indexOf(a.type)&&(this.upload.type="file")},getHiddenFields:function(b,c){return b===!1||"object"!=typeof b?c:(a.each(b,a.proxy(function(b,d){null!==d&&0===d.toString().indexOf("#")&&(d=a(d).val()),c.append(b,d)},this)),c)},sendData:function(b,c){"image"==this.upload.type?(b=this.upload.getHiddenFields(this.opts.uploadImageFields,b),b=this.upload.getHiddenFields(this.upload.imageFields,b)):(b=this.upload.getHiddenFields(this.opts.uploadFileFields,b),b=this.upload.getHiddenFields(this.upload.fileFields,b));var d=new XMLHttpRequest;d.open("POST",this.upload.url),d.setRequestHeader("X-Requested-With","XMLHttpRequest"),d.onreadystatechange=a.proxy(function(){if(4==d.readyState){var b=d.responseText;b=b.replace(/^\[/,""),b=b.replace(/\]$/,"");var e;try{e="string"==typeof b?a.parseJSON(b):b}catch(f){e={error:!0}}this.progress.hide(),this.upload.direct||this.upload.$droparea.removeClass("drag-drop"),this.upload.callback(e,this.upload.direct,c)}},this),d.send(b)},onDrag:function(a){a.preventDefault(),this.upload.$droparea.addClass("drag-hover")},onDragLeave:function(a){a.preventDefault(),this.upload.$droparea.removeClass("drag-hover")},clearImageFields:function(){this.upload.imageFields={}},addImageFields:function(a,b){this.upload.imageFields[a]=b},removeImageFields:function(a){delete this.upload.imageFields[a]},clearFileFields:function(){this.upload.fileFields={}},addFileFields:function(a,b){this.upload.fileFields[a]=b},removeFileFields:function(a){delete this.upload.fileFields[a]},s3uploadFile:function(b){this.upload.s3executeOnSignedUrl(b,a.proxy(function(a){this.upload.s3uploadToS3(b,a)},this))},s3executeOnSignedUrl:function(a,b){var c=new XMLHttpRequest,d="?";"-1"!=this.opts.s3.search(/\?/)&&(d="&"),c.open("GET",this.opts.s3+d+"name="+a.name+"&type="+a.type,!0),c.overrideMimeType&&c.overrideMimeType("text/plain; charset=x-user-defined");var e=this;c.onreadystatechange=function(a){4==this.readyState&&200==this.status?(e.progress.show(),b(decodeURIComponent(this.responseText))):4==this.readyState&&200!=this.status},c.send()},s3createCORSRequest:function(a,b){var c=new XMLHttpRequest;return"withCredentials"in c?c.open(a,b,!0):"undefined"!=typeof XDomainRequest?(c=new XDomainRequest,c.open(a,b)):c=null,c},s3uploadToS3:function(b,c){var d=this.upload.s3createCORSRequest("PUT",c);d&&(d.onload=a.proxy(function(){if(200==d.status){this.progress.hide();var a=c.split("?");if(!a[0])return!1;this.upload.direct||this.upload.$droparea.removeClass("drag-drop");var b={filelink:a[0]};if("file"==this.upload.type){var e=a[0].split("/");b.filename=e[e.length-1]}this.upload.callback(b,this.upload.direct,!1)}},this),d.onerror=function(){},d.upload.onprogress=function(a){},d.setRequestHeader("Content-Type",b.type),d.setRequestHeader("x-amz-acl","public-read"),d.send(b))}}},utils:function(){return{isMobile:function(){return/(iPhone|iPod|BlackBerry|Android)/.test(navigator.userAgent)},isDesktop:function(){return!/(iPhone|iPod|iPad|BlackBerry|Android)/.test(navigator.userAgent)},isString:function(a){return"[object String]"==Object.prototype.toString.call(a)},isEmpty:function(b,c){return b=b.replace(/[\u200B-\u200D\uFEFF]/g,""),b=b.replace(/&nbsp;/gi,""),b=b.replace(/<\/?br\s?\/?>/g,""),b=b.replace(/\s/g,""),b=b.replace(/^<p>[^\W\w\D\d]*?<\/p>$/i,""),b=b.replace(/<iframe(.*?[^>])>$/i,"iframe"),b=b.replace(/<source(.*?[^>])>$/i,"source"),c!==!1&&(b=b.replace(/<[^\/>][^>]*><\/[^>]+>/gi,""),b=b.replace(/<[^\/>][^>]*><\/[^>]+>/gi,"")),b=a.trim(b),""===b},normalize:function(a){return"undefined"==typeof a?0:parseInt(a.replace("px",""),10)},hexToRgb:function(a){if("undefined"!=typeof a){if(-1==a.search(/^#/))return a;var b=/^#?([a-f\d])([a-f\d])([a-f\d])$/i;a=a.replace(b,function(a,b,c,d){return b+b+c+c+d+d});var c=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(a);return"rgb("+parseInt(c[1],16)+", "+parseInt(c[2],16)+", "+parseInt(c[3],16)+")"}},getOuterHtml:function(b){return a("<div>").append(a(b).eq(0).clone()).html()},getAlignmentElement:function(b){return-1!==a.inArray(b.tagName,this.opts.alignmentTags)?a(b):a(b).closest(this.opts.alignmentTags.toString().toLowerCase(),this.$editor[0])},removeEmptyAttr:function(b,c){var d=a(b);return"undefined"==typeof d.attr(c)?!0:""===d.attr(c)?(d.removeAttr(c),!0):!1},removeEmpty:function(b,c){var d=a(a.parseHTML(c));if(d.find(".redactor-invisible-space").removeAttr("style").removeAttr("class"),0===d.find("hr, br, img, video, iframe, source").length){var e=a.trim(d.text());this.utils.isEmpty(e,!1)&&d.remove()}},saveScroll:function(){this.saveEditorScroll=this.$editor.scrollTop(),this.saveBodyScroll=a(window).scrollTop(),this.opts.scrollTarget&&(this.saveTargetScroll=a(this.opts.scrollTarget).scrollTop())},restoreScroll:function(){("undefined"!=typeof this.saveScroll||"undefined"!=typeof this.saveBodyScroll)&&(a(window).scrollTop(this.saveBodyScroll),this.$editor.scrollTop(this.saveEditorScroll),this.opts.scrollTarget&&a(this.opts.scrollTarget).scrollTop(this.saveTargetScroll))},createSpaceElement:function(){var a=document.createElement("span");return a.className="redactor-invisible-space",a.innerHTML=this.opts.invisibleSpace,a},removeInlineTags:function(b){var c=this.opts.inlineTags;c.push("span"),"PRE"==b.tagName&&c.push("a"),a(b).find(c.join(",")).not("span.redactor-selection-marker").contents().unwrap()},replaceWithContents:function(b,c){var d=this;return a(b).replaceWith(function(){return c===!0&&d.utils.removeInlineTags(this),a(this).contents()}),a(b)},replaceToTag:function(b,c,d){var e,f=this;return a(b).replaceWith(function(){e=a("<"+c+" />").append(a(this).contents());for(var b=0;b<this.attributes.length;b++)e.attr(this.attributes[b].name,this.attributes[b].value);return d===!0&&f.utils.removeInlineTags(e),e}),e},isStartOfElement:function(){var a=this.selection.getBlock();if(!a)return!1;var b=this.caret.getOffsetOfElement(a);return 0===b?!0:!1},isEndOfElement:function(b){if("undefined"==typeof b){var b=this.selection.getBlock();if(!b)return!1}var c=this.caret.getOffsetOfElement(b),d=a.trim(a(b).text()).replace(/\n\r\n/g,"");return c==d.length?!0:!1},isEndOfEditor:function(){var b=this.$editor[0],c=this.caret.getOffsetOfElement(b),d=a.trim(a(b).html().replace(/(<([^>]+)>)/gi,""));return c==d.length?!0:!1},isBlock:function(a){return a=a[0]||a,a&&this.utils.isBlockTag(a.tagName)},isBlockTag:function(a){return"undefined"==typeof a?!1:this.reIsBlock.test(a)},isInline:function(a){return a=a[0]||a,a&&this.utils.isInlineTag(a.tagName)},isInlineTag:function(a){return"undefined"==typeof a?!1:this.reIsInline.test(a)},isTag:function(b,c){var d=a(b).closest(c,this.$editor[0]);return 1==d.length?d[0]:!1},isSelectAll:function(){return this.selectAll},enableSelectAll:function(){this.selectAll=!0},disableSelectAll:function(){this.selectAll=!1},isRedactorParent:function(b){return b?0===a(b).parents(".redactor-editor").length||a(b).hasClass("redactor-editor")?!1:b:!1},isCurrentOrParentHeader:function(){return this.utils.isCurrentOrParent(["H1","H2","H3","H4","H5","H6"])},isCurrentOrParent:function(b){var c=this.selection.getParent(),d=this.selection.getCurrent();if(a.isArray(b)){var e=0;return a.each(b,a.proxy(function(a,b){this.utils.isCurrentOrParentOne(d,c,b)&&e++},this)),0===e?!1:!0}return this.utils.isCurrentOrParentOne(d,c,b)},isCurrentOrParentOne:function(a,b,c){return c=c.toUpperCase(),b&&b.tagName===c?b:a&&a.tagName===c?a:!1},isOldIe:function(){return this.utils.browser("msie")&&parseInt(this.utils.browser("version"),10)<9?!0:!1},isLessIe10:function(){return this.utils.browser("msie")&&parseInt(this.utils.browser("version"),10)<10?!0:!1},isIe11:function(){return!!navigator.userAgent.match(/Trident\/7\./)},browser:function(a){var b=navigator.userAgent.toLowerCase(),c=/(opr)[\/]([\w.]+)/.exec(b)||/(chrome)[ \/]([\w.]+)/.exec(b)||/(webkit)[ \/]([\w.]+).*(safari)[ \/]([\w.]+)/.exec(b)||/(webkit)[ \/]([\w.]+)/.exec(b)||/(opera)(?:.*version|)[ \/]([\w.]+)/.exec(b)||/(msie) ([\w.]+)/.exec(b)||b.indexOf("trident")>=0&&/(rv)(?::| )([\w.]+)/.exec(b)||b.indexOf("compatible")<0&&/(mozilla)(?:.*? rv:([\w.]+)|)/.exec(b)||[];return"safari"==a?"undefined"!=typeof c[3]?"safari"==c[3]:!1:"version"==a?c[2]:"webkit"==a?"chrome"==c[1]||"opr"==c[1]||"webkit"==c[1]:"rv"==c[1]?"msie"==a:"opr"==c[1]?"webkit"==a:a==c[1]}}},linkify:function(){return{isKey:function(a){return a==this.keyCode.ENTER||a==this.keyCode.SPACE},isEnabled:function(){return this.opts.convertLinks&&(this.opts.convertUrlLinks||this.opts.convertImageLinks||this.opts.convertVideoLinks)&&!this.utils.isCurrentOrParent("PRE")},format:function(){var b=this.linkify,c=this.opts;this.$editor.find(":not(iframe,img,a,pre)").addBack().contents().filter(function(){return 3===this.nodeType&&""!=a.trim(this.nodeValue)&&!a(this).parent().is("pre")&&(this.nodeValue.match(c.linkify.regexps.youtube)||this.nodeValue.match(c.linkify.regexps.vimeo)||this.nodeValue.match(c.linkify.regexps.image)||this.nodeValue.match(c.linkify.regexps.url))}).each(function(){var d=a(this).text(),e=d;c.convertVideoLinks&&(e.match(c.linkify.regexps.youtube)||e.match(c.linkify.regexps.vimeo))?e=b.convertVideoLinks(e):c.convertImageLinks&&e.match(c.linkify.regexps.image)?e=b.convertImages(e):c.convertUrlLinks&&(e=b.convertLinks(e)),a(this).before(d.replace(d,e)).remove()}),this.linkify.after()},convertVideoLinks:function(a){var b='<iframe width="500" height="281" src="',c='" frameborder="0" allowfullscreen></iframe>';return a.match(this.opts.linkify.regexps.youtube)&&(a=a.replace(this.opts.linkify.regexps.youtube,b+"//www.youtube.com/embed/$1"+c)),a.match(this.opts.linkify.regexps.vimeo)&&(a=a.replace(this.opts.linkify.regexps.vimeo,b+"//player.vimeo.com/video/$2"+c)),a},convertImages:function(a){var b=a.match(this.opts.linkify.regexps.image);return b&&(a=a.replace(a,'<img src="'+b+'" />')),a},convertLinks:function(b){var c=b.match(this.opts.linkify.regexps.url);if(c){c=a.grep(c,function(b,d){return a.inArray(b,c)===d});for(var d=c.length,e=0;d>e;e++){var f=c[e],g=f,h=this.opts.linkProtocol+"://";null!==f.match(/(https?|ftp):\/\//i)&&(h=""),g.length>this.opts.linkSize&&(g=g.substring(0,this.opts.linkSize)+"..."),g=decodeURIComponent(g);var i="\\b";-1!=a.inArray(f.slice(-1),["/","&","="])&&(i="");var j=new RegExp("("+f.replace(/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g,"\\$&")+i+")","g");b=b.replace(j,'<a href="'+h+a.trim(f)+'">'+a.trim(g)+"</a>")}}return b},after:function(){this.observe.load(),this.code.sync()}}}},a(window).on("load.tools.redactor",function(){a('[data-tools="redactor"]').redactor()}),b.prototype.init.prototype=b.prototype}(jQuery),function(a){"use strict";var b={browseFileURL:"",browseMediaURL:"",browseSiteURL:"",browseComposerSiteURL:"",convertDivs:!1,convertImageLinks:!0,convertVideoLinks:!0,emptyHtml:"&#x200b;",indentValue:parseFloat(a(document.body).css("font-size")),langs:{en:{browse:"Browse",browse_composer:"Browse Composer","class":"Class",class_attr_description:"Optional; can be used to assign a particular CSS class to this link.",composer_site_page_browse_title:"Browse Composer Site Pages",link:"Link",link_insert:"Insert link",link_edit:"Edit link",link_new_tab:"Open link in new tab",title_attr_description:"Optional but strongly recommended. This text appears when users hover over the link; it's used to provide additional details about the link target. (Not related to SEO optimization.)",id_attr_description:"Give this link a unique ID, allowing users to jump directly to this element from a different spot on the page. Create the jump using another link that starts with a # and points to this ID.",site_page:"Site Page",site_page_select:"Please select a site page",site_page_browse_title:"Browse Site Pages",site_file:"Site File",site_file_select:"Please select a file",site_file_browse_title:"Browse Site Files",style:"Style",media:"Media",media_select:"Please select media",media_browse_title:"Browse Media",video:"Insert Embed",video_html_code:"Embed Code"}},paragraphy:!1,removeEmptyTags:!1,removeWithoutAttr:!1,removeEmpty:!1,replaceDivs:!1,paragraphize:!1,tidyHtml:!1,codeOnly:!1};a.RedactorExtend={buffer:function(){return a.extend(Object.getPrototypeOf(this).buffer(),{set:function(a,b){"undefined"==typeof a||"undo"==a?(this.buffer.setUndo(),b||this.buffer.clearRebuffer()):this.buffer.setRedo(),this.buffer.toggleUndoButtonStatus()},setUndo:function(){this.selection.save(),this.opts.buffer.push(this.$editor.html()),this.selection.restore()},getUndo:function(){this.$editor.html(this.opts.buffer.pop()),this.buffer.toggleUndoButtonStatus()},getRedo:function(){this.$editor.html(this.opts.rebuffer.pop()),this.buffer.toggleUndoButtonStatus()},redo:function(){0!==this.opts.rebuffer.length&&(this.buffer.set("undo",!0),this.buffer.getRedo(),this.selection.restore(),setTimeout(a.proxy(this.observe.load,this),50))},clearBuffer:function(){for(;this.opts.buffer.length>0;)this.opts.buffer.pop();this.buffer.toggleUndoButtonStatus()},clearRebuffer:function(){for(;this.opts.rebuffer.length>0;)this.opts.rebuffer.pop();this.buffer.toggleUndoButtonStatus()},toggleUndoButtonStatus:function(){this.$toolbar.find(".re-undo").toggleClass("redactor-button-disabled",!this.opts.buffer.length),this.$toolbar.find(".re-redo").toggleClass("redactor-button-disabled",!this.opts.rebuffer.length)}})},core:function(){return a.extend(Object.getPrototypeOf(this).core(),{setCallback:function(b,c,d){var e=this.opts[b+"Callback"];return this.$element.trigger(b+".redactor-api",c,d),a.isFunction(e)?"undefined"==typeof d?e.call(this,c):e.call(this,c,d):"undefined"==typeof d?c:d}})},code:function(){return a.extend(Object.getPrototypeOf(this).code(),{get:function(){var a=this.$textarea.val();return a}})},clean:function(){return a.extend(Object.getPrototypeOf(this).clean(),{removeSpaces:function(a){return a},clearUnverified:function(){},clearUnverifiedRemove:function(){}})},indent:function(){return a.extend(Object.getPrototypeOf(this).indent(),{decreaseBlocks:function(){a.each(this.selection.getBlocks(),a.proxy(function(a,b){var c=this.utils.getAlignmentElement(b),d=parseFloat(c.css("font-size")),e=(this.utils.normalize(c.css("margin-left"))-d)/d;0>=e?this.opts.linebreaks&&"undefined"!=typeof c.data("tagblock")?c.replaceWith(c.html()+"<br />"):(c.css("margin-left",""),this.utils.removeEmptyAttr(c,"style")):c.css("margin-left",e+"em")},this))},increaseBlocks:function(){a.each(this.selection.getBlocks(),a.proxy(function(a,b){if("TD"!==b.tagName&&"TH"!==b.tagName){var c=this.utils.getAlignmentElement(b),d=parseFloat(c.css("font-size")),e=(this.utils.normalize(c.css("margin-left"))+d)/d;c.css("margin-left",e+"em")}},this))},increaseText:function(){var b=this.selection.wrap("div");a(b).attr("data-tagblock","redactor"),a(b).css("margin-left",this.opts.indentValue/parseFloat(a(document.body).css("font-size")+"em"))}})},observe:function(){return a.extend(Object.getPrototypeOf(this).observe(),{images:function(){var b=this;this.$editor.find("img,video,iframe,audio,table").each(function(c,d){var e=a(d);e.closest("a").on("click",function(a){a.preventDefault()}),b.utils.browser("msie")&&e.attr("unselectable","on"),b.$editor.trigger("observed.redactor."+d.tagName.toLowerCase(),d)})}})},fs:function(){return{init:function(){this.opts.codeOnly&&this.button.remove("html"),this.button.addCallback(this.button.addAfter("html","undo","Undo (ctrl + z)"),this.buffer.undo),this.button.addCallback(this.button.addAfter("undo","redo","Redo (ctrl + shift + z)"),this.buffer.redo),this.buffer.clearRebuffer(),this.buffer.clearBuffer()},hidePluginButtons:function(){0!==this.opts.buttonsHide.length&&a.each(this.opts.buttonsHide,a.proxy(function(a,b){this.button.remove(b)},this))},setInlineStyle:function(b){if(this.utils.browser("mozilla")&&this.focus.isFocused()&&this.$editor.focus(),this.buffer.set(),this.selection.get(),a("#redactor-overlay-box").length)return b(this.fs.$editTarget),void this.code.sync();var c=this.sel.getRangeAt(0);if(this.sel.isCollapsed){var d=c.commonAncestorContainer;d.nodeType===Node.TEXT_NODE&&(d=d.parentElement),this.range.selectNodeContents(d),this.selection.addRange()}this.fs.setImageFloatFix(),document.execCommand("createLink",!1,"redactor-temporary"),this.fs.unsetImageFloatFix();var e=[],f=this.$editor.find('a[href="redactor-temporary"]');f.each(function(){var b=a(this),c=b.text().replace("redactor-temporary"," ");if(c!==b.parent().text()||b.parent().hasClass(".redactor-editor"))if(c===b.children(":first").text())e.push(b.children(":first")[0]),b.replaceWith(this.childNodes);else{var d=a("<span/>").append(c);b.replaceWith(d),e.push(d[0])}else e.push(b.parent()[0]),b.replaceWith(this.childNodes)}),b(e),this.caret.set(e[0],0,e[e.length-1],1),this.code.sync()},sync:function(){var a=this.$textarea.val();a=a.replace(/<span(.*?)id="redactor-overlay-box"(.*?[^>])>(.*?)<\/span>/gi,""),this.$textarea.val(a)},buildPicker:function(b,c,d,e,f){for(var g="backcolor"===c?"background-color":"color",h=d.length,i=function(b){b.preventDefault(),b.stopPropagation(),e(a(this).data("rule"),a(this).attr("rel"))},j=0;h>j;j++){var k=d[j],l=a('<a rel="'+k+'" data-rule="'+g+'" href="#" style="float: left; font-size: 0; border: 2px solid #fff; padding: 0; margin: 0; width: 22px; height: 22px;"></a>');l.css("background-color",k),l.on("click",i),b.append(l)}var m=a('<a href="#" style="display: block; clear: both; padding: 5px; font-size: 12px; line-height: 1;"></a>').html(this.lang.get("none"));m.on("click",function(a){a.preventDefault(),a.stopPropagation(),f(g)}),b.append(m)},cleanID:function(a){return a.replace(/[\s"']/g,"")},colors:["#ffffff","#000000","#eeece1","#1f497d","#4f81bd","#c0504d","#9bbb59","#8064a2","#4bacc6","#f79646","#ffff00","#f2f2f2","#7f7f7f","#ddd9c3","#c6d9f0","#dbe5f1","#f2dcdb","#ebf1dd","#e5e0ec","#dbeef3","#fdeada","#fff2ca","#d8d8d8","#595959","#c4bd97","#8db3e2","#b8cce4","#e5b9b7","#d7e3bc","#ccc1d9","#b7dde8","#fbd5b5","#ffe694","#bfbfbf","#3f3f3f","#938953","#548dd4","#95b3d7","#d99694","#c3d69b","#b2a2c7","#b7dde8","#fac08f","#f2c314","#a5a5a5","#262626","#494429","#17365d","#366092","#953734","#76923c","#5f497a","#92cddc","#e36c09","#c09100","#7f7f7f","#0c0c0c","#1d1b10","#0f243e","#244061","#632423","#4f6128","#3f3151","#31859b","#974806","#7f6000"],dropdownShow:function(b,c){if("formatting"===c.key){var d=a(".redactor-dropdown");d.find(".highlight").removeClass("highlight"),this.selection.getBlock()&&d.find(".redactor-dropdown-"+this.selection.getBlock().tagName.toLowerCase()).addClass("highlight")}this.$editor.trigger("dropdownShow.redactor")},modalIframeBrowseInit:function(){this.$redactorModalBrowser=a("#redactor-modal-iframe-browser"),this.$redactorModalBrowser.length||(this.$modalBox.append('<div id="redactor-modal-iframe-browser"><iframe frameborder="0" height="100%" width="100%" /><footer><div style="width:100%;"><button type="button" class="redactor-button-modal-close">Cancel</button></div></footer></div>'),this.$redactorModalBrowser=a("#redactor-modal-iframe-browser",this.$modalBox)),a("#redactor-modal",this.$modal).css("left",0),this.$redactorModalBrowser.hide().css("left",this.$modal.outerWidth())},modalIframeBrowse:function(b,c,d){var e=a.proxy(function(){window.removeEventListener("message",f,!1),this.$redactorModalBrowser.off("click"),this.$editor.off("redactor.modalClose.iframeBrowser"),this.$redactorModalBrowser.css({opacity:0,"z-index":this.$modal.css("z-index")-1}),this.$modal.css("opacity",1);var a=this;setTimeout(function(){a.$redactorModalBrowser.find("iframe").removeAttr("src")},500)},this),f=a.proxy(function(a){var b=JSON.parse(a.data);c.call(this,b),e()},this);d=d||this.$modal.outerWidth(),window.addEventListener("message",f,!1),this.$redactorModalBrowser.on("click",".redactor-button-modal-close",a.proxy(e,this)),this.$editor.on("redactor.modalClose.iframeBrowser",a.proxy(e,this)),this.$redactorModalBrowser.find("iframe").attr("src",b),this.$modal.css("opacity",0),this.$redactorModalBrowser.show().css({width:d,height:this.$modal.outerHeight(),left:parseInt(a(window).width()/2)-parseInt(d/2),opacity:1,top:this.$modal.css("marginTop"),"z-index":this.$modal.css("z-index")+1})},loadEditableControls:function(b){var c=this,d=b.element,e=a.extend({top:0,left:0},b.offset);this.fs.hideEditableControls(!1),b.bCancelSelection||(this.selection.get(),this.range.selectNode(d[0]),this.selection.addRange()),this.fs.$editBox=a('<span id="redactor-overlay-box" data-redactor="verified">'),this.fs.$editBox.attr("contenteditable","false"),this.fs.$editBox.attr("unselectable","on"),this.fs.$editControls=a("<ul></ul>"),this.fs.$editTarget=d,this.fs.$editTarget.data("offset",e),this.fs.$editBox.addClass("redactor-overlay-type-"+d[0].tagName.toLowerCase()),this.fs.editBoxOnHide=b.onHide,this.$editor.append(this.fs.$editBox),this.fs.$editBox.append(this.fs.$editControls),this.$editor.on("click.redactor.hideEditableControls",this.fs.hideEditableControls),a(document).on("click.redactor.hideEditableControls",this.fs.hideEditableControls),a(this.opts.toolbarFixedTarget).on("scroll.redactor.scrollEditableControls",this.fs.scrollEditableControls),a(document).on("mouseup.redactor.checkOverlay keyup.redactor.checkOverlay",this.fs.checkOverlay),this.fs.positionControls(),a.each(b.buttons,function(a,b){c.fs.addEditableButton(b)})},positionControls:function(){var a=this.fs.$editTarget.data("offset");this.fs.$editBox.css({top:this.fs.$editTarget.position().top+parseInt(this.fs.$editTarget.css("marginTop"))+this.$editor[0].scrollTop+a.top,left:this.fs.$editTarget.position().left+parseInt(this.fs.$editTarget.css("marginLeft"))+a.left,width:this.fs.$editTarget.outerWidth(),height:this.fs.$editTarget.outerHeight()}),this.fs.$editControls.data("original-offset")||this.fs.$editControls.data("original-offset",this.fs.$editControls.offset()),this.fs.scrollEditableControls()},hideEditableControls:function(b){return b&&b.target===this.fs.$editTarget[0]?!1:b&&a(b.target).closest(".redactor-dropdown").length?!1:this.fs.editBoxOnHide&&!this.fs.editBoxOnHide(b)?!1:(this.$editor.off(".hideEditableControls"),a(document).off(".checkOverlay"),a(document).off(".hideEditableControls"),a(this.opts.toolbarFixedTarget).off(".scrollEditableControls"),this.fs.editBoxOnHide=!1,void a("#redactor-overlay-box").remove())},checkOverlay:function(){return this.fs.$editTarget.parent().length?(this.observe.images(),void this.fs.positionControls()):void this.fs.hideEditableControls()},scrollEditableControls:function(){var a=this.$toolbar.offset().top+this.$toolbar.height(),b=a-this.fs.$editControls.data("original-offset").top;this.fs.$editControls.css(b>0&&b<this.fs.$editBox.height()?{top:b}:{top:""})},addEditableButton:function(b){var c=this,d=a('<li><button type="button" class="re-icon '+b["class"]+'" title="'+b.title+'"/></li>');d.on("click",function(a){a.stopPropagation(),a.preventDefault(),b.onClick(),c.fs.$editTarget.parent().length||c.fs.hideEditableControls(!1)}),this.fs.$editControls.append(d)},rgb2hex:function(a){function b(a){return("0"+parseInt(a).toString(16)).slice(-2)}return a?(a=a.match(/^rgb\((\d+),\s*(\d+),\s*(\d+)\)$/),"#"+b(a[1])+b(a[2])+b(a[3])):""},setAttr:function(b,c,d){a.trim(d).length?b.attr(c,d):b.removeAttr(c)},setImageFloatFix:function(){a.each(this.selection.getNodes(),function(b,c){if("IMG"===c.tagName){var d=a(c);"none"!==d.css("float")&&(d.attr("data-redactor-save-float",d.css("float")),d.css("float","none"))}})},unsetImageFloatFix:function(){a.each(this.selection.getNodes(),function(b,c){if("IMG"===c.tagName){var d=a(c);d.attr("data-redactor-save-float")&&(d.css("float",d.attr("data-redactor-save-float")),d.removeAttr("data-redactor-save-float"))}})},snapSelectionToWord:function(){var a;if(window.getSelection&&(a=window.getSelection()).modify){if(a=window.getSelection(),!a.isCollapsed){var b=document.createRange();b.setStart(a.anchorNode,a.anchorOffset),b.setEnd(a.focusNode,a.focusOffset);var c=b.collapsed;b.detach();var d=a.focusNode,e=a.focusOffset;a.collapse(a.anchorNode,a.anchorOffset),c?(a.modify("move","forward","word"),a.extend(d,e),a.modify("extend","backward","word")):(a.modify("move","backward","word"),a.extend(d,e),a.modify("extend","forward","word"))}}else if((a=document.selection)&&"Control"!=a.type){var f=a.createRange();if(f.text){for(f.expand("word");/\s$/.test(f.text);)f.moveEnd("character",-1);f.select()}}}}}},a.Redactor.modules.unshift("fs"),a.Redactor.prototype.init_super=a.Redactor.prototype.init,a.Redactor.prototype.init=function(c,d){isNaN(b.indentValue)&&(b.indentValue=parseFloat(a(document.body).css("font-size"))),a.extend(!0,this,a.RedactorExtend),a.extend(!0,a.Redactor.opts,b),a.Redactor.opts.deniedTags=[],d&&d.codeOnly&&(d.visual=!1),this.init_super.apply(this,[c,d]),this.fs.init(),this.fs.hidePluginButtons(),this.$element.on("modalOpened.redactor-api",this.fs.modalIframeBrowseInit),this.$element.on("dropdownShown.redactor-api",this.fs.dropdownShow),this.$element.on("sync.redactor-api",this.fs.sync)},a.Redactor.prototype.init.prototype=a.Redactor.prototype,window.hasRedactor=!0}(jQuery);var RedactorPlugins=RedactorPlugins||{};!function(a){"use strict";RedactorPlugins.advancedimage=function(){return{init:function(){this.opts.advancedimage=a.extend({onFileBrowseReturn:function(a){return a}},this.opts.advancedimage),this.$editor.on("observed.redactor.img",this.advancedimage.setEditable);var b=this.button.add("image","Image");this.button.addCallback(b,this.advancedimage.show),this.opts.modal_image_edit='<section>\r\n					<div class="redactor-advancedimage-modalleftcol">\r\n						<div class="redactor-advancedimage-preview">\r\n							<img src="" style="max-width:100%; max-height:40%"/>\r\n						</div>\r\n						<fieldset>\r\n							<legend>Size (px)</legend>\r\n							<label><input id="redactor-image-width" type="text" class="smallinput" /> Width</label>\r\n							<label><input id="redactor-image-height" type="text" class="smallinput" /> Height</label>\r\n						</fieldset>\r\n						<fieldset>\r\n							<label><input id="redactor-image-border" type="number" min="0" class="smallinput" /> Border</label>\r\n						</fieldset>\r\n						<fieldset>\r\n							<legend>Margin</legend>\r\n							<input id="redactor-image-marginTop" type="number" min="0" class="smallinput" />\r\n							<label><select id="redactor-image-marginTop-unit"><option>px</option><option>em</option><option>%</option></select>\r\n								Top\r\n							</label>\r\n							<input id="redactor-image-marginRight" type="number" min="0" class="smallinput" />\r\n							<label><select id="redactor-image-marginRight-unit"><option>px</option><option>em</option><option>%</option></select>\r\n								Right\r\n							</label>\r\n							<input id="redactor-image-marginBottom" type="number" min="0" class="smallinput" />\r\n							<label><select id="redactor-image-marginBottom-unit"><option>px</option><option>em</option><option>%</option></select>\r\n								Bottom\r\n							</label>\r\n							<input id="redactor-image-marginLeft" type="number" min="0" class="smallinput" />\r\n							<label><select id="redactor-image-marginLeft-unit"><option>px</option><option>em</option><option>%</option></select>\r\n								Left\r\n							</label>\r\n						</fieldset>\r\n					</div>\r\n					<div class="redactor-advancedimage-modalrightcol">\r\n						<fieldset>\r\n							<label for="redactor-image-url">File/URL</label>\r\n							<input id="redactor-image-url" type="text" name="redactor-image-url" />\r\n							<button type="button" class="redactor-modal-btn" id="redactor-image-browse">Browse</button>\r\n						</fieldset>\r\n						<fieldset>\r\n							<label for="redactor_image-align">Alignment</label>\r\n							<ul id="redactor-image-align">\r\n								<li><input id="redactor-image-align-none" name="redactor-image-align" type="radio" value="none"><label for="redactor-image-align-none">None</label></li>\r\n								<li><input id="redactor-image-align-left" name="redactor-image-align" type="radio" value="left"><label for="redactor-image-align-left">Left</label></li>\r\n								<li><input id="redactor-image-align-right" name="redactor-image-align" type="radio" value="right"><label for="redactor-image-align-right">Right</label></li>\r\n							</ul>\r\n						</fieldset>\r\n						<fieldset>\r\n							<label for="redactor-image-alt">Alt text</label><input type="text" id="redactor-image-alt" />\r\n							<label for="redactor-image-title">Title text</label><input type="text" id="redactor-image-title" />\r\n						</fieldset>\r\n						<fieldset>\r\n							<label for="redactor-image-class">Class</label>\r\n							<input type="text" placeholder="Choose Style..." id="redactor-image-class">\r\n							<label for="redactor-image-id">ID</label><input type="text" id="redactor-image-id" />\r\n						</fieldset>\r\n					</div>\r\n					<div style="clear:both"></div>\r\n					</section>'},hideResize:function(b){return a(document.body).trigger("beforeImageResizeHide",arguments),b&&b!==!1&&"undefined"==typeof b.isTrigger&&a(b.originalEvent.target).hasClass("re-link")?!1:this.advancedimage.hideResize_super(b)},moveResize:function(a){this.advancedimage.moveResize_super(a),this.image.resizeHandle.el.removeAttr("height"),this.image.resizeHandle.el.height(""),this.image.resizeHandle.el.attr("width",this.image.resizeHandle.el.width()),this.image.resizeHandle.el.width("")},setEditable:function(b,c){var d=this,e=a(c),f=[];if(f.push({name:"Settings","class":"re-cog",title:"Edit Image Properties",onClick:function(){return d.advancedimage.show(e),!1}}),window.Aviary){var g=a.extend(d.opts.aviary,{onSave:function(a,b){e.get(0).src=b}});d.featherEditor=d.featherEditor||new Aviary.Feather(g)}(this.opts.aviaryPopupURL||window.Aviary)&&f.push({name:"Edit","class":"re-pencil",title:"Edit",onClick:function(){if(d.opts.aviaryPopupURL){var a=d.opts.aviaryPopupURL.replace("{file}",e.attr("src")),b=e[0].naturalWidth;window.open(a,"_blank","width=960, height=700, scrollbars=1"),"undefined"==typeof window.FS&&(window.FS={}),"undefined"==typeof window.FS.editor&&(window.FS.editor={}),"undefined"==typeof window.FS.editor.fileEditingComplete&&(window.FS.editor.fileEditingComplete=function(a){e.one("load",function(){e[0].naturalWidth!==b&&e.attr("width",e[0].naturalWidth);

}),e.attr("src",a.url.replace(/ /g,"%20"))})}else d.featherEditor.launch({image:e.get(0)});return!1}}),f.push({name:"Delete",title:"Delete","class":"re-trash",onClick:function(){return window.confirm("Are you sure you want to delete this image?")?(d.image.hideResize(),e.remove(),d.code.sync(),void 0):!1}}),e.off(".editcontrols").on("click.editcontrols touchstart.editcontrols",function(a){a.stopPropagation(),d.fs.loadEditableControls({element:e,buttons:f})})},show:function(b){this.modal.addTemplate("advancedimage",this.opts.modal_image_edit),this.modal.load("advancedimage",this.opts.curLang.image+" Settings",600),this.modal.createCancelButton();var c=this.modal.createDeleteButton("Delete"),d=this.modal.createActionButton("Save");"string"==typeof b&&(this.selection.save(),b=a('<img data-new="true"/>')),b.data("save-src",b.attr("src")),b.removeAttr("height");var e=this,f=a(".redactor-advancedimage-preview > img",this.$modal),g=b[0].style,h=b[0].naturalWidth/b[0].naturalHeight,i=/\d+/,j=/\D+$/;if(this.opts.browseFileURL.length?a("#redactor-image-browse",this.$modal).on("click",a.proxy(function(b){return b.preventDefault(),this.fs.modalIframeBrowse.call(this,this.opts.browseFileURL,a.proxy(function(b){b=this.opts.advancedimage.onFileBrowseReturn(b),a("#redactor-image-url",this.$modal).val(b.path).change()},this)),!1},this)):a("#redactor-image-browse",this.$modal).hide(),a("input[type=number],#redactor-image-width,#redactor-image-height",e.$modal).on("keydown",function(a){(a.keyCode>57||a.keyCode<48)&&8!==a.keyCode&&9!==a.keyCode&&37!==a.keyCode&&39!==a.keyCode&&46!==a.keyCode&&13!==a.keyCode&&a.preventDefault()}),a("#redactor-image-width",this.$modal).val(b.width()).on("change keyup",function(){a("#redactor-image-height",this.$modal).val(parseInt(this.value/h))}),a("#redactor-image-height",this.$modal).val(b.height()).on("change keyup",function(){a("#redactor-image-width",this.$modal).val(parseInt(this.value*h))}),a("#redactor-image-border",this.$modal).val(g.borderWidth.match(i)).on("change",function(){f.css("border",a(this).val()+"px solid #000")}).change(),a("#redactor-image-marginTop",this.$modal).val(g.marginTop.match(i)||0),a("#redactor-image-marginRight",this.$modal).val(g.marginRight.match(i)||0),a("#redactor-image-marginBottom",this.$modal).val(g.marginBottom.match(i)||0),a("#redactor-image-marginLeft",this.$modal).val(g.marginLeft.match(i)||0),a("#redactor-image-marginTop-unit",this.$modal).val(g.marginTop.match(j)||"px"),a("#redactor-image-marginRight-unit",this.$modal).val(g.marginRight.match(j)||"px"),a("#redactor-image-marginBottom-unit",this.$modal).val(g.marginBottom.match(j)||"px"),a("#redactor-image-marginLeft-unit",this.$modal).val(g.marginLeft.match(j)||"px"),a('input[name="redactor-image-align"][value="'+b.css("float")+'"]',this.$modal).prop("checked",!0),a("#redactor-image-alt",this.$modal).val(b.attr("alt")),a("#redactor-image-title",this.$modal).val(b.attr("title")),a("#redactor-image-id",this.$modal).val(b.attr("id")),a("#redactor-image-class",this.$modal).val(b.attr("class")),a.fn.selectize){var k=this.opts.classes?a.map(this.opts.classes,function(a){return{value:a["class"],text:a.name}}):[],l=a("#redactor-image-class").selectize({delimiter:" ",persist:!1,create:!0});l[0].selectize.addOption(k),l[0].selectize.$control.on("keyup",function(a){a.stopPropagation()})}a("#redactor-image-url",this.$modal).val(b.attr("src")).on("change",function(){var c=a("#redactor-image-url",e.$modal).val();f.attr("src",c||"data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7"),c!==b.data("save-src")&&b.removeAttr("width")}).change(),f.load(function(){h=f[0].naturalWidth/f[0].naturalHeight,b.attr("width")||(a("#redactor-image-width",this.$modal).val(f[0].naturalWidth),a("#redactor-image-height",this.$modal).val(f[0].naturalHeight))}),d.on("click",function(){e.advancedimage.save(b)}),c.on("click",function(){b.remove(),e.code.sync(),e.modal.close()}),this.modal.show()},save:function(b){this.selection.restore();var c=a("#redactor-image-alt").val(),d=a("#redactor-image-title").val(),e=a("#redactor-image-id").val(),f=a("#redactor-image-class").val(),g=a("#redactor-image-width").val(),h=a("#redactor-image-marginTop").val()||0,i=a("#redactor-image-marginRight").val()||0,j=a("#redactor-image-marginBottom").val()||0,k=a("#redactor-image-marginLeft").val()||0,l=a("#redactor-image-marginTop-unit").val(),m=a("#redactor-image-marginRight-unit").val(),n=a("#redactor-image-marginBottom-unit").val(),o=a("#redactor-image-marginLeft-unit").val(),p=a('input[name="redactor-image-align"]:checked').val(),q=a("#redactor-image-border").val();this.fs.setAttr(b,"alt",c),this.fs.setAttr(b,"title",d),this.fs.setAttr(b,"id",e),this.fs.setAttr(b,"class",f),!isNaN(g)&&g>0?b.attr("width",g):b.removeAttr("width"),b.removeAttr("height"),b.css("border",q>0?q+"px solid #000":""),b.attr("src",a("#redactor-image-url").val()),b.css("margin",h+i+j+k>0?h+l+" "+i+m+" "+j+n+" "+k+o:""),"left"===p?b.css("float","left"):"right"===p?b.css("float","right"):b.css("float",""),b.data("new")&&(b.removeData("new").removeAttr("data-new"),this.insert.html(b[0].outerHTML,!1)),this.modal.close(),this.observe.images(),this.code.sync()}}}}(jQuery);var RedactorPlugins=RedactorPlugins||{};!function(a){"use strict";RedactorPlugins.advancedlink=function(){return{init:function(){this.link.show=this.advancedlink.show,this.$toolbar.find(".redactor-dropdown-box-link").remove();var b=this,c=this.$toolbar.find(".re-link").closest("li"),d={title:this.opts.curLang.link},e=this.button.build("link",d),f={"1editlink":{title:"Insert/Edit Link (ctrl + k)",func:this.advancedlink.show},"2editanchor":{title:"Add/Edit Anchor",func:this.advancedlink.showAnchor},"3hideshowanchors":{title:"Hide Anchors",func:this.advancedlink.toggleAnchors}};c.empty().append(e),this.button.addDropdown(e,f),a(e).on("click",function(){a(".redactor-dropdown-box-link .redactor-dropdown-3hideshowanchors").text(b.$editor.hasClass("redactor-hide-anchors")?"Show Anchors":"Hide Anchors")}),this.opts.advancedlink=a.extend({onMediaBrowseReturn:function(a){return a},onFileBrowseReturn:function(a){return a},onPageBrowseReturn:function(a){return a},anchorTest:/^#/,mediaTest:/^\/media\/\d/gi,siteFileTest:/^\/public\/files/gi,sitePageTest:/^\/pages\/\d/gi},this.opts.advancedlink),this.opts.modal_insertAnchor='<section id="redactor-modal-advancedlink">\r\n						<label for="redactor-link-id">ID</label>\r\n						<input type="text" id="redactor-anchor-id" class="redactor-input" />\r\n					</section>',this.opts.modal_advancedlink='<section id="redactor-modal-advancedlink">\r\n						<div class="redactor-tab redactor-tab1">\r\n							<label>URL</label>\r\n							<input type="text" id="redactor-link-url" class="redactor-input" />\r\n						</div>\r\n						<div class="redactor-tab redactor-tab2" style="display: none;">\r\n							<label>'+this.opts.curLang.site_page+'</label>\r\n							<div class="redactor-site-page-selected">\r\n								<span class="redactor-site-page-selected-text">'+this.opts.curLang.site_page_select+'</span>\r\n								<button type="button" class="redactor-link-site-page-browse" title="'+this.opts.curLang.site_page_browse_title+'">'+this.opts.curLang.browse+"</button>\r\n								"+(this.opts.browseComposerSiteURL?'<button type="button" class="redactor-link-composer-site-page-browse" title="'+this.opts.curLang.composer_site_page_browse_title+'">'+this.opts.curLang.browse_composer+"</button>":"")+'\r\n							</div>\r\n						</div>\r\n						<div class="redactor-tab redactor-tab3" style="display: none;">\r\n							<label>'+this.opts.curLang.site_file+'</label>\r\n							<div class="redactor-site-file-selected">\r\n								<span class="redactor-site-file-selected-text">'+this.opts.curLang.site_file_select+'</span>\r\n								<button type="button" class="redactor-link-site-file-browse" title="'+this.opts.curLang.site_file_browse_title+'">'+this.opts.curLang.browse+'</button>\r\n							</div>\r\n						</div>\r\n						<div class="redactor-tab redactor-tab4" style="display: none;">\r\n							<label>'+this.opts.curLang.media+'</label>\r\n							<div class="redactor-media-selected">\r\n								<span class="redactor-media-selected-text">'+this.opts.curLang.media_select+'</span>\r\n								<button type="button" class="redactor-link-media-browse" title="'+this.opts.curLang.media_browse_title+'">'+this.opts.curLang.browse+'</button>\r\n							</div>\r\n						</div>\r\n						<div class="redactor-tab redactor-tab5" style="display: none;">\r\n							<label for="redactor-anchor-id">Anchor</label>\r\n							<select id="redactor-anchor-id">\r\n								<option value="">Choose Anchor...</option>\r\n							</select>\r\n						</div>\r\n						<input type="checkbox" class="redactor-link-blank" id="redactor-link-blank"><label for="redactor-link-blank">'+this.opts.curLang.link_new_tab+'</label><br />\r\n						<label for="redactor-link-title">'+this.opts.curLang.title+' <span class="redactor-tooltip" data-title="'+this.opts.curLang.title_attr_description+'">?</span></label>\r\n						<input type="text" id="redactor-link-title" class="redactor-input" />\r\n						<label for="redactor-link-class">'+this.opts.curLang["class"]+' <span class="redactor-tooltip" data-title="'+this.opts.curLang.class_attr_description+'">?</span></label>\r\n						<input type="text" id="redactor-link-class" placeholder="Choose Style..." class="redactor-input" />\r\n						<label for="redactor-link-id">ID <span class="redactor-tooltip" data-title="'+this.opts.curLang.id_attr_description+'">?</span></label>\r\n						<input type="text" id="redactor-link-id" class="redactor-input" />\r\n					</section>'},show:function(){if(a("#redactor-overlay-box.redactor-overlay-type-img").length){var b=this.fs.$editTarget;this.fs.hideEditableControls(!1),this.selection.get(),this.range.selectNode(b.get(0)),this.selection.addRange()}this.modal.addTemplate("advancedlink",this.opts.modal_advancedlink),this.modal.load("advancedlink",this.opts.curLang.link+" Settings",540);var c=this.modal.getModal();this.modal.createTabber(c),this.modal.addTab(1,"URL","active"),this.modal.addTab(2,this.opts.curLang.site_page),this.modal.addTab(3,this.opts.curLang.site_file),this.modal.addTab(4,this.opts.curLang.media),this.modal.addTab(5,"Anchor"),this.modal.createCancelButton();var d=this.modal.createDeleteButton("Unlink"),e=this.modal.createActionButton("Save");this.selection.get(),this.link.getData();var f="",g="",h="",i="",j="",k="";this.link.$node&&(f=this.link.$node.attr("class"),g=this.link.$node.attr("title"),h=this.link.$node.attr("id"),i=this.link.$node.attr("data-page-name")||this.link.url,j=this.link.$node.attr("data-file-name")||this.link.url,k=this.link.$node.attr("data-media-name")||this.link.url,a("#redactor-link-title").val(g),a("#redactor-link-id").val(h),a("#redactor-link-class").val(f),this.link.$node.length>1&&a('#redactor-link-id, label[for="redactor-link-id"]').hide());var l;if(a.fn.selectize){var m=this.opts.classes?a.map(this.opts.classes,function(a){return{value:a["class"],text:a.name}}):[],n=a("#redactor-link-class").selectize({delimiter:" ",persist:!1,create:!0}),o=a.map(this.$editor.find("[id]"),function(a){return{value:a.id,text:a.id}});l=a("#redactor-anchor-id").selectize({create:!0,onChange:function(b){a("#redactor-link-url").val("#"+b)}}),n[0].selectize.addOption(m),n[0].selectize.$control.on("keyup",function(a){a.stopPropagation()}),l[0].selectize.addOption(o),l[0].selectize.$control.on("keyup",function(a){a.stopPropagation()}),this.$element.one("modalClosed.redactor-api",function(){n[0].selectize.destroy(),l[0].selectize.destroy()})}var p=self.location.href.replace(/\/$/i,""),q=this.link.url.replace(p,"")||"http://";if(this.link.url.search(this.opts.advancedlink.sitePageTest)>=0)this.modal.$tabber.children(":eq(1)").click(),i&&a(".redactor-site-page-selected-text").text(i);else if(this.link.url.search(this.opts.advancedlink.siteFileTest)>=0)this.modal.$tabber.children(":eq(2)").click(),j&&a(".redactor-site-file-selected-text").text(j);else if(this.link.url.search(this.opts.advancedlink.mediaTest)>=0)this.modal.$tabber.children(":eq(3)").click(),k&&a(".redactor-media-selected-text").text(k);else if(this.link.url.search(this.opts.advancedlink.anchorTest)>=0&&(this.modal.$tabber.children(":eq(4)").click(),a.fn.selectize)){var r=this.link.url.replace("#","");l[0].selectize.addOption({value:r,text:r}),l[0].selectize.setValue(r)}a("#redactor-link-url").val(q),("_blank"===this.link.target||"http://"===q)&&a(".redactor-link-blank",this.$modal).prop("checked",!0),this.opts.browseComposerSiteURL.length>0&&this.$modal.on("click",".redactor-link-composer-site-page-browse",a.proxy(function(b){return b.preventDefault(),this.fs.modalIframeBrowse.call(this,this.opts.browseComposerSiteURL,a.proxy(function(b){b=this.opts.advancedlink.onPageBrowseReturn(b),a("#redactor-link-url").val(b.path),a(".redactor-site-page-selected-text",this.$modal).text(b.name)},this)),!1},this)),this.opts.browseSiteURL.length>0?this.$modal.on("click",".redactor-link-site-page-browse",a.proxy(function(b){return b.preventDefault(),this.fs.modalIframeBrowse.call(this,this.opts.browseSiteURL,a.proxy(function(b){b=this.opts.advancedlink.onPageBrowseReturn(b),a("#redactor-link-url").val(b.path),a(".redactor-site-page-selected-text",this.$modal).text(b.name)},this)),!1},this)):this.modal.$tabber.children(":eq(1)").hide(),this.opts.browseFileURL.length>0?this.$modal.on("click",".redactor-link-site-file-browse",a.proxy(function(b){return b.preventDefault(),this.fs.modalIframeBrowse.call(this,this.opts.browseFileURL,a.proxy(function(b){b=this.opts.advancedlink.onFileBrowseReturn(b),a("#redactor-link-url").val(b.path),a(".redactor-site-file-selected-text",this.$modal).text(b.name)},this),620),!1},this)):this.modal.$tabber.children(":eq(2)").hide(),this.opts.browseMediaURL.length>0?this.$modal.on("click",".redactor-link-media-browse",a.proxy(function(b){return b.preventDefault(),this.fs.modalIframeBrowse.call(this,this.opts.browseMediaURL,a.proxy(function(b){b=this.opts.advancedlink.onMediaBrowseReturn(b),a("#redactor-link-url").val(b.path),a(".redactor-media-selected-text",this.$modal).text(b.name)},this)),!1},this)):this.modal.$tabber.children(":eq(3)").hide(),a("#redactor-modal-tabber",this.$modal).on("click","a",function(){"http://"===q&&(1===a("#redactor-modal-tabber > a.active").index()||4===a("#redactor-modal-tabber > a.active").index()?a(".redactor-link-blank").prop("checked",!1):a(".redactor-link-blank").prop("checked",!0))}),e.on("click",this.advancedlink.linkProcess),d.on("click",a.proxy(function(){this.modal.close(),this.selection.restore(),this.link.unlink()},this)),setTimeout(function(){a("#redactor-link-url",this.$modal).focus()},11),this.selection.save(),this.modal.show()},linkProcess:function(){var b={"class":"",href:"",target:"",title:"",id:"","data-page-name":"","data-file-name":"","data-media-name":""},c=a("#redactor-modal-tabber > a.active").index();if(b.href=a("#redactor-link-url").val(),a(".redactor-link-blank",this.$modal).prop("checked")&&(b.target="_blank"),/^javascript:/.test(b.href)&&(b.target=""),"1"===c){var d=/((xn--)?[a-z0-9]+(-[a-z0-9]+)*\.)+[a-z]{2,}/,e=new RegExp("^(http|ftp|https)://"+d,"i"),f=new RegExp("^"+d,"i");-1===b.href.search(e)&&0===b.href.search(f)&&this.opts.linkProtocol&&(b.href=this.opts.linkProtocol+b.href)}b["data-page-name"]=a(".redactor-site-page-selected-text:visible",this.$modal).text(),b["data-file-name"]=a(".redactor-site-file-selected-text:visible",this.$modal).text(),b["data-media-name"]=a(".redactor-media-selected-text:visible",this.$modal).text(),b.title=a.trim(this.clean.encodeEntities(a("#redactor-link-title").val())),b["class"]=a.trim(a("#redactor-link-class").val()),b.id=a.trim(this.fs.cleanID(a("#redactor-link-id").val())),this.advancedlink.linkInsert(b),this.modal.close()},linkInsert:function(b){var c=this;if(this.selection.restore(),this.link.$node)this.buffer.set(),a.each(b,function(a,b){c.fs.setAttr(c.link.$node,a,b)}),this.code.sync();else{var d;this.fs.setImageFloatFix(),document.execCommand("createLink",!1,"redactor-temporary"),this.fs.unsetImageFloatFix(),d=a('a[href="redactor-temporary"]',this.$editor),d.length||(this.insert.html('<a id="redactor-inserted-link">'+b.href+"</a>"),d=a("#redactor-inserted-link").removeAttr("id")),a.each(b,function(a,b){c.fs.setAttr(d,a,b)}),""!==this.link.text||this.advancedlink.hasImage()||(d.text(b.href),this.selection.selectElement(d)),this.code.sync(),this.core.setCallback("insertedLink",d)}setTimeout(a.proxy(function(){this.observe.links()},this),5)},showAnchor:function(){var a=this;this.modal.addTemplate("insertAnchor",this.opts.modal_insertAnchor),this.modal.load("insertAnchor","Add/Edit Anchor",460),this.modal.createCancelButton();var b=this.modal.createActionButton("Save"),c=this.modal.createDeleteButton("Remove");c.on("click",function(){a.modal.close(),a.selection.restore(),a.advancedlink.anchorRemove()}),this.range.collapse(!0),this.selection.addRange(),b.on("click",this.advancedlink.anchorProcess),this.advancedlink.selectedAnchor=this.selection.getBlock(),this.selection.save(),this.modal.show(),a.advancedlink.selectedAnchor&&a.advancedlink.selectedAnchor.id.length&&a.$modal.find("#redactor-anchor-id").val(a.advancedlink.selectedAnchor.id)},anchorProcess:function(){var b=this.$modal.find("#redactor-anchor-id").val();return this.$editor.find("#"+b).length&&b!==this.advancedlink.selectedAnchor.id?(this.$modal.find("p.error").remove().end().find("#redactor-anchor-id").addClass("error").after('<p class="error">ID is already in use. Please choose a different ID.</p>'),!1):(this.modal.close(),this.selection.restore(),void this.fs.setInlineStyle(function(c){a(c[0]).attr("id",b)}))},anchorRemove:function(){this.fs.setInlineStyle(function(b){a(b[0]).removeAttr("id")})},toggleAnchors:function(){this.$editor.hasClass("redactor-hide-anchors")?this.$editor.removeClass("redactor-hide-anchors"):this.$editor.addClass("redactor-hide-anchors")},hasImage:function(){var b=!1,c=this.selection.getNodes();return a.each(c,function(a,c){return"IMG"===c.tagName?(b=!0,!1):void 0}),b},execUnlink:function(b,c){this.buffer.set();var d=this.currentOrParentIs("A");return d?(a(d).replaceWith(a(d).html()),this.code.sync(),void this.callback("execCommand",b,c)):void 0}}}}(jQuery);var RedactorPlugins=RedactorPlugins||{};!function(a){"use strict";RedactorPlugins.clips=function(){return{init:function(){var b=[["Lorem ipsum...","Lorem ipsum dolor sit amet, consectetur adipisicing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo consequat. Duis aute irure dolor in reprehenderit in voluptate velit esse cillum dolore eu fugiat nulla pariatur. Excepteur sint occaecat cupidatat non proident, sunt in culpa qui officia deserunt mollit anim id est laborum."],["Red label",'<span class="label-red">Label</span>']];this.clips.template=a('<ul id="redactor-modal-list">');for(var c=0;c<b.length;c++){var d=a("<li>"),e=a('<a href="#" class="redactor-clip-link">').text(b[c][0]),f=a('<div class="redactor-clip">').hide().html(b[c][1]);d.append(e),d.append(f),this.clips.template.append(d)}this.modal.addTemplate("clips","<section>"+this.utils.getOuterHtml(this.clips.template)+"</section>");var g=this.button.add("clips","Clips");this.button.addCallback(g,this.clips.show)},show:function(){this.modal.load("clips","Insert Clips",400),this.modal.createCancelButton(),a("#redactor-modal-list").find(".redactor-clip-link").each(a.proxy(this.clips.load,this)),this.selection.save(),this.modal.show()},load:function(b,c){a(c).on("click",a.proxy(function(b){b.preventDefault(),this.clips.insert(a(c).next().html())},this))},insert:function(a){this.selection.restore(),this.insert.html(a),this.modal.close(),this.observe.load()}}}}(jQuery);var RedactorPlugins=RedactorPlugins||{};!function($){"use strict";RedactorPlugins.codeMirror=function(){return{init:function(){if(this.opts.codeMirror=jQuery.extend({autoCloseTags:!1,extraKeys:{"Ctrl-J":"toMatchingTag","Ctrl-Space":"autocomplete"},matchTags:{bothTags:!0},mode:"htmlmixed",lineNumbers:!0,lineWrapping:!0},this.opts.codeMirror),this.opts.codeOnly||(this.button.remove("html"),this.button.addCallback(this.button.addFirst("html","Code"),this.code.toggle),this.$toolbar.find("a.re-html").addClass("redactor-codemirror-button")),!this.opts.codeMirror.path)return void console.log("Warning: path option not given for codemirror plugin. Can't load plugin without it");this.codeMirror.get_super=this.code.get,this.code.get=this.codeMirror.get,this.codeMirror.showCode_super=this.code.showCode,this.code.showCode=this.codeMirror.showCode,this.codeMirror.showVisual_super=this.code.showVisual,this.code.showVisual=this.codeMirror.showVisual,this.button.addCallback(this.button.addAfter("html","htmltidy","Beautify"),this.codeMirror.htmlTidy),this.button.addCallback(this.button.addAfter("html","code-undo","Undo"),$.proxy(function(){this.codeMirror.instance.undo()},this)),this.button.addCallback(this.button.addAfter("code-undo","code-redo","Redo"),$.proxy(function(){this.codeMirror.instance.redo()},this));var a=this.button.add("diff","Diff");this.$toolbar.find("a.re-diff").addClass("re-has-dropdown"),a.click(this.codeMirror.toggleDiff),this.$toolbar.find("a.re-htmltidy, a.re-code-undo, a.re-code-redo, a.re-diff").addClass("redactor-button-hidden redactor-codemirror-button")},destroy:function(){this.code.get=this.codeMirror.get_super,this.code.showCode=this.codeMirror.showCode_super,this.code.showVisual=this.codeMirror.showVisual_super},get:function(){return"undefined"!=typeof this.codeMirror.instance&&this.$textarea.val(this.codeMirror.instance.getValue()),this.$textarea.val()},htmlTidy:function(){this.codeMirror.instance.setValue(this.tabifier.get(this.codeMirror.instance.getValue()))},toggleDiff:function(a){a.preventDefault(),$(".redactor-dropdown-box-diff").remove(),this.dropdown.hideAll(),this.button.addDropdown($(a.currentTarget),this.codeMirror.getDiffDropdown()),this.dropdown.show(a,"diff"),window.diff_match_patch||($(document.head).append('<link rel="stylesheet" rel="nofollow" href="//cdnjs.cloudflare.com/ajax/libs/codemirror/4.7.0/addon/merge/merge.min.css" type="text/css" />'),$.getScript("//cdnjs.cloudflare.com/ajax/libs/diff_match_patch/20121119/diff_match_patch.js").done(function(){$.getScript("//cdnjs.cloudflare.com/ajax/libs/codemirror/4.7.0/addon/merge/merge.js")}).fail(function(){window.alert("Sorry, an error occurred trying to load the difference engine.")}))},getDiffDropdown:function(){var a={},b=this;a[0]={title:"Initial State",func:this.codeMirror.showDiff},a[this.opts.buffer.length-1]={title:"Last Change",func:this.codeMirror.showDiff},this.codeMirror.compareOptions={};var c=this.$element.data("compareoptions");return c&&$.each(c,function(c,d){d.url?b.codeMirror.compareOptions[d.name]={bURL:!0,url:d.url}:b.codeMirror.compareOptions[d.name]=d.source,a[d.name]={title:d.title,func:b.codeMirror.showDiff}}),a},showDiff:function(a){var b=this,c=$.Deferred();if(this.codeMirror.diffInstance){if(!window.confirm("Any unsaved changes will be lost are you sure?"))return!1;this.codeMirror.hideDiff()}this.$box.append('<div id="redactor-code-diff"></div>');var d=$("#redactor-code-diff");this.$toolbar.append('<li class="redactor-diff-control"><a class="redactor-diff-save">Save</a></li><li class="redactor-diff-control"><a class="redactor-diff-cancel">Cancel</a></li>'),$(".redactor-diff-save").on("click",function(){b.codeMirror.saveDiff(),b.codeMirror.hideDiff()}),$(".redactor-diff-cancel").on("click",function(){b.codeMirror.hideDiff()}),this.$toolbar.find(".redactor-codemirror-button").not(".re-diff").addClass("redactor-button-disabled"),a=this.codeMirror.compareOptions[a]||this.codeMirror.cleanBuffer(this.opts.buffer[a])||a,a.bURL?$.get(a.url).done(function(b){a=b,c.resolve()}):c.resolve(),c.done(function(){d.css("top",b.$toolbar.height()+"px"),b.codeMirror.diffInstance=CodeMirror.MergeView(d[0],{lineNumbers:!0,mode:"text/html",highlightDifferences:!0,value:b.codeMirror.instance.getValue(),orig:a,lineWrapping:!0}),b.$box.bind("resize.codeMirror",function(){var a=b.$box.height()-b.$toolbar.height();b.codeMirror.diffInstance.leftOriginal()&&b.codeMirror.diffInstance.leftOriginal().setSize(null,a),b.codeMirror.diffInstance.editor().setSize(null,a),b.codeMirror.diffInstance.rightOriginal()&&b.codeMirror.diffInstance.rightOriginal().setSize(null,a),b.codeMirror.diffInstance.wrap.style.height=a+"px"}).trigger("resize.codeMirror")})},saveDiff:function(){this.codeMirror.instance.setValue(this.codeMirror.diffInstance.editor().getValue())},hideDiff:function(){this.$box.find("#redactor-code-diff").remove(),this.$toolbar.find(".redactor-diff-control").remove(),this.$toolbar.find(".redactor-codemirror-button").not(".re-diff").removeClass("redactor-button-disabled"),this.codeMirror.diffInstance=null},showVisual:function(){this.codeMirror.instance.toTextArea(),this.$box.unbind("resize.codeMirror"),this.codeMirror.buttonActiveVisual(),this.codeMirror.showVisual_super.apply(this,arguments)},showCode:function(){var deferredLoad=$.Deferred(),self=this;window.CodeMirror?deferredLoad.resolve():($(document.head).append('<link rel="stylesheet" rel="nofollow" href="'+this.opts.codeMirror.path+'/redactor_codeMirror.min.css" type="text/css" />'),$.ajax({url:this.opts.codeMirror.path+"/redactor_codeMirror.min.js",cache:!0,dataType:"script"}).done(function(jsCode){"undefined"!=typeof CodeMirror?deferredLoad.resolve():(eval(jsCode),"undefined"!=typeof CodeMirror&&deferredLoad.reject())}).fail(function(){deferredLoad.reject()})),deferredLoad.done(function(){var a=self.tabifier.get;self.tabifier.get=function(a){return a},self.codeMirror.showCode_super.apply(self,arguments),self.tabifier.get=a,self.codeMirror.buttonInactiveVisual();var b=self.$box.height(),c=self.$box.width();self.codeMirror.instance=CodeMirror.fromTextArea(self.$textarea[0],self.opts.codeMirror);for(var d=0;d<self.opts.buffer.length;d++)self.opts.buffer[d].length&&self.codeMirror.instance.setValue(self.codeMirror.cleanBuffer(self.opts.buffer[d]));self.codeMirror.instance.setValue(self.$textarea.val()),self.$box.bind("resize.codeMirror",function(){self.codeMirror.instance.getWrapperElement().style.width=self.$box.width()+"px",self.codeMirror.instance.getWrapperElement().style.height=self.$box.height()-self.$toolbar.height()+"px",self.codeMirror.instance.refresh()}),self.codeMirror.instance.on("change",function(a){self.$textarea.val(a.getValue())}),self.codeMirror.instance.getWrapperElement().style.width=c+"px",self.codeMirror.instance.getWrapperElement().style.height=b-self.$toolbar.height()+"px",self.codeMirror.instance.refresh()}).fail(function(){self.codeMirror.destroy(),self.code.showCode(),console.log("Warning: CodeMirror failed to load please check the codemirror plugin path option")})},cleanBuffer:function(a){return a?(a=this.clean.onSync(a),a=a.replace(/<span(.*?)class="redactor-selection-marker"([^>])*>(.*?)<\/span>/gi,"")):!1},buttonActiveVisual:function(){this.$toolbar.find("a.redactor-codemirror-button:not(.re-html)").addClass("redactor-button-hidden"),this.codeMirror.$previousButtons.removeClass("redactor-button-hidden")},buttonInactiveVisual:function(){this.$toolbar.find("a.redactor-codemirror-button").removeClass("redactor-button-hidden redactor-button-disabled"),this.codeMirror.$previousButtons=this.$toolbar.find("a:not(.redactor-codemirror-button, .redactor-button-hidden)").addClass("redactor-button-hidden")}}}}(jQuery);var RedactorPlugins=RedactorPlugins||{};!function(a){"use strict";RedactorPlugins.fontcolor=function(){return{init:function(){for(var a=["fontcolor","backcolor"],b=0;2>b;b++){var c=a[b],d=this.button.add(c,this.lang.get(c)),e=this.button.addDropdown(d);e.width(242),this.fs.buildPicker(e,c,this.fs.colors,this.fontcolor.set,this.fontcolor.remove)}},set:function(b,c){this.fs.setInlineStyle(function(d){a(d).css(b,c)})},remove:function(b){a.each(this.selection.getNodes(),function(c,d){a(d).css(b,"")}),this.code.sync()}}}}(jQuery);var RedactorPlugins=RedactorPlugins||{};!function(a){"use strict";RedactorPlugins.fontfamily=function(){return{init:function(){var b=["Arial","Arial Narrow","Arial Black","Helvetica","Georgia","Lucida","Monospace","Palatino","Tahoma","Times New Roman","Trebuchet","Verdana"],c=this,d={};a.each(b,function(a,b){d["s"+a]={title:b,func:function(){c.fontfamily.set(b)}}}),d.remove={title:"Remove Font Family",func:c.fontfamily.reset};var e=this.button.add("fontfamily","Change Font Family");this.button.addDropdown(e,d)},set:function(a){this.inline.format("span","style","font-family:"+a+";")},reset:function(){this.inline.removeStyleRule("font-family")}}}}(jQuery);var RedactorPlugins=RedactorPlugins||{};!function(a){"use strict";RedactorPlugins.fontsize=function(){return{init:function(){var b=[10,11,12,14,16,18,20,24,28,30],c=this,d={};a.each(b,function(a,b){d["s"+a]={title:b+"px",func:function(){c.fontsize.set(b)}}}),d.remove={title:"Remove Font Size",func:c.fontsize.reset};var e=this.button.add("fontsize","Change Font Size");this.button.addDropdown(e,d)},set:function(a){this.inline.format("span","style","font-size: "+a+"px;")},reset:function(){this.inline.removeStyleRule("font-size")}}}}(jQuery);var RedactorPlugins=RedactorPlugins||{};!function(a){"use strict";RedactorPlugins.fullscreen=function(){return{init:function(){this.fullscreen.isOpen=!1;var a=this.button.add("fullscreen","Fullscreen");a.parent().css("float","right"),this.button.addCallback(a,this.fullscreen.toggle),this.opts.fullscreen&&this.fullscreen.toggle()},enable:function(){var b=this;this.button.changeIcon("fullscreen","normalscreen"),this.button.setActive("fullscreen"),this.fullscreen.isOpen=!0,this.opts.toolbarExternal&&(this.fullscreen.toolcss={},this.fullscreen.boxcss={},this.fullscreen.toolcss.width=this.$toolbar.css("width"),this.fullscreen.toolcss.top=this.$toolbar.css("top"),this.fullscreen.toolcss.position=this.$toolbar.css("position"),this.fullscreen.boxcss.top=this.$box.css("top")),this.fullscreen.height=this.$editor.height(),this.opts.maxHeight&&this.$editor.css("max-height",""),this.opts.minHeight&&this.$editor.css("min-height",""),this.$fullscreenPlaceholder||(this.$fullscreenPlaceholder=a("<div/>")),this.$fullscreenPlaceholder.insertAfter(this.$box),"transparent"===this.$box.css("backgroundColor")&&a.each(this.$box.parents(),function(){var c=a(this).css("backgroundColor");return"transparent"!==c&&"inherit"!==c?(b.$box.css("backgroundColor",c),!1):void 0}),this.$box.appendTo(document.body),this.$box.addClass("redactor-box-fullscreen"),a("body, html").css("overflow","hidden"),this.fullscreen.resize(),a(window).on("resize.redactor.fullscreen",a.proxy(this.fullscreen.resize,this)),a(document).scrollTop(0,0),this.$editor.focus(),this.observe.load()},disable:function(){this.button.removeIcon("fullscreen","normalscreen"),this.button.setInactive("fullscreen"),this.fullscreen.isOpen=!1,a(window).off("resize.redactor.fullscreen"),a("body, html").css("overflow",""),this.$box.css("backgroundColor",""),this.$box.insertBefore(this.$fullscreenPlaceholder),this.$fullscreenPlaceholder.remove(),this.$box.removeClass("redactor-box-fullscreen").css({width:"auto",height:"auto"}),this.code.sync(),this.opts.toolbarExternal&&(this.$box.css("top",this.fullscreen.boxcss.top),this.$toolbar.css({width:this.fullscreen.toolcss.width,top:this.fullscreen.toolcss.top,position:this.fullscreen.toolcss.position})),this.opts.minHeight&&this.$editor.css("minHeight",this.opts.minHeight),this.opts.maxHeight&&this.$editor.css("maxHeight",this.opts.maxHeight),this.$editor.css("height","auto"),this.$editor.focus(),this.observe.load()},toggle:function(){this.fullscreen.isOpen?this.fullscreen.disable():this.fullscreen.enable()},resize:function(){if(this.fullscreen.isOpen){var b=this.$toolbar.height(),c=window.innerHeight-b;this.$box.width(a(window).width()-2).height(c+b),this.opts.toolbarExternal&&(this.$toolbar.css({
top:"0px",position:"absolute",width:"100%"}),this.$box.css("top",b+"px")),this.$editor.height(c-14),this.$box.trigger("resize")}}}}}(jQuery);var RedactorPlugins=RedactorPlugins||{};!function(a){"use strict";RedactorPlugins.media=function(){return{init:function(){var b=this;this.$editor.on("observed.redactor.video observed.redactor.audio observed.redactor.iframe",this.media.setEditable),this.button.addCallback(this.button.addAfter("image","media","Media"),this.media.show),this.$toolbar.find("a.re-video").removeClass("re-video").addClass("re-embed"),this.$toolbar.find("a.re-media").addClass("re-video").removeClass("redactor-btn-image"),this.$box.on("resize",a.proxy(function(){clearTimeout(this.media.resizeDebouncer),this.media.resizeDebouncer=setTimeout(this.media.resizeMediaIframes,100)},this)),a(window).on("blur.redactorIframeClick",function(){b.media.iFrameMouseOver&&b.fs.loadEditableControls({element:b.media.iFrameMouseOver,buttons:b.media.iFrameButtons})}),this.opts.media=a.extend({onMediaBrowseReturn:function(a){return a},onFileBrowseReturn:function(a){return a}},this.opts.media),this.opts.modal_media_edit='<section class="redactor-media-modal">\r\n					<div class="redactor-media-modalleftcol">\r\n						<div id="redactor-media-preview">\r\n						</div>\r\n						<fieldset>\r\n							<legend>Size</legend>\r\n							<label><input id="redactor-media-width" type="number" min="0" max="100" class="smallinput" value="100" />% Width</label>\r\n							<div class="redactor-tab redactor-tab1">\r\n								<select id="redactor-media-aspect-ratio-options" name="redactor-media-aspect-ratio">\r\n									<option id="redactor-media-portrait-aspect-ratio"  type="radio" value="1.3333">Portrait (4:3)</option>\r\n									<option id="redactor-media-portrait2-aspect-ratio" value="1.5">Portrait (3:2)</option>\r\n									<option id="redactor-media-landscape-aspect-ratio" selected="selected" value=".5625">Landscape (16:9)</option>\r\n									<option id="redactor-media-landscape2-aspect-ratio" value=".75">Landscape (4:3)</option>\r\n									<option id="redactor-media-landscape3-aspect-ratio" value=".6667">Landscape (3:2)</option>\r\n								</select>\r\n							</div>\r\n						</fieldset>\r\n						<fieldset>\r\n							<legend>Margin</legend>\r\n							<input id="redactor-media-marginTop" type="number" min="0" class="smallinput" />\r\n								<label><select id="redactor-media-marginTop-unit"><option>px</option><option>em</option><option>%</option></select>\r\n								Top\r\n								</label>\r\n							<input id="redactor-media-marginRight" type="number" min="0" class="smallinput" />\r\n								<label><select id="redactor-media-marginRight-unit"><option>px</option><option>em</option><option>%</option></select>\r\n								Right\r\n								</label>\r\n							<input id="redactor-media-marginBottom" type="number" min="0" class="smallinput" />\r\n								<label><select id="redactor-media-marginBottom-unit"><option>px</option><option>em</option><option>%</option></select>\r\n								Bottom\r\n								</label>\r\n							<input id="redactor-media-marginLeft" type="number" min="0" class="smallinput" />\r\n								<label><select id="redactor-media-marginLeft-unit"><option>px</option><option>em</option><option>%</option></select>\r\n								Left\r\n								</label>\r\n						</fieldset>\r\n					</div>\r\n					<div class="redactor-media-modalrightcol">\r\n						<fieldset>\r\n							<div class="redactor-tab redactor-tab1">\r\n								<label>Media:</label>\r\n								<div class="redactor-media-selected">\r\n									<span class="redactor-media-selected-text">Please select from Media Manager</span>\r\n									<button type="button" class="redactor-media-browse" title="Browse for media">'+this.opts.curLang.browse+'</button>\r\n								</div>\r\n							</div>\r\n							<div class="redactor-tab redactor-tab2" style="display: none;">\r\n								<label>Other Media:\r\n									<span class="redactor-other-media-selected-text"></span>\r\n								</label>\r\n								<div class="redactor-other-media-selected">\r\n									<input type="text" id="redactor-media-url" name="redactor-media-url"/>\r\n									<button type="button" class="redactor-other-media-browse" title="Browse for media">'+this.opts.curLang.browse+'</button>\r\n									<p class="error" style="display:none;">Only Flash, HTML5 Video & Audio files are accepted.</p>\r\n								</div>\r\n							</div>\r\n						</fieldset>\r\n						<fieldset>\r\n							<label for="redactor-media-align">Alignment</label>\r\n							<ul id="redactor-media-align">\r\n								<li><input id="redactor-media-align-none" name="redactor-media-align" type="radio" value="none"><label for="redactor-media-align-none">None</label></li>\r\n								<li><input id="redactor-media-align-left" name="redactor-media-align" type="radio" value="left"><label for="redactor-media-align-left">Left</label></li>\r\n								<li><input id="redactor-media-align-right" name="redactor-media-align" type="radio" value="right"><label for="redactor-media-align-right">Right</label></li>\r\n							</ul>\r\n						</fieldset>\r\n						<fieldset>\r\n							<label for="redactor-media-id">ID</label><input id="redactor-media-id" />\r\n						</fieldset>\r\n						<fieldset>\r\n							<label for="redactor-media-name">Name</label><input id="redactor-media-name" />\r\n						</fieldset>\r\n					</div>\r\n					<div style="clear:both"></div>\r\n					</section>'},show:function(b){var c=this;this.modal.addTemplate("media",this.opts.modal_media_edit),this.modal.load("media",this.opts.curLang.media+" Settings",600);var d=this.modal.getModal();this.modal.createTabber(d),this.modal.addTab(1,"Media Manager","active"),this.modal.addTab(2,"Other Media"),this.modal.createCancelButton();var e=this.modal.createDeleteButton("Delete"),f=this.modal.createActionButton("Save");if(b=b||"media","string"==typeof b&&this.selection.save(),a("#redactor-media-url,#redactor-media-aspect-ratio-options",this.$modal).on("change",function(){var b=a("#redactor-media-url").val(),d=a("#redactor-media-aspect-ratio-options").val();a("#redactor-media-preview").empty(),c.media.isVideo(b)?a("#redactor-media-preview").append('<video controls="controls" src="'+b+'"/>'):c.media.isMediaEmbed(b)?(b=c.media.formatMediaURL(b,d),a("#redactor-media-preview").append('<iframe src="'+b+'" data-aspectratio="'+d+'" style="width:100%; height:'+a("#redactor-media-preview").width()*d+'px" scrolling="no" frameborder="0" class="fsEmbeddedMedia" />')):c.media.isAudio(b)&&a("#redactor-media-preview").append('<audio src="'+b+'"/>')}),1===b.length){var g=b.attr("src"),h=b[0].style,i=parseInt(h.width)||100,j=/\d+/,k=/\D+$/,l=b.attr("data-aspectratio")||".75";i>100&&(i=100),this.media.isMediaEmbed(g)||this.modal.$tabber.children(":eq(1)").click(),a("#redactor-media-url").val(g),a("#redactor-media-id").val(b.attr("id")),a("#redactor-media-name").val(b.attr("name")),a("#redactor-media-width").val(i),a("input[name=redactor-media-align][value="+b.css("float")+"]").click(),a("#redactor-media-aspect-ratio-options").val(l),a(".redactor-media-selected-text",this.$modal).text(b.attr("data-media-name")||"Please select from media manager"),a("#redactor-media-url",this.$modal).change(),a("input[type=number]",c.$modal).on("keydown",function(a){(a.keyCode>57||a.keyCode<48)&&8!==a.keyCode&&9!==a.keyCode&&37!==a.keyCode&&39!==a.keyCode&&46!==a.keyCode&&a.preventDefault()}),a("#redactor-media-marginTop",c.$modal).val(h.marginTop.match(j)||0),a("#redactor-media-marginRight",c.$modal).val(h.marginRight.match(j)||0),a("#redactor-media-marginBottom",c.$modal).val(h.marginBottom.match(j)||0),a("#redactor-media-marginLeft",c.$modal).val(h.marginLeft.match(j)||0),a("#redactor-media-marginTop-unit",c.$modal).val(h.marginTop.match(k)||"px"),a("#redactor-media-marginRight-unit",c.$modal).val(h.marginRight.match(k)||"px"),a("#redactor-media-marginBottom-unit",c.$modal).val(h.marginBottom.match(k)||"px"),a("#redactor-media-marginLeft-unit",c.$modal).val(h.marginLeft.match(k)||"px")}this.opts.browseFileURL.length>0?this.$modal.on("click",".redactor-other-media-browse",a.proxy(function(b){return b.preventDefault(),this.fs.modalIframeBrowse.call(this,this.opts.browseFileURL,a.proxy(function(b){b=this.opts.media.onFileBrowseReturn(b),a("#redactor-media-url").val(b.path).change()},this)),!1},this)):this.$modal.find(".redactor-other-media-browse").hide(),this.opts.browseMediaURL.length>0?this.$modal.on("click",".redactor-media-browse",a.proxy(function(b){return b.preventDefault(),this.fs.modalIframeBrowse.call(this,this.opts.browseMediaURL,a.proxy(function(b){b=this.opts.media.onMediaBrowseReturn(b),a("#redactor-media-url").val(b.path).change(),a(".redactor-media-selected-text",this.$modal).text(b.name)},this)),!1},this)):(this.modal.$tabber.children(":eq(1)").click(),this.$modal.find("#redactor-modal-tabber").hide()),f.on("click",function(){c.media.save(b)}),e.on("click",function(){b.remove(),c.modal.close()}),this.modal.show()},save:function(b){var c,d=a("input[name=redactor-media-align]:checked").val(),e=a("#redactor-media-aspect-ratio-options").val(),f=!1,g=a("#redactor-media-id").val(),h=a("#redactor-media-width").val(),i=a("#redactor-media-marginTop").val()||0,j=a("#redactor-media-marginRight").val()||0,k=a("#redactor-media-marginBottom").val()||0,l=a("#redactor-media-marginLeft").val()||0,m=a("#redactor-media-marginTop-unit").val(),n=a("#redactor-media-marginRight-unit").val(),o=a("#redactor-media-marginBottom-unit").val(),p=a("#redactor-media-marginLeft-unit").val(),q=a("#redactor-media-name").val(),r=a(".redactor-media-selected-text",this.$modal).text(),s=a.trim(a("#redactor-media-url").val());return this.media.isVideo(s)||this.media.isMediaEmbed(s)||this.media.isAudio(s)?(this.selection.restore(),s.length&&("string"==typeof b&&(f=!0),this.media.isMediaEmbed(s)?(c=a('<iframe scrolling="no" frameborder="0" class="fsEmbeddedMedia fsEmbeddedMediaResponsive"></iframe>'),s=this.media.formatMediaURL(s,e)):this.media.isVideo(s)?c=a('<video controls="controls">HTML Video is not supported by your browser.</video>'):this.media.isAudio(s)&&(c=a('<audio controls="controls">HTML Audio is not supported by your browser.</audio>')),f||b[0].tagName===c.tagName||(a.each(b[0].attributes,function(a,b){"undefined"==typeof c[0].attributes[b.name]&&c.attr(b.name,b.value)}),b.replaceWith(c)),b=c,b.attr("src",s).css("float",d).css("margin",i+j+k+l>0?i+m+" "+j+n+" "+k+o+" "+l+p:""),g.length&&this.fs.setAttr(b,"id",g),q.length&&this.fs.setAttr(b,"name",q),"IFRAME"===b[0].tagName&&b.attr("data-aspectratio",e),r.length&&this.fs.setAttr(b,"data-media-name",r),b[0].style.width=h+"%",f&&this.range.insertNode(b[0])),this.code.sync(),this.modal.close(),this.observe.images(),void this.media.resizeMediaIframes()):(a(".redactor-other-media-selected p.error",this.$modal).show(),a("#redactor-media-url").addClass("error"),!1)},formatMediaURL:function(a,b){return a.replace(/&responsive=true/gi,"").replace(/&aspectRatio=[^&]+/gi,"")+"&aspectRatio="+b+"&responsive=true"},setEditable:function(b,c){var d=this,e=a(c),f=[];f.push({name:"Settings","class":"re-cog",title:"Edit Media Properties",onClick:function(){return d.media.show(e),!1}}),f.push({name:"Delete",title:"Delete","class":"re-trash",onClick:function(){return confirm("Are you sure you want to delete this media object?")?(e.remove(),void d.code.sync()):!1}}),"IFRAME"===e[0].tagName&&e.hasClass("fsEmbeddedMedia")?e.off("mouseover.redactorIframeOver").on("mouseover.redactorIframeOver",function(){d.media.iFrameMouseOver=e,d.media.iFrameButtons=f}).off("mouseout.redactorIframeOut").on("mouseout.redactorIframeOut",function(){d.media.iFrameMouseOver=!1,d.media.iFrameButtons=!1}):e.off(".editcontrols").on("click.editcontrols touchstart.editcontrols",function(a){a.stopPropagation(),d.fs.loadEditableControls({element:e,buttons:f})})},isVideo:function(a){return/\.(mp4|webm|ogg(\?.*)?)$/.test(a)},isMediaEmbed:function(a){return/\.(cfm(\?.*)?)$/.test(a)},isAudio:function(a){return/\.(mp3|wav(\?.*)?)$/.test(a)},resizeMediaIframes:function(){this.$editor.find(".fsEmbeddedMediaResponsive").each(function(){var b=a(this);b.height(parseInt(b.width()*b.data("aspectratio")))})}}}}(jQuery);var RedactorPlugins=RedactorPlugins||{};!function(a){"use strict";RedactorPlugins.resize=function(){return{init:function(){this.resize.buildResizer()},buildResizer:function(){return this.opts.resize===!1?!1:(this.$resizer=a('<span class="redactor-resize-handle"></span>'),this.$dimensions=a('<div class="redactor-resize-dimensions"></div>'),this.$box.append(this.$resizer),this.$box.append(this.$dimensions),void this.$resizer.mousedown(a.proxy(this.resize.initResize,this)))},initResize:function(b){b.preventDefault&&b.preventDefault(),this.splitter=b.target,this.element_resize_parent=this.$box,this.opts.iframe?this.element_resize=this.$frame:this.element_resize=this.$editor,this.resize.stopResizeHdl=a.proxy(this.resize.stopResize,this),this.resize.startResizeHdl=a.proxy(this.resize.startResize,this),this.resize.resizeHdl=a.proxy(this.resize.doResize,this),a(document).mousedown(this.resize.startResizeHdl),a(document).mouseup(this.resize.stopResizeHdl),a(this.splitter).mouseup(this.resize.stopResizeHdl),this.null_pointX=!1,this.null_pointY=!1,this.h_new=!1,this.h=this.element_resize.height(),this.w_new=!1,this.w=this.element_resize.width()},startResize:function(){this.fs.hideEditableControls(),a(document).mousemove(this.resize.resizeHdl),this.$box.addClass("resize-outline"),this.$dimensions.show()},doResize:function(b){this.resize.resizeHoverIn.apply(this),b.preventDefault&&b.preventDefault();var c=b.pageY,d=b.pageX;this.null_pointX===!1&&(this.null_pointX=d),this.null_pointY===!1&&(this.null_pointY=c),this.h_new===!1&&(this.h_new=this.element_resize_parent.outerHeight()),this.w_new===!1&&(this.w_new=this.element_resize_parent.outerWidth());var e=this.h_new+c-this.null_pointY,f=this.w_new+d-this.null_pointX;204>=e&&(e=204),204>=f&&(f=204),e>=0&&(this.element_resize[0].style.height=e-this.$toolbar.height()+"px",this.element_resize_parent[0].style.height=e+"px",this.$textarea[0].style.height=e+"px"),f>=0&&(this.element_resize_parent[0].style.width=f+"px",this.$textarea[0].style.width=f+"px"),a(this.element_resize).trigger("resize")},stopResize:function(){a(document).unbind("mousemove",this.resize.resizeHdl),a(document).unbind("mousedown",this.resize.startResizeHdl),a(document).unbind("mouseup",this.resize.stopResizeHdl),a(this.splitter).unbind("mouseup",this.resize.stopResizeHdl),this.$box.removeClass("resize-outline"),this.$dimensions.hide()},resizeHoverIn:function(){this.$dimensions.show().html("<span>"+this.element_resize.width()+"px × "+this.element_resize.height()+"px </span>").css({top:this.element_resize.position().top,left:this.element_resize.position().left,lineHeight:this.element_resize.height()+"px",width:this.element_resize.outerWidth(),height:this.element_resize.outerHeight()})}}}}(jQuery);var RedactorPlugins=RedactorPlugins||{};!function(a){"use strict";RedactorPlugins.styles=function(){return{applyStylePreview:function(b){var c,d=a("<span></span>"),e={},f=this,g=["background-attachment","background-blend-mode","background-clip","background-color","background-image","background-origin","background-position","background-repeat","background-size","border-bottom-color","border-bottom-left-radius","border-bottom-right-radius","border-bottom-style","border-bottom-width","border-collapse","border-image-outset","border-image-repeat","border-image-slice","border-image-source","border-image-width","border-left-color","border-left-style","border-left-width","border-right-color","border-right-style","border-right-width","border-top-color","border-top-left-radius","border-top-right-radius","border-top-style","border-top-width","color","font-family","font-kerning","font-size","font-style","font-variant","font-variant-ligatures","font-weight","text-align","text-decoration","text-indent","text-rendering","text-shadow","text-overflow","text-transform","line-height","outline-color","outline-offset","outline-style","outline-width","padding-bottom","padding-left","padding-right","padding-top"];e.RedactorClearStyle={title:"None",func:"styles.setStyle"},a.each(f.opts.classes,function(a,b){e[b["class"]]={title:b.name,func:"styles.setStyle"}}),c=this.button.addDropdown(this.$toolbar.find(".re-styles"),e),this.dropdown.show(b,"styles"),d.appendTo(this.$editor),c.children("a").each(function(b,c){var e,f=c.className.replace("redactor-dropdown-","");d.removeClass().addClass(f),e=window.getComputedStyle(d.get(0)),a.each(e,function(b,d){var f=e.getPropertyValue(d);return"display"===d&&"none"===f?void a(c).html(a(c).html()+" <em>(Hidden)</em>"):("color"===d&&"rgb(255, 255, 255)"===f&&(f="rgb(0, 0, 0)"),void(-1!==a.inArray(d,g)&&(c.style[d]=f)))})}),d.remove(),b.preventDefault()},parseForClasses:function(){var b=this;if(b.opts.localStylesheet){var c,d;a.each(document.styleSheets,function(a,d){return d.href&&d.href.indexOf(b.opts.localStylesheet)>=0?(c=d,!1):void 0}),c&&(d=c.cssRules||c.rules||[],a.each(d,function(a,c){if(!c.selectorText)return!0;var d=c.selectorText.replace(/.redactor-editor/g,""),e=/\.[a-zA-Z0-9-_]+/.exec(d),f=/stylename_[a-zA-Z0-9-_]+/.exec(d);f&&(f=f[0].replace("stylename_","").replace(/__/g," ").replace(/\b[a-z]/g,function(a){return a.toUpperCase()})),e&&(e=e[0].replace(/^\./,"")),e&&e.length&&f&&f.length&&b.opts.classes.push({"class":e,name:f})}))}},init:function(){this.opts.classes||(this.opts.classes=[]);var a=this.button.addAfter("formatting","styles","Style",null,{});this.$toolbar.find("a.re-styles").addClass("fsredactor-icon fsredactor-style re-has-dropdown"),a.one("click",this.styles.applyStylePreview),this.styles.parseForClasses()},clearStyles:function(){return a("#redactor-overlay-box").length?(this.fs.$editTarget.removeAttr("class"),void this.code.sync()):(a.each(this.selection.getNodes(),function(b,c){a(c).removeAttr("class")}),void this.code.sync())},setStyle:function(b){return"RedactorClearStyle"===b?void this.styles.clearStyles():void this.fs.setInlineStyle(function(c){a(c).addClass(b)})}}}}(jQuery);var RedactorPlugins=RedactorPlugins||{};!function(a){"use strict";RedactorPlugins.table=function(){return{childCellSelector:"> tr > td, > tr > th,\r\n						> thead > tr > td, > thead > tr > th,\r\n						> tbody > tr > td, > tbody > tr > th,\r\n						> tfoot > tr > td, > tfoot > tr > th",emptyCellSpace:"&#8203;",init:function(){var b=this,c={};c.insert_table={title:this.lang.get("insert_table"),func:this.table.show};var d=this.button.addBefore("link","table",this.lang.get("table"));this.button.addDropdown(d,c),d=this.button.add("table-align","Alignment"),this.button.addDropdown(d,{left:{title:"Left",func:this.table.align},right:{title:"Right",func:this.table.align},center:{title:"Center",func:this.table.align}}),d=this.button.add("table-vertical-align","Vertical Alignment"),this.button.addDropdown(d,{top:{title:"Top",func:this.table.verticalAlign},middle:{title:"Middle",func:this.table.verticalAlign},bottom:{title:"Bottom",func:this.table.verticalAlign}}),d=this.button.add("table-rows-columns","Rows and Columns"),this.button.addDropdown(d,{addRowAbove:{title:"Add Row Above",func:this.table.addRowAbove},addRowBelow:{title:"Add Row Below",func:this.table.addRowBelow},addColumnBefore:{title:"Add Column Before",func:this.table.addColumnBefore},addColumnAfter:{title:"Add Column After",func:this.table.addColumnAfter},selectRow:{title:"Select Row",func:this.table.selectRow},selectColumn:{title:"Select Column",func:this.table.selectColumn},selectAll:{title:"Select All Cells",func:this.table.selectAllCells}}),d=this.button.add("table-border","Border"),this.button.addDropdown(d),c=d.data("dropdown")[0],c.innerHTML='<label for="redactor-table-edit-border">Border</label>\r\n					<input type="number" name="redactor-table-edit-border" id="redactor-table-edit-border" />px\r\n					<div>\r\n						<button type="button" class="redactor-table-edit-border-toggle" id="redactor-table-edit-border-top">Top</button>\r\n						<button type="button" class="redactor-table-edit-border-toggle" id="redactor-table-edit-border-bottom">Bottom</button>\r\n					</div><div>\r\n						<button type="button" class="redactor-table-edit-border-toggle" id="redactor-table-edit-border-left">Left</button>\r\n						<button type="button" class="redactor-table-edit-border-toggle" id="redactor-table-edit-border-right">Right</button>\r\n					</div>',a(".re-table-border",this.$toolbar).on("click",function(){var c=parseInt(b.table.getSelectionCommonProperty("borderTopWidth")),d=parseInt(b.table.getSelectionCommonProperty("borderRightWidth")),e=parseInt(b.table.getSelectionCommonProperty("borderBottomWidth")),f=parseInt(b.table.getSelectionCommonProperty("borderLeftWidth"));a("#redactor-table-edit-border").val(Math.max(1,c,d,e,f)),a("#redactor-table-edit-border-top").toggleClass("redactor-button-active",!!c),a("#redactor-table-edit-border-right").toggleClass("redactor-button-active",!!d),a("#redactor-table-edit-border-bottom").toggleClass("redactor-button-active",!!e),a("#redactor-table-edit-border-left").toggleClass("redactor-button-active",!!f)}),a(c).on("click",".redactor-table-edit-border-toggle",function(){return a(this).toggleClass("redactor-button-active"),b.table.processBorder(a(this).closest(".redactor-dropdown")),!1}).on("click change keyup","#redactor-table-edit-border",function(){return b.table.processBorder(a(this).closest(".redactor-dropdown")),!1}),d=this.button.add("table-border-color","Border Color"),c=this.button.addDropdown(d),c.width(242),this.fs.buildPicker(c,"borderColor",this.fs.colors,this.table.setBorderColor,this.table.removeBorderColor),d=this.button.add("table-background-color","Background Color"),c=this.button.addDropdown(d),c.width(242),this.fs.buildPicker(c,"backgroundColor",this.fs.colors,this.table.setBackgroundColor,this.table.removeBackgroundColor),d=this.button.add("table-width","Width"),this.button.addDropdown(d),c=d.data("dropdown")[0],c.innerHTML='<label for="redactor-table-edit-width">Width</label><input type="number" name="redactor-table-edit-width" id="redactor-table-edit-width" />\r\n					<label><select id="redactor-table-edit-width-unit"><option>%</option><option>px</option></select></label>',a(".re-table-width",this.$toolbar).on("click",function(){a("#redactor-table-edit-width",c).val("100"),a("#redactor-table-edit-width-unit",c).val("%")}),a(c).on("click change keyup","#redactor-table-edit-width, #redactor-table-edit-width-unit",function(){return b.table.processWidth(a(this).closest(".redactor-dropdown")),!1}),this.$toolbar.find(".re-table-align, .re-table-vertical-align, .re-table-rows-columns, .re-table-border, .re-table-border-color, .re-table-background-color, .re-table-width").addClass("redactor-table-edit-only-button redactor-button-hidden"),this.$toolbar.find(".re-table").addClass("redactor-table-edit-button"),this.table.modal_table_edit='<section>\r\n						<div class="redactor-table-column1-fieldset">\r\n							<label for="redactor-table-columns">Columns</label><input id="redactor-table-columns" type="number"/>\r\n						</div>\r\n						<div class="redactor-table-column2-fieldset">\r\n							<label for="redactor-table-rows">Rows</label><input id="redactor-table-rows" type="number"/>\r\n						</div>\r\n						<div class="redactor-table-column2-fieldset">\r\n							<label for="redactor-table-cellspacing">Cellspacing</label><input id="redactor-table-cellspacing" type="number"/>px\r\n						</div>\r\n						<div class="redactor-table-column1-fieldset">\r\n							<label for="redactor-table-width">Width</label><input id="redactor-table-width" placeholder="auto" type="number"/>\r\n								<select id="redactor-table-width-unit"><option>%</option><option>px</option></select>\r\n						</div>\r\n						<div class="redactor-table-column2-fieldset">\r\n							<label for="redactor-table-height">Height</label><input id="redactor-table-height" placeholder="auto" type="number"/>\r\n						</div>\r\n						<div class="redactor-table-column-clear"></div>\r\n						<label for="redactor-table-align">Alignment</label>\r\n						<ul id="redactor-table-align">\r\n							<li><input id="redactor-table-align-none" name="redactor-table-align" type="radio" value=""><label for="redactor-table-align-none">None</label></li>\r\n							<li><input id="redactor-table-align-left" name="redactor-table-align" type="radio" value="left"><label for="redactor-table-align-left">Left</label></li>\r\n							<li><input id="redactor-table-align-center" name="redactor-table-align" type="radio" value="center"><label for="redactor-table-align-center">Center</label></li>\r\n							<li><input id="redactor-table-align-right" name="redactor-table-align" type="radio" value="right"><label for="redactor-table-align-right">Right</label></li>\r\n						</ul>\r\n						<div class="redactor-table-column-double-fieldset">\r\n							<label for="redactor-table-class">Class</label><input id="redactor-table-class" placeholder="Choose class..." type="text" />\r\n						</div>\r\n						<div class="redactor-table-column-double-fieldset">\r\n							<label for="redactor-table-border">Border</label><input id="redactor-table-border" type="number"/>\r\n						</div>\r\n						<div class="redactor-table-column-clear"></div>\r\n						<div class="redactor-table-column-double-fieldset">\r\n							<label for="redactor-table-background-color">Background Color</label><input id="redactor-table-background-color" type="text"/><button type="button" for="redactor-table-background-color" class="redactor-color-picker-button"></button>\r\n						</div>\r\n						<div class="redactor-table-column-double-fieldset">\r\n							<label for="redactor-table-border-color">Border Color</label><input id="redactor-table-border-color" type="text"/><button type="button" for="redactor-table-border-color" class="redactor-color-picker-button"></button>\r\n						</div>\r\n						<div class="redactor-table-column-clear"></div>\r\n					</section>',this.$editor.on("sync.redactor-api",this.table.onSync),this.$editor.on("observed.redactor.table",this.table.setEditable)},onSync:function(){var a=this.$textarea.val();a=a.replace(/(<table(.*?)class="(.*?))redactor-table-selected/gi,"$1"),a=a.replace(/(<table(.*?)class="(.*?))redactor-table-edit-mode/gi,"$1"),this.$textarea.val(a)},setEditable:function(b,c){var d=this,e=a(c),f=[];return f.push({name:"Delete","class":"re-trash",title:"Delete Table",onClick:function(){return confirm("Are you sure you want to delete this table?")?(d.fs.hideEditableControls(),e.remove(),d.code.sync(),void 0):!1}}),f.push({name:"Settings","class":"re-cog",title:"Edit Table Properties",onClick:function(){return d.table.show(e),!1}}),f.push({name:"Edit","class":"re-pencil",title:"Edit Table Cells",onClick:function(){return d.table.enableTableEditMode(e),!1}}),e.off(".editcontrols").on("click.editcontrols touchstart.editcontrols",function(b){return e.closest(d.fs.$editTarget).length&&d.$editor.hasClass("redactor-table-edit-mode")?!1:a(b.target).closest("table")[0]===d.table.getSelectedTable()[0]?!1:(d.table.tableCleanUp(e),d.table.setSelectedTable(e[0]),d.fs.loadEditableControls({bCancelSelection:!0,element:e,buttons:f,offset:{top:-20,left:-1},onHide:function(){return e[0]===d.table.getSelectedTable()[0]&&(d.table.disableTableEditMode(e),d.table.setSelectedTable(null)),!0}}),b.stopPropagation(),void b.preventDefault())}),!1},enableTableEditMode:function(b){var c=this,d=a(this.selection.getNodes()).filter("td,th");return this.$editor.hasClass("redactor-table-edit-mode")?void this.table.disableTableEditMode(b):(this.$editor.addClass("redactor-table-edit-mode").prop("contenteditable",!1).prepend('<div class="redactor-table-edit-mode-overlay">'),this.$toolbar.find(".re-table").addClass("redactor-active").on("click.redactor-table-edit",function(){return c.table.disableTableEditMode(b),c.dropdown.hideAll(),!1}),b.find("td,th").each(function(){a(this).attr("unselectable","on")}),this.table.$previousButtons=this.$toolbar.find("a:not(.redactor-table-edit-button, .redactor-button-hidden)"),this.table.$previousButtons.addClass("redactor-button-hidden"),this.$toolbar.find(".redactor-table-edit-only-button").removeClass("redactor-button-hidden"),b.addClass("redactor-table-edit-mode"),this.table.setLastSelected(null),this.selection.remove(),d.length&&this.table.setSelection(d),void b.on("mousedown.redactor-table-edit",c.table.childCellSelector,function(){var a=this,d=b.find(".redactor-table-cell-selected");b.off("mouseover.redactor-table-edit").on("mouseover.redactor-table-edit",c.table.childCellSelector,function(e){c.table.expandSelection(b,a,this,!0),(e.ctrlKey||e.metaKey)&&d.addClass("redactor-table-cell-selected")}).on("mouseup.redactor-table-edit",function(){b.off("mouseover.redactor-table-edit")}),c.dropdown.hideAll()}).on("click.redactor-table-edit",c.table.childCellSelector,function(d){d.shiftKey&&c.table.getLastSelected()?(d.ctrlKey||d.metaKey||c.table.resetSelection(b),c.table.expandSelection(b,c.table.getLastSelected(),this),c.table.setLastSelected(this)):d.ctrlKey||d.metaKey?(a(this).toggleClass("redactor-table-cell-selected"),a(this).hasClass("redactor-table-cell-selected")&&c.table.setLastSelected(this)):(c.table.resetSelection(b),a(this).addClass("redactor-table-cell-selected"),c.table.setLastSelected(this))}))},disableTableEditMode:function(b){return b.length?(this.$editor.removeClass("redactor-table-edit-mode").prop("contenteditable",!0).find(".redactor-table-edit-mode-overlay").remove(),this.$toolbar.find(".re-table").removeClass("redactor-active").off(".redactor-table-edit"),this.$toolbar.find(".redactor-table-edit-only-button").addClass("redactor-button-hidden"),b.removeClass("redactor-table-edit-mode").find(".redactor-table-cell-selected").removeClass("redactor-table-cell-selected"),b.find("td,th").each(function(){a(this).removeAttr("unselectable")}),this.opts.visual&&this.table.$previousButtons&&this.table.$previousButtons.removeClass("redactor-button-hidden"),b.off(".redactor-table-edit"),void this.code.sync()):!1},tableCleanUp:function(b){var c=this;b.find("td, th").each(function(){var b,d=a(this),e=d.contents();if(e.length)for(b in e)if(3!==e[b].nodeType)return;e.length&&/[\w]/.test(d.contents().text())||d.html(c.table.emptyCellSpace)})},align:function(a){this.table.getSelection().css("text-align",a)},verticalAlign:function(a){this.table.getSelection().css("vertical-align",a)},getLastSelected:function(){return this.table.lastSelected=this.table.lastSelected||this.table.getSelection().get(0),this.table.lastSelected},setLastSelected:function(a){this.table.lastSelected=a},setSelection:function(b,c){c&&this.table.resetSelection(this.table.getSelectedTable()),a(b).addClass("redactor-table-cell-selected")},getSelection:function(){return a(this.table.target).find(".redactor-table-cell-selected")},getSelectionCommonProperty:function(a){var b;return this.table.getSelection().each(function(){if(b){if(b!==this.style[a])return b=!1,!1}else b=this.style[a]}),b},getSelectionColumns:function(){var b=a.unique(this.table.getSelection().map(function(){return a(this).index()})),c=a(),d=this.table.getSelectedTable();return a.each(b,function(a,b){c=c.add(d.children("col").eq(b))}),c},setupColumns:function(){var b=this.table.getSelectedTable(),c=b.find("col").length,d=0;for(a("tr:first",b).find("> td, > th").each(function(){a(this).attr("colspan")?d+=+a(this).attr("colspan"):d++});d>c;c++)b.prepend("<col/>")},getSelectedTable:function(){return a(this.table.target)},setSelectedTable:function(b){this.table.target=b,this.$editor.find(".redactor-table-selected").removeClass("redactor-table-selected"),a(this.table.target).addClass("redactor-table-selected"),this.table.setupColumns(),this.table.setLastSelected(null)},resetSelection:function(a){a.find(".redactor-table-cell-selected").removeClass("redactor-table-cell-selected")},expandSelection:function(a,b,c,d){var e,f,g=Math.min(b.cellIndex,c.cellIndex),h=Math.min(b.parentNode.rowIndex,c.parentNode.rowIndex),i=Math.max(b.cellIndex,c.cellIndex),j=Math.max(b.parentNode.rowIndex,c.parentNode.rowIndex);

for(d&&this.table.resetSelection(a),f=h;j>=f;f++)for(e=g;i>=e;e++)a.find("> tr, > thead > tr, > tbody > tr, > tfoot > tr").eq(f).find("> td, > th").eq(e).addClass("redactor-table-cell-selected")},show:function(b){var c=this;"insert_table"===b&&(b=!1),this.modal.addTemplate("table",this.table.modal_table_edit),this.modal.load("table",this.lang.get("insert_table"),500),this.modal.createCancelButton();var d=this.modal.createActionButton(this.lang.get("save"));d.on("click",function(){c.table.save(b)}),this.selection.save(),this.modal.show();var e=a('<div style="display:none; position:absolute; background: #fff"/>');if(this.$modal.append(e),this.$modal.on("keyup change","#redactor-table-background-color, #redactor-table-border-color",function(){var b=a(this);b.next(".redactor-color-picker-button").css("backgroundColor",b.val())}),this.$modal.on("click",".redactor-color-picker-button",function(){var b=a(this);return e.$triggerer=a("#"+b.attr("for")),e.show().css({top:b.position().top}),c.$modal.one("click",function(){e.hide()}),!1}),this.fs.buildPicker(e,"tableSetting",this.fs.colors,function(a,b){e.$triggerer.val(b).change(),e.hide()},function(){e.$triggerer.val("").change(),e.hide()}),b.length){var f=this.fs.rgb2hex(b[0].style.borderColor)||"#000000",g=this.fs.rgb2hex(b[0].style.backgroundColor);a("#redactor-table-rows").val(b[0].rows.length),a("#redactor-table-columns").val(b[0].rows[0].children.length),a("#redactor-table-cellspacing").val(parseInt(b[0].style.borderSpacing)||0),a("#redactor-table-width").val(parseInt(b[0].style.width)||""),a("#redactor-table-height").val(parseInt(b[0].style.height)||""),a("#redactor-table-border").val(parseInt(b[0].style.borderWidth)||0),a("#redactor-table-border-color").val(f),a("#redactor-table-background-color").val(g),a("#redactor-table-align-"+("0px auto"===b[0].style.margin?"center":b[0].style["float"])).prop("checked",!0),b.removeClass("redactor-table-selected"),b.removeClass("redactor-table-edit-mode"),a("#redactor-table-class").val(b[0].className),a('.redactor-color-picker-button[for="redactor-table-background-color"]').css("backgroundColor",g),a('.redactor-color-picker-button[for="redactor-table-border-color"]').css("backgroundColor",f)}if(a.fn.selectize){var h=this.opts.classes?a.map(this.opts.classes,function(a){return{value:a["class"],text:a.name}}):[],i=a("#redactor-table-class").selectize({delimiter:" ",persist:!1,create:!0});i[0].selectize.addOption(h),i[0].selectize.$control.on("keyup",function(a){a.stopPropagation()})}a("#redactor-table-columns").focus()},save:function(b){var c,d,e,f,g=this,h=a("#redactor-table-rows").val(),i=a("#redactor-table-columns").val(),j=a("#redactor-table-cellspacing").val(),k=a("#redactor-table-width").val(),l=a("#redactor-table-width-unit").val(),m=a("#redactor-table-height").val(),n=a('input[name="redactor-table-align"]:checked',this.$modal).val(),o=a("#redactor-table-class").val(),p=a("#redactor-table-border").val(),q=a("#redactor-table-border-color").val()||"#000000",r=a("#redactor-table-background-color").val(),s=0,t=0,u=a("<div>"),v=Math.floor(99999*Math.random()),w=!0;if(b.length?(w=!1,s=b[0].rows.length,t=b[0].rows[0].children.length):b=a('<table id="table'+v+'"><tbody></tbody></table>'),b.css({borderCollapse:j>0?"separate":"collapse",borderSpacing:j?j+"px":"",borderWidth:p?p+"px":"",borderColor:q,borderStyle:p?"solid":"",backgroundColor:r,width:k?k+l:"",height:m?m+"px":"","float":"center"===n?"":n}).attr("class",o),"center"===n&&b.css("margin","0px auto"),b.find("tr").each(function(){var b=i-t;if(b>0)for(c=0;b>c;c++)a(this).append(a("<td>"+g.table.emptyCellSpace+"</td>"));else for(c=0;-b>c;c++)a(this).find("th:last, td:last").remove()}),0===s||h>s)for(c=s;h>c;c++){for(d=a("<tr>"),e=0;i>e;e++)f=a("<td>"+g.table.emptyCellSpace+"</td>"),0===c&&0===e&&f.append(this.selection.getMarker()),a(d).append(f);b.append(d)}else for(c=s;c>h;c--)b.find("tr:last").remove();if(this.modal.close(),this.selection.restore(),this.code.sync(),w){u.append(b);var x=u.html();this.buffer.set();var y=this.selection.getBlock()||this.selection.getCurrent();y&&"BODY"!==y.tagName&&"TD"!==y.tagName&&"TH"!==y.tagName?("LI"===y.tagName&&(y=a(y).closest("ul, ol")),a(y).after(x)):this.insert.html(x),this.selection.restore();var z=this.$editor.find("#table"+v);if(!this.opts.linebreaks&&(this.utils.browser("mozilla")||this.utils.browser("msie"))){var A=z.next();0===A.length&&z.after(this.opts.emptyHtml)}this.observe.buttons(),this.observe.images(),z.find("span.redactor-selection-marker").remove(),z.removeAttr("id"),this.code.sync(),this.core.setCallback("insertedTable",z)}},getTable:function(){var b=a(this.selection.getParent()).closest("table");return this.utils.isRedactorParent(b)?0===b.size()?!1:b:!1},addRowAbove:function(){var a=this.table.getCurrentRow();a.before(this.table.newRow(a[0].cells.length))},addRowBelow:function(){var a=this.table.getCurrentRow();a.after(this.table.newRow(a[0].cells.length))},getAllRows:function(){return this.table.getSelectedTable().find("> tr, > thead > tr, > tbody > tr, > tfoot > tr")},getCurrentRow:function(){return a(this.table.getLastSelected()).closest("tr")},newRow:function(b){var c,d=a("<tr></tr>");for(c=0;b>c;c++)d.append(a("<td>"+this.table.emptyCellSpace+"</td>"));return d},addColumnAfter:function(){var b=this,c=a(this.table.getLastSelected()).index();this.table.getAllRows().each(function(){a("<td>"+b.table.emptyCellSpace+"</td>").insertAfter(a("> td,> th",this).eq(c))}),this.table.getSelectedTable().find("> col, > colgroup > col").eq(c).after("<col/>")},addColumnBefore:function(){var b=this,c=a(this.table.getLastSelected()).index();this.table.getAllRows().each(function(){a("<td>"+b.table.emptyCellSpace+"</td>").insertBefore(a("> td,> th",this).eq(c))}),this.table.getSelectedTable().find("> col, > colgroup > col").eq(c).before("<col/>")},selectRow:function(){this.table.setSelection(a(this.table.getLastSelected()).siblings("td,th").andSelf(),!0)},selectColumn:function(){var b=a(this.table.getLastSelected()).index();this.table.setSelection(a("td:eq("+b+"),th:eq("+b+")",this.table.getAllRows()),!0)},selectAllCells:function(){this.table.setSelection(a(this.table.childCellSelector,this.table.getSelectedTable()),!0)},setBorderColor:function(a,b){this.table.getSelection().css("borderColor",b)},removeBorderColor:function(){this.table.getSelection().css("borderColor","")},setBackgroundColor:function(a,b){this.table.getSelection().css("backgroundColor",b)},removeBackgroundColor:function(){this.table.getSelection().css("backgroundColor","")},processBorder:function(b){var c=a("#redactor-table-edit-border-top",b).hasClass("redactor-button-active"),d=a("#redactor-table-edit-border-right",b).hasClass("redactor-button-active"),e=a("#redactor-table-edit-border-bottom",b).hasClass("redactor-button-active"),f=a("#redactor-table-edit-border-left",b).hasClass("redactor-button-active"),g=a("#redactor-table-edit-border",b).val()+"px"||"1px";this.table.getSelection().css({borderTopWidth:c?g:0,borderRightWidth:d?g:0,borderBottomWidth:e?g:0,borderLeftWidth:f?g:0,borderStyle:"solid"})},processWidth:function(b){var c=a("#redactor-table-edit-width",b).val(),d=a("#redactor-table-edit-width-unit",b).val();this.table.getSelectionColumns().css("width",c+d)},restoreAfterDelete:function(a){this.selection.restore(),a.find("span.redactor-selection-marker").remove(),this.code.sync()},deleteTable:function(){var a=this.table.getTable();if(a){this.buffer.set();var b=a.next();this.opts.linebreaks||0===b.length?this.caret.setAfter(a):this.caret.setStart(b),a.remove(),this.code.sync()}}}}}(jQuery);var RedactorPlugins=RedactorPlugins||{};!function(){"use strict";RedactorPlugins.textdirection=function(){return{init:function(){var a=this,b={};b.ltr={title:"Left to Right",func:a.textdirection.setLtr},b.rtl={title:"Right to Left",func:a.textdirection.setRtl};var c=this.button.add("textdirection","Change Text Direction");this.button.addDropdown(c,b)},setRtl:function(){this.buffer.set(),this.block.setAttr("dir","rtl")},setLtr:function(){this.buffer.set(),this.block.removeAttr("dir")}}}}(jQuery);var RedactorPlugins=RedactorPlugins||{};!function(a){"use strict";RedactorPlugins.video=function(){return{reUrlYoutube:/https?:\/\/(?:[0-9A-Z-]+\.)?(?:youtu\.be\/|youtube\.com\S*[^\w\-\s])([\w\-]{11})(?=[^\w\-]|$)(?![?=&+%\w.-]*(?:['"][^<>]*>|<\/a>))[?=&+%\w.-]*/gi,reUrlVimeo:/https?:\/\/(www\.)?vimeo.com\/(\d+)($|\/)/,getTemplate:function(){return String()+'<section id="redactor-modal-video-insert"><label>'+this.lang.get("video_html_code")+'</label><textarea id="redactor-insert-video-area" style="height: 160px;"></textarea></section>'},init:function(){var a=this.button.addAfter("image","video",this.lang.get("video"));this.button.addCallback(a,this.video.show)},show:function(){this.modal.addTemplate("video",this.video.getTemplate()),this.modal.load("video",this.lang.get("video"),700),this.modal.createCancelButton();var b=this.modal.createActionButton(this.lang.get("insert"));b.on("click",this.video.insert),this.selection.save(),this.modal.show(),a("#redactor-insert-video-area").focus()},insert:function(){var b=a("#redactor-insert-video-area").val();if(!b.match(/<iframe|<video|<object|<embed/gi)){b=this.clean.stripTags(b);var c='<iframe style="width: 500px; height: 281px;" src="',d='" frameborder="0" allowfullscreen></iframe>';b.match(this.video.reUrlYoutube)?b=b.replace(this.video.reUrlYoutube,c+"//www.youtube.com/embed/$1"+d):b.match(this.video.reUrlVimeo)&&(b=b.replace(this.video.reUrlVimeo,c+"//player.vimeo.com/video/$2"+d))}this.selection.restore(),this.modal.close();var e=this.selection.getBlock()||this.selection.getCurrent();e?a(e).after(b):this.insert.html(b),this.code.sync()}}}}(jQuery);